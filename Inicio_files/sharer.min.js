!function(){"use strict";const e="color:red;font-weight:bold",t="color:white;background:#6495ed",o="color:#555;font-style:italic",n="color:#6495ed;font-weight:bold";class s{constructor(e,t,o){this.appName=e,this.className=t,this.level=o,this.saveToBuffer=!1,this.loggerBuffer=[],this.errorBuffer=[],o?this.setLogLevel(o):this.saveToBuffer=!0}getFormattedMessage(e){return`%c${this.appName}:${this.className}%c ${e}`}info(e,...n){const s=[this.getFormattedMessage(e),t,o].concat(n);this.saveToBuffer?this.loggerBuffer.push(s):"ERROR"!==this.level&&console.log(...s)}debug(e,...t){const s=[this.getFormattedMessage(e),n,o].concat(t);this.saveToBuffer?this.loggerBuffer.push(s):"DEBUG"===this.level&&console.log(...s)}error(t,...o){const n=[this.getFormattedMessage(t),e,e].concat(o);this.saveToBuffer?this.errorBuffer.push(n):console.warn(...n)}setLogLevel(e){this.level=e,this.saveToBuffer=!1;for(const e of this.loggerBuffer)console.log(...e);this.loggerBuffer=[];for(const e of this.errorBuffer)console.warn(e);this.errorBuffer=[]}}function i(e,t){return function(e,t,o){const n=new s(e,t,o),i=n.debug.bind(n);return i.info=n.info.bind(n),i.error=n.error.bind(n),i.setLogLevel=n.setLogLevel.bind(n),i}("cobrowse",e,t)}function r(e,t,o,n){return new(o||(o=Promise))((function(s,i){function r(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))}class a{constructor(e){this.eventTarget=new EventTarget,this.registeredListeners=new Set,this.log=i("pub-sub",e)}notify(e,t){this.log(`dispatching ${e}`,t),this.eventTarget.dispatchEvent(new CustomEvent(e,{detail:t}))}listen(e,t){this.log(`adding listener to ${e}`),this.addListener(e,t)}listenForever(e,t){this.log(`adding per-page listener to ${e}`),this.addListener(e,t,{forever:!0})}addListener(e,t,o={forever:!1}){const n=function(e){const o=e.detail;return t({data:o})};!1===o.forever&&this.registeredListeners.add({name:e,listener:n}),this.eventTarget.addEventListener(e,n)}clearEventListeners(){this.registeredListeners.forEach((e=>{this.eventTarget.removeEventListener(e.name,e.listener)})),this.registeredListeners.clear()}}function l(e,t){const o=new Event(t);e.dispatchEvent(o)}const d={replayTyping:function(e,t){l(e,"keydown"),l(e,"keypress"),e.value=t,l(e,"input"),l(e,"keyup")},replayClick:function(e){l(e,"touchstart"),l(e,"touchend"),l(e,"mousedown"),l(e,"mouseup"),e.click()},replayMouseEnter:function(e){l(e,"mouseenter")},replayMouseLeave:function(e){l(e,"mouseleave")},replayMouseOver:function(e){l(e,"mouseover")},replayMouseOut:function(e){l(e,"mouseout")},replaySelectChange:function(e,t){e.value=t,l(e,"change")},replayFocusIn:function(e){l(e,"focusin")},replayFocusOut:function(e){l(e,"focusout")},replayChange:function(e){l(e,"change")},replayWheel:function(e){const t=new WheelEvent("wheel",{bubbles:!0,cancelable:!0,deltaY:0-e});document.body.dispatchEvent(t)}};class c{constructor(e,t,o){var n,s;this.serviceDiscovery=t,this.l10n=o,this.modules=new Map,this.env=(null===(s=null===(n=document.currentScript)||void 0===n?void 0:n.getAttribute("src"))||void 0===s?void 0:s.includes("localhost:8081"))?"localhost":e.env,this.logLevel=e.logLevel||"ERROR",this.log=this.createLogger("core"),this.pubsub=new a(this.logLevel),this.events=d,this.network=this.getNetwork()}create(e){if(this.modules.has(e)){const t=this.modules.get(e);(null==t?void 0:t.instance)&&t.instance.onCreate()}}start(e,t){if(this.modules.has(e)){const o=this.modules.get(e);(null==o?void 0:o.instance)&&o.instance.onSessionStart&&o.instance.onSessionStart(t)}}stop(e){if(this.modules.has(e)){const t=this.modules.get(e);(null==t?void 0:t.instance)&&t.instance.onSessionEnd&&t.instance.onSessionEnd()}}destroy(e){if(this.modules.has(e)){const t=this.modules.get(e);(null==t?void 0:t.instance)&&t.instance.onDestroy()}}createAll(){var e;for(const t of this.modules.values())null===(e=t.instance)||void 0===e||e.onCreate()}startAll(e){var t,o;for(const n of this.modules.values())(null===(t=n.instance)||void 0===t?void 0:t.onSessionStart)&&(null===(o=n.instance)||void 0===o||o.onSessionStart(e))}stopAll(){var e,t;for(const o of this.modules.values())(null===(e=o.instance)||void 0===e?void 0:e.onSessionEnd)&&(null===(t=o.instance)||void 0===t||t.onSessionEnd())}pauseAll(){var e,t;for(const o of this.modules.values())(null===(e=o.instance)||void 0===e?void 0:e.onPause)&&(null===(t=o.instance)||void 0===t||t.onPause())}unPauseAll(){var e,t;for(const o of this.modules.values())(null===(e=o.instance)||void 0===e?void 0:e.onUnPause)&&(null===(t=o.instance)||void 0===t||t.onUnPause())}destroyAll(){var e;for(const t of this.modules.values())null===(e=t.instance)||void 0===e||e.onDestroy()}reconnectAll(e){var t,o;for(const n of this.modules.values())(null===(t=n.instance)||void 0===t?void 0:t.onReconnect)&&(null===(o=n.instance)||void 0===o||o.onReconnect(e))}deregisterAll(){this.modules=new Map}getRootUIElement(){return document.body}getWindow(){return window}getDOMRoot(){throw new Error("getDOMRoot() not implemented")}getWorkRootUIElement(){throw new Error("getWorkRootUIElement() not implemented")}getWorkWindow(){}getWorkFrame(){throw new Error("getWorkFrame() not implemented")}getPrimaryColor(){throw new Error("getPrimaryColor() not implemented")}exposeGlobalVariable(e,t){window[e]=t}reloadWindow(){return this.getWindow().location.reload()}createLogger(e){return i(e,this.logLevel)}setDeploymentOptions(e){const t=Object.assign({},e);if(null==t||delete t.agentName,!("allowAgentControl"in e)||!("allowedDomains"in e)||!("maskSelectors"in e))throw this.log(`invalid deploymentOptions format: ${JSON.stringify(t)}`),new Error("deploymentOptions do not look like deployment options");this.log(`deploymentOptions set: ${JSON.stringify(t)}`),this.deploymentOptions=e}getDeploymentOptions(){if(!this.deploymentOptions)throw new Error("deploymentOptions requested from core before init");return this.deploymentOptions}getAssetsURL(){return this.serviceDiscovery.getUri("staticAssets")}getFontsURL(){return this.serviceDiscovery.getUri("fonts")}loadi18n(){return r(this,void 0,void 0,(function*(){try{const e=yield this.l10n.loadJsLocale();this.i18n=e.cobrowse}catch(e){throw new Error("Could not fetch localization, aborting cobrowse")}}))}geti18n(){if(!this.i18n)throw new Error("Localization not loaded");return this.i18n}getLang(){if(!this.l10n)throw new Error("Localization not loaded");return this.l10n.lang}getDeploymentId(){throw new Error("getDeploymentId not implemented")}sendMessageToWebDirectory(e){this.getWindow().parent.postMessage({protocol:"purecloud-client-apps",action:e,protocolAgentName:"cobrowse-next",protocolAgentVersion:"1.0.0"},"*")}}if(void 0===MutationObserver)throw console.error("DOM Mutation Observers are required."),console.error("https://developer.mozilla.org/en-US/docs/DOM/MutationObserver"),Error("DOM Mutation Observers are required");class h{constructor(){this.nodes=[],this.values=[]}isIndex(e){return+e==e>>>0}nodeId(e){let t=e[h.ID_PROP];return t||(t=e[h.ID_PROP]=h.nextId_++),t}set(e,t){const o=this.nodeId(e);this.nodes[o]=e,this.values[o]=t}get(e){const t=this.nodeId(e);return this.values[t]}has(e){return this.nodeId(e)in this.nodes}delete(e){const t=this.nodeId(e);delete this.nodes[t],this.values[t]=void 0}keys(){const e=[];for(const t in this.nodes)this.isIndex(t)&&e.push(this.nodes[t]);return e}}var u;h.ID_PROP="__mutation_summary_node_map_id__",h.nextId_=1,function(e){e[e.STAYED_OUT=0]="STAYED_OUT",e[e.ENTERED=1]="ENTERED",e[e.STAYED_IN=2]="STAYED_IN",e[e.REPARENTED=3]="REPARENTED",e[e.REORDERED=4]="REORDERED",e[e.EXITED=5]="EXITED"}(u||(u={}));class g{constructor(e,t=!1,o=!1,n=!1,s=null,i=!1,r=null,a=null){this.node=e,this.childList=t,this.attributes=o,this.characterData=n,this.oldParentNode=s,this.added=i,this.attributeOldValues=r,this.characterDataOldValue=a,this.isCaseInsensitive=this.node.nodeType===Node.ELEMENT_NODE&&this.node instanceof HTMLElement&&this.node.ownerDocument instanceof HTMLDocument}getAttributeOldValue(e){if(this.attributeOldValues)return this.isCaseInsensitive&&(e=e.toLowerCase()),this.attributeOldValues[e]}getAttributeNamesMutated(){const e=[];if(!this.attributeOldValues)return e;for(const t in this.attributeOldValues)e.push(t);return e}attributeMutated(e,t){this.attributes=!0,this.attributeOldValues=this.attributeOldValues||{},e in this.attributeOldValues||(this.attributeOldValues[e]=t)}characterDataMutated(e){this.characterData||(this.characterData=!0,this.characterDataOldValue=e)}removedFromParent(e){this.childList=!0,this.added||this.oldParentNode?this.added=!1:this.oldParentNode=e}insertedIntoParent(){this.childList=!0,this.added=!0}getOldParent(){if(this.childList){if(this.oldParentNode)return this.oldParentNode;if(this.added)return null}return this.node.parentNode}}class p{constructor(){this.added=new h,this.removed=new h,this.maybeMoved=new h,this.oldPrevious=new h,this.moved=void 0}}class m extends h{constructor(e,t){super(),this.rootNode=e,this.reachableCache=void 0,this.wasReachableCache=void 0,this.anyParentsChanged=!1,this.anyAttributesChanged=!1,this.anyCharacterDataChanged=!1;for(let e=0;e<t.length;e++){const s=t[e];switch(s.type){case"childList":this.anyParentsChanged=!0;for(var o=0;o<s.removedNodes.length;o++){var n=s.removedNodes[o];this.getChange(n).removedFromParent(s.target)}for(o=0;o<s.addedNodes.length;o++){n=s.addedNodes[o];this.getChange(n).insertedIntoParent()}break;case"attributes":this.anyAttributesChanged=!0,this.getChange(s.target).attributeMutated(s.attributeName,s.oldValue);break;case"characterData":this.anyCharacterDataChanged=!0,this.getChange(s.target).characterDataMutated(s.oldValue)}}}getChange(e){let t=this.get(e);return t||(t=new g(e),this.set(e,t)),t}getOldParent(e){const t=this.get(e);return t?t.getOldParent():e.parentNode}getIsReachable(e){if(e===this.rootNode)return!0;if(!e)return!1;this.reachableCache=this.reachableCache||new h;let t=this.reachableCache.get(e);return void 0===t&&(t=this.getIsReachable(e.parentNode),this.reachableCache.set(e,t)),t}getWasReachable(e){if(e===this.rootNode)return!0;if(!e)return!1;this.wasReachableCache=this.wasReachableCache||new h;let t=this.wasReachableCache.get(e);return void 0===t&&(t=this.getWasReachable(this.getOldParent(e)),this.wasReachableCache.set(e,t)),t}reachabilityChange(e){return this.getIsReachable(e)?this.getWasReachable(e)?u.STAYED_IN:u.ENTERED:this.getWasReachable(e)?u.EXITED:u.STAYED_OUT}}class v{constructor(e,t,o,n,s){this.rootNode=e,this.mutations=t,this.selectors=o,this.calcReordered=n,this.calcOldPreviousSibling=s,this.treeChanges=new m(e,t),this.entered=[],this.exited=[],this.stayedIn=new h,this.visited=new h,this.childListChangeMap=void 0,this.characterDataOnly=void 0,this.matchCache=void 0,this.processMutations()}processMutations(){if(!this.treeChanges.anyParentsChanged&&!this.treeChanges.anyAttributesChanged)return;const e=this.treeChanges.keys();for(let t=0;t<e.length;t++)this.visitNode(e[t],void 0)}visitNode(e,t){if(this.visited.has(e))return;this.visited.set(e,!0);const o=this.treeChanges.get(e);let n=t;if((o&&o.childList||null==n)&&(n=this.treeChanges.reachabilityChange(e)),n!==u.STAYED_OUT){if(this.matchabilityChange(e),n===u.ENTERED)this.entered.push(e);else if(n===u.EXITED)this.exited.push(e),this.ensureHasOldPreviousSiblingIfNeeded(e);else if(n===u.STAYED_IN){let t=u.STAYED_IN;o&&o.childList&&(o.oldParentNode!==e.parentNode?(t=u.REPARENTED,this.ensureHasOldPreviousSiblingIfNeeded(e)):this.calcReordered&&this.wasReordered(e)&&(t=u.REORDERED)),this.stayedIn.set(e,t)}if(n!==u.STAYED_IN)for(let t=e.firstChild;t;t=t.nextSibling)this.visitNode(t,n)}}ensureHasOldPreviousSiblingIfNeeded(e){if(!this.calcOldPreviousSibling)return;this.processChildlistChanges();let t=e.parentNode;const o=this.treeChanges.get(e);o&&o.oldParentNode&&(t=o.oldParentNode);let n=this.childListChangeMap.get(t);n||(n=new p,this.childListChangeMap.set(t,n)),n.oldPrevious.has(e)||n.oldPrevious.set(e,e.previousSibling)}getChanged(e,t,o){this.selectors=t,this.characterDataOnly=o;for(var n=0;n<this.entered.length;n++){var s=this.entered[n];(r=this.matchabilityChange(s))!==u.ENTERED&&r!==u.STAYED_IN||e.added.push(s)}const i=this.stayedIn.keys();for(n=0;n<i.length;n++){s=i[n];if((r=this.matchabilityChange(s))===u.ENTERED)e.added.push(s);else if(r===u.EXITED)e.removed.push(s);else if(r===u.STAYED_IN&&(e.reparented||e.reordered)){const t=this.stayedIn.get(s);e.reparented&&t===u.REPARENTED?e.reparented.push(s):e.reordered&&t===u.REORDERED&&e.reordered.push(s)}}for(n=0;n<this.exited.length;n++){var r;s=this.exited[n];(r=this.matchabilityChange(s))!==u.EXITED&&r!==u.STAYED_IN||e.removed.push(s)}}getOldParentNode(e){const t=this.treeChanges.get(e);if(t&&t.childList)return t.oldParentNode?t.oldParentNode:null;const o=this.treeChanges.reachabilityChange(e);if(o===u.STAYED_OUT||o===u.ENTERED)throw Error("getOldParentNode requested on invalid node.");return e.parentNode}getOldPreviousSibling(e){let t=e.parentNode;const o=this.treeChanges.get(e);o&&o.oldParentNode&&(t=o.oldParentNode);const n=this.childListChangeMap.get(t);if(!n)throw Error("getOldPreviousSibling requested on invalid node.");return n.oldPrevious.get(e)}getOldAttribute(e,t){const o=this.treeChanges.get(e);if(!o||!o.attributes)throw Error("getOldAttribute requested on invalid node.");const n=o.getAttributeOldValue(t);if(void 0===n)throw Error("getOldAttribute requested for unchanged attribute name.");return n}attributeChangedNodes(e){if(!this.treeChanges.anyAttributesChanged)return{};let t,o;if(e){t={},o={};for(var n=0;n<e.length;n++){t[r=e[n]]=!0,o[r.toLowerCase()]=r}}const s={},i=this.treeChanges.keys();for(n=0;n<i.length;n++){const e=i[n],a=this.treeChanges.get(e);if(!a.attributes)continue;if(u.STAYED_IN!==this.treeChanges.reachabilityChange(e)||u.STAYED_IN!==this.matchabilityChange(e))continue;const l=e,d=a.getAttributeNamesMutated();for(let e=0;e<d.length;e++){var r=d[e];if(t&&!t[r]&&(!a.isCaseInsensitive||!o[r]))continue;a.getAttributeOldValue(r)!==l.getAttribute(r)&&(o&&a.isCaseInsensitive&&(r=o[r]),s[r]=s[r]||[],s[r].push(l))}}return s}getOldCharacterData(e){const t=this.treeChanges.get(e);if(!t||!t.characterData)throw Error("getOldCharacterData requested on invalid node.");return t.characterDataOldValue}getCharacterDataChanged(){if(!this.treeChanges.anyCharacterDataChanged)return[];const e=this.treeChanges.keys(),t=[];for(let o=0;o<e.length;o++){const n=e[o];if(u.STAYED_IN!==this.treeChanges.reachabilityChange(n))continue;const s=this.treeChanges.get(n);s.characterData&&n.textContent!=s.characterDataOldValue&&t.push(n)}return t}computeMatchabilityChange(e,t){this.matchCache||(this.matchCache=[]),this.matchCache[e.uid]||(this.matchCache[e.uid]=new h);const o=this.matchCache[e.uid];let n=o.get(t);return void 0===n&&(n=e.matchabilityChange(t,this.treeChanges.get(t)),o.set(t,n)),n}matchabilityChange(e){if(this.characterDataOnly)switch(e.nodeType){case Node.COMMENT_NODE:case Node.TEXT_NODE:return u.STAYED_IN;default:return u.STAYED_OUT}if(!this.selectors)return u.STAYED_IN;if(e.nodeType!==Node.ELEMENT_NODE)return u.STAYED_OUT;const t=e,o=this.selectors.map((e=>this.computeMatchabilityChange(e,t)));let n=u.STAYED_OUT,s=0;for(;n!==u.STAYED_IN&&s<o.length;){switch(o[s]){case u.STAYED_IN:n=u.STAYED_IN;break;case u.ENTERED:n=n===u.EXITED?u.STAYED_IN:u.ENTERED;break;case u.EXITED:n=n===u.ENTERED?u.STAYED_IN:u.EXITED}s++}return n}getChildlistChange(e){let t=this.childListChangeMap.get(e);return t||(t=new p,this.childListChangeMap.set(e,t)),t}processChildlistChanges(){if(!this.childListChangeMap){this.childListChangeMap=new h;for(let n=0;n<this.mutations.length;n++){const s=this.mutations[n];if("childList"!=s.type)continue;if(this.treeChanges.reachabilityChange(s.target)!==u.STAYED_IN&&!this.calcOldPreviousSibling)continue;var e=this.getChildlistChange(s.target);let i=s.previousSibling;function r(t,o){!t||e.oldPrevious.has(t)||e.added.has(t)||e.maybeMoved.has(t)||o&&(e.added.has(o)||e.maybeMoved.has(o))||e.oldPrevious.set(t,o)}for(var t=0;t<s.removedNodes.length;t++){r(o=s.removedNodes[t],i),e.added.has(o)?e.added.delete(o):(e.removed.set(o,!0),e.maybeMoved.delete(o)),i=o}r(s.nextSibling,i);for(t=0;t<s.addedNodes.length;t++){var o=s.addedNodes[t];e.removed.has(o)?(e.removed.delete(o),e.maybeMoved.set(o,!0)):e.added.set(o,!0)}}}}wasReordered(e){if(!this.treeChanges.anyParentsChanged)return!1;this.processChildlistChanges();let t=e.parentNode;const o=this.treeChanges.get(e);o&&o.oldParentNode&&(t=o.oldParentNode);const n=this.childListChangeMap.get(t);if(!n)return!1;if(n.moved)return n.moved.get(e);n.moved=new h;const s=new h;function i(e){if(!e)return!1;if(!n.maybeMoved.has(e))return!1;let t=n.moved.get(e);return void 0!==t||(s.has(e)?t=!0:(s.set(e,!0),t=function(e){if(l.has(e))return l.get(e);let t=e.previousSibling;for(;t&&(n.added.has(t)||i(t));)t=t.previousSibling;return l.set(e,t),t}(e)!==a(e)),s.has(e)?(s.delete(e),n.moved.set(e,t)):t=n.moved.get(e)),t}const r=new h;function a(e){let t=r.get(e);if(void 0!==t)return t;for(t=n.oldPrevious.get(e);t&&(n.removed.has(t)||i(t));)t=a(t);return void 0===t&&(t=e.previousSibling),r.set(e,t),t}const l=new h;return n.maybeMoved.keys().forEach(i),n.moved.get(e)}}class f{constructor(e,t){if(this.projection=e,this.added=[],this.removed=[],this.reparented=t.all||t.element||t.characterData?[]:void 0,this.reordered=t.all?[]:void 0,e.getChanged(this,t.elementFilter,t.characterData),t.all||t.attribute||t.attributeList){const o=t.attribute?[t.attribute]:t.attributeList,n=e.attributeChangedNodes(o);t.attribute?this.valueChanged=n[t.attribute]||[]:(this.attributeChanged=n,t.attributeList&&t.attributeList.forEach((e=>{this.attributeChanged.hasOwnProperty(e)||(this.attributeChanged[e]=[])})))}if(t.all||t.characterData){const o=e.getCharacterDataChanged();t.characterData?this.valueChanged=o:this.characterDataChanged=o}this.reordered&&(this.getOldPreviousSibling=e.getOldPreviousSibling.bind(e))}getOldParentNode(e){return this.projection.getOldParentNode(e)}getOldAttribute(e,t){return this.projection.getOldAttribute(e,t)}getOldCharacterData(e){return this.projection.getOldCharacterData(e)}getOldPreviousSibling(e){return this.projection.getOldPreviousSibling(e)}}const b=/[a-zA-Z_]+/,y=/[a-zA-Z0-9_\-]+/;function w(e){return'"'+e.replace(/"/,'\\"')+'"'}class E{constructor(){}matches(e){if(null===e)return!1;if(void 0===this.attrValue)return!0;if(!this.contains)return this.attrValue==e;const t=e.split(" ");for(let e=0;e<t.length;e++)if(this.attrValue===t[e])return!0;return!1}toString(){return"class"===this.attrName&&this.contains?"."+this.attrValue:"id"!==this.attrName||this.contains?this.contains?"["+this.attrName+"~="+w(this.attrValue)+"]":"attrValue"in this?"["+this.attrName+"="+w(this.attrValue)+"]":"["+this.attrName+"]":"#"+this.attrValue}}class S{get caseInsensitiveTagName(){return this.tagName.toUpperCase()}get selectorString(){return this.tagName+this.qualifiers.join("")}constructor(){this.uid=S.nextUid++,this.qualifiers=[]}isMatching(e){return e[S.matchesSelector](this.selectorString)}wasMatching(e,t,o){if(!t||!t.attributes)return o;const n=t.isCaseInsensitive?this.caseInsensitiveTagName:this.tagName;if("*"!==n&&n!==e.tagName)return!1;const s=[];let i=!1;for(var r=0;r<this.qualifiers.length;r++){var a=this.qualifiers[r],l=t.getAttributeOldValue(a.attrName);s.push(l),i=i||void 0!==l}if(!i)return o;for(r=0;r<this.qualifiers.length;r++){a=this.qualifiers[r];if(void 0===(l=s[r])&&(l=e.getAttribute(a.attrName)),!a.matches(l))return!1}return!0}matchabilityChange(e,t){const o=this.isMatching(e);return o?this.wasMatching(e,t,o)?u.STAYED_IN:u.ENTERED:this.wasMatching(e,t,o)?u.EXITED:u.STAYED_OUT}static parseSelectors(e){const t=[];let o,n;function s(){o&&(n&&(o.qualifiers.push(n),n=void 0),t.push(o)),o=new S}function i(){n&&o.qualifiers.push(n),n=new E}const r=/\s/;let a;const l="Invalid or unsupported selector syntax.";let d=1,c=0;for(;c<e.length;){const t=e[c++];switch(d){case 1:if(t.match(b)){s(),o.tagName=t,d=2;break}if("*"==t){s(),o.tagName="*",d=3;break}if("."==t){s(),i(),o.tagName="*",n.attrName="class",n.contains=!0,d=4;break}if("#"==t){s(),i(),o.tagName="*",n.attrName="id",d=4;break}if("["==t){s(),i(),o.tagName="*",n.attrName="",d=6;break}if(t.match(r))break;throw Error(l);case 2:if(t.match(y)){o.tagName+=t;break}if("."==t){i(),n.attrName="class",n.contains=!0,d=4;break}if("#"==t){i(),n.attrName="id",d=4;break}if("["==t){i(),n.attrName="",d=6;break}if(t.match(r)){d=14;break}if(","==t){d=1;break}throw Error(l);case 3:if("."==t){i(),n.attrName="class",n.contains=!0,d=4;break}if("#"==t){i(),n.attrName="id",d=4;break}if("["==t){i(),n.attrName="",d=6;break}if(t.match(r)){d=14;break}if(","==t){d=1;break}throw Error(l);case 4:if(t.match(b)){n.attrValue=t,d=5;break}throw Error(l);case 5:if(t.match(y)){n.attrValue+=t;break}if("."==t){i(),n.attrName="class",n.contains=!0,d=4;break}if("#"==t){i(),n.attrName="id",d=4;break}if("["==t){i(),d=6;break}if(t.match(r)){d=14;break}if(","==t){d=1;break}throw Error(l);case 6:if(t.match(b)){n.attrName=t,d=7;break}if(t.match(r))break;throw Error(l);case 7:if(t.match(y)){n.attrName+=t;break}if(t.match(r)){d=8;break}if("~"==t){n.contains=!0,d=9;break}if("="==t){n.attrValue="",d=11;break}if("]"==t){d=3;break}throw Error(l);case 8:if("~"==t){n.contains=!0,d=9;break}if("="==t){n.attrValue="",d=11;break}if("]"==t){d=3;break}if(t.match(r))break;throw Error(l);case 9:if("="==t){n.attrValue="",d=11;break}throw Error(l);case 10:if("]"==t){d=3;break}if(t.match(r))break;throw Error(l);case 11:if(t.match(r))break;if('"'==t||"'"==t){a=t,d=13;break}n.attrValue+=t,d=12;break;case 12:if(t.match(r)){d=10;break}if("]"==t){d=3;break}if("'"==t||'"'==t)throw Error(l);n.attrValue+=t;break;case 13:if(t==a){d=10;break}n.attrValue+=t;break;case 14:if(t.match(r))break;if(","==t){d=1;break}throw Error(l)}}switch(d){case 1:case 2:case 3:case 5:case 14:s();break;default:throw Error(l)}if(!t.length)throw Error(l);return t}}S.nextUid=1,S.matchesSelector=function(){const e=document.createElement("div");return"function"==typeof e.webkitMatchesSelector?"webkitMatchesSelector":"function"==typeof e.mozMatchesSelector?"mozMatchesSelector":"function"==typeof e.msMatchesSelector?"msMatchesSelector":"matchesSelector"}();const C=/^([a-zA-Z:_]+[a-zA-Z0-9_\-:\.]*)$/;function x(e){if("string"!=typeof e)throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!(e=e.trim()))throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!e.match(C))throw Error("Invalid request option. invalid attribute name: "+e);return e}function k(e){if(!e.trim().length)throw Error("Invalid request option: elementAttributes must contain at least one attribute.");const t={},o={},n=e.split(/\s+/);for(let e=0;e<n.length;e++){var s;if(!(s=n[e]))continue;const i=(s=x(s)).toLowerCase();if(t[i])throw Error("Invalid request option: observing multiple case variations of the same attribute is not supported.");o[s]=!0,t[i]=!0}return Object.keys(o)}class I{static createObserverOptions(e){const t={childList:!0,subtree:!0};let o;function n(e){t.attributes&&!o||(t.attributes=!0,t.attributeOldValue=!0,e?(o=o||{},e.forEach((e=>{o[e]=!0,o[e.toLowerCase()]=!0}))):o=void 0)}return e.forEach((e=>{if(e.characterData)return t.characterData=!0,void(t.characterDataOldValue=!0);if(e.all)return n(),t.characterData=!0,void(t.characterDataOldValue=!0);if(e.attribute)return void n([e.attribute.trim()]);const o=function(e){const t={};return e.forEach((e=>{e.qualifiers.forEach((e=>{t[e.attrName]=!0}))})),Object.keys(t)}(e.elementFilter).concat(e.attributeList||[]);o.length&&n(o)})),o&&(t.attributeFilter=Object.keys(o)),t}static validateOptions(e){for(const t in e)if(!(t in I.optionKeys))throw Error("Invalid option: "+t);if("function"!=typeof e.callback)throw Error("Invalid options: callback is required and must be a function");if(!e.queries||!e.queries.length)throw Error("Invalid options: queries must contain at least one query request object.");const t={callback:e.callback,rootNode:e.rootNode||document,observeOwnChanges:!!e.observeOwnChanges,oldPreviousSibling:!!e.oldPreviousSibling,queries:[]};for(let n=0;n<e.queries.length;n++){const s=e.queries[n];if(s.all){if(Object.keys(s).length>1)throw Error("Invalid request option. all has no options.");t.queries.push({all:!0})}else if("attribute"in s){if((o={attribute:x(s.attribute)}).elementFilter=S.parseSelectors("*["+o.attribute+"]"),Object.keys(s).length>1)throw Error("Invalid request option. attribute has no options.");t.queries.push(o)}else if("element"in s){let e=Object.keys(s).length;var o={element:s.element,elementFilter:S.parseSelectors(s.element)};if(s.hasOwnProperty("elementAttributes")&&(o.attributeList=k(s.elementAttributes),e--),e>1)throw Error("Invalid request option. element only allows elementAttributes option.");t.queries.push(o)}else{if(!s.characterData)throw Error("Invalid request option. Unknown query request.");if(Object.keys(s).length>1)throw Error("Invalid request option. characterData has no options.");t.queries.push({characterData:!0})}}return t}createSummaries(e){if(!e||!e.length)return[];const t=new v(this.root,e,this.elementFilter,this.calcReordered,this.options.oldPreviousSibling),o=[];for(let e=0;e<this.options.queries.length;e++)o.push(new f(t,this.options.queries[e]));return o}checkpointQueryValidators(){this.queryValidators.forEach((e=>{e&&e.recordPreviousState()}))}runQueryValidators(e){this.queryValidators.forEach(((t,o)=>{t&&t.validate(e[o])}))}changesToReport(e){return e.some((e=>{if(["added","removed","reordered","reparented","valueChanged","characterDataChanged"].some((function(t){return e[t]&&e[t].length})))return!0;if(e.attributeChanged){if(Object.keys(e.attributeChanged).some((t=>!!e.attributeChanged[t].length)))return!0}return!1}))}constructor(e){this.connected=!1,this.options=I.validateOptions(e),this.observerOptions=I.createObserverOptions(this.options.queries),this.root=this.options.rootNode,this.callback=this.options.callback,this.elementFilter=Array.prototype.concat.apply([],this.options.queries.map((e=>e.elementFilter?e.elementFilter:[]))),this.elementFilter.length||(this.elementFilter=void 0),this.calcReordered=this.options.queries.some((e=>e.all)),this.queryValidators=[],I.createQueryValidator&&(this.queryValidators=this.options.queries.map((e=>I.createQueryValidator(this.root,e)))),this.observer=new MutationObserver((e=>{this.observerCallback(e)})),this.reconnect()}observerCallback(e){this.options.observeOwnChanges||this.observer.disconnect();const t=this.createSummaries(e);this.runQueryValidators(t),this.options.observeOwnChanges&&this.checkpointQueryValidators(),this.changesToReport(t)&&this.callback(t),!this.options.observeOwnChanges&&this.connected&&(this.checkpointQueryValidators(),this.observer.observe(this.root,this.observerOptions))}reconnect(){if(this.connected)throw Error("Already connected");this.observer.observe(this.root,this.observerOptions),this.connected=!0,this.checkpointQueryValidators()}takeSummaries(){if(!this.connected)throw Error("Not connected");const e=this.createSummaries(this.observer.takeRecords());return this.changesToReport(e)?e:void 0}disconnect(){const e=this.takeSummaries();return this.observer.disconnect(),this.connected=!1,e}}function T(e){return!(!D(e)||""!==e.innerHTML.trim())&&(null!==e.sheet&&0!==e.sheet.cssRules.length)}function D(e){return"STYLE"===e.nodeName}function L(e){const t=e.getRootNode();return t instanceof ShadowRoot&&"open"===t.mode}function O(e){return!("IFRAME"!==e.nodeName||!e.contentDocument)}I.NodeMap=h,I.parseElementFilter=S.parseSelectors,I.optionKeys={callback:!0,queries:!0,rootNode:!0,oldPreviousSibling:!0,observeOwnChanges:!0};var N=32,R=!0;function M(e,t,o){let n;switch(e.nodeType){case Node.DOCUMENT_TYPE_NODE:return"doctype";case Node.COMMENT_NODE:return"comment";case Node.TEXT_NODE:return n=e,ee(n,!0,t)?"maskedText":"text";case Node.ELEMENT_NODE:return n=e,(n.matches('input[type="checkbox"]')||n.matches('input[type="radio"]'))&&te(n,!0,o)?"readonlyMultiValueInput":("INPUT"===n.tagName||"TEXTAREA"===n.tagName)&&te(n,!0,o)&&ee(n,!0,t)?"maskedTextualInput":"INPUT"!==n.tagName&&"TEXTAREA"!==n.tagName||!te(n,!0,o)?"SELECT"!==n.tagName&&"OPTION"!==n.tagName&&"OPTGROUP"!==n.tagName||!te(n,!0,o)?"BUTTON"===n.tagName&&te(n,!0,o)?"readonlyButton":"SELECT"===n.tagName?"select":"INPUT"!==n.tagName&&"TEXTAREA"!==n.tagName||!ee(n,!0,t)?n.matches('input[type="checkbox"]')||n.matches('input[type="radio"]')?"checkbox":"IFRAME"===n.tagName?O(n)?"cobrowsableIframe":"crossDomainIframe":"IMG"===n.tagName&&ee(n,!0,t)?"maskedImage":"EMBED"===n.tagName||"OBJECT"===n.tagName?"embedOrObject":ee(n,!1,t)?"maskedContainerElement":te(n,!1,o)?"readonlyContainerElement":"INPUT"===n.tagName||"TEXTAREA"===n.tagName?"textualInput":"HEAD"===n.tagName?"head":"CANVAS"===n.tagName?"canvas":function(e){return null!==e.closest("svg")}(n)?"svg":T(n)?"cssInJsStyle":"LINK"===n.tagName?"link":"STYLE"===n.tagName?"style":"generalElement":"maskedTextualInput":"readonlyMultiValueInput":"readonlyTextualInput";default:return"otherNode"}}class A{constructor(e,t){this.node=e,this.id=t}serialize(){return{nodeType:this.node.nodeType,id:this.id}}}class _ extends A{constructor(e,t){super(e,t),this.node=e,this.id=t}serialize(){const e=super.serialize();return e.name=this.node.name,e.publicId=this.node.publicId,e.systemId=this.node.systemId,e}}class P extends A{constructor(e,t,o){super(e,t),this.node=e,this.id=t,this.config=o,(null==o?void 0:o.markElementAsMasked)&&this.markMasked(this.node),(null==o?void 0:o.markElementAsReadonly)&&this.markReadonly(this.node)}serialize(){const e=super.serialize(),t=this.node;if(e.tagName=t.tagName,t.hasAttributes()){e.attributes={};for(const o of t.attributes)e.attributes[o.name]=o.value}return e}markReadonly(e){e.setAttribute("data-gcobrowse-readonly","true")}markMasked(e){e.setAttribute("data-gcobrowse-masked","true")}}class U extends A{constructor(e,t){super(e,t),this.node=e,this.id=t}serialize(){const e=super.serialize(),t=H(this.node.textContent);return this.node.parentNode&&"style"===M(this.node.parentNode)&&R?(e.cssContent=t,e.baseURL=document.baseURI):e.textContent=t,e}}class j extends P{constructor(e,t,o){super(e,t,o),this.node=e,this.id=t,this.config=o}serialize(){var e;const t=super.serialize();t.attributes||(t.attributes={}),this.config.markElementAsReadonly&&(t.attributes.disabled="true");const o=this.config.markElementAsMasked?F(this.node.value):this.node.value;if(t.attributes.value=o,t.value=o,this.isCheckboxOrRadio()&&(null===(e=t.attributes)||void 0===e||delete e.value,t.checked=this.node.checked,this.config.markElementAsReadonly)){const e=this.node.labels;if(e)for(const t of e)super.markReadonly(t)}return t}isCheckboxOrRadio(){return this.node.matches('input[type="checkbox"]')||this.node.matches('input[type="radio"]')}}class z extends P{serialize(){const e=super.serialize(),t=this.node;if(!D(t)||!T(t))throw new Error(`Unexpected type of node passed to CssInJSStyleSerializer: ${t.tagName}`);return e.cssContent=z.getCss(t),e.baseURL=document.baseURI,e}static getCss(e){let t="";if(!D(e)||!T(e))throw new Error(`Unexpected type of node passed to CssInJSStyleSerializer: ${e.tagName}`);for(const o of e.sheet.cssRules)t+=o.cssText+"\n";return t}}class V extends P{constructor(e,t){var o,n,s;super(e,t),this.node=e,this.id=t;const i=null===(o=this.node.ownerDocument)||void 0===o?void 0:o.location.href,r=i.substring(0,i.lastIndexOf("/")+1),a=this.node.getElementsByTagName("base");if(0===a.length)this.node.insertAdjacentHTML("afterbegin",`<base href="${r}">`);else{const e=a[0];try{const t=null!==(n=e.getAttribute("href"))&&void 0!==n?n:"",o=new URL(t,null===(s=e.ownerDocument)||void 0===s?void 0:s.location.href).href;e.setAttribute("href",o)}catch(t){e.setAttribute("href",r)}this.node.prepend(e)}}serialize(){const e=super.serialize(),t=document.adoptedStyleSheets;if(t&&t.length>0){let o="";t.forEach((e=>{for(const t of e.cssRules)o+=t.cssText+"\n"})),e.cssContent=o}return e}}class $ extends P{constructor(e,t){super(e,t),this.node=e,this.id=t,super.markMasked(this.node)}serialize(){const e=super.serialize(),t=this.node.getBoundingClientRect();return e.attributes&&(e.attributes.src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",e.attributes.height=t.height.toString(),e.attributes.width=t.width.toString()),e}}class B extends P{constructor(e,t){super(e,t),this.node=e,this.id=t,super.markMasked(this.node)}serialize(){const e=super.serialize();return e.attributes||(e.attributes={}),e.attributes.src&&(e.attributes["data-src"]=e.attributes.src,e.attributes.src="about://blank",e.attributes.frameborder="1"),e.width=this.node.getBoundingClientRect().width,e.height=this.node.getBoundingClientRect().height,e}}class q extends P{serialize(){const e=super.serialize();return e.attributes||(e.attributes={}),e.attributes.src&&(e.attributes["data-src"]=e.attributes.src,e.attributes.src="about://blank",e.attributes.frameborder="1"),e.width=this.node.getBoundingClientRect().width,e.height=this.node.getBoundingClientRect().height,e}}class W extends P{serialize(){const e=super.serialize();return e.value=H(this.node.value),e}}function H(e){const t=/(?:\d{2,4}[ -]?){4}(?:\d{3})?/,o=t.exec(e);if(!o)return e;let n=o[0];return n=n.replace(/[\s-]+/g,""),function(e){let t=0,o=!1;for(let n=(e=e.replace(/\D/g,"")).length-1;n>=0;n--){const s=e.charAt(n);let i=parseInt(s,10);o&&(i*=2)>9&&(i-=9),t+=i,o=!o}return t%10==0}(n)?e.replace(t,"●●●● ●●●● ●●●● ●●●●"):e}function F(e){return e.replace(/[^\s]/g,"●")}class G extends A{constructor(e,t){super(e,t),this.node=e,this.id=t}serialize(){const e=super.serialize();return e.textContent=F(this.node.textContent),e}}class Y extends P{serialize(){const e=super.serialize();return e.svg=1,e}}class K extends P{constructor(e,t,o){super(e,t,o),this.node=e,this.id=t,this.config=o,super.markMasked(this.node)}serialize(){const e=super.serialize();return e.width=this.node.getBoundingClientRect().width,e.height=this.node.getBoundingClientRect().height,e.tagName="DIV",e.isEmbedOrObject=!0,e.attributes||(e.attributes={}),delete e.attributes.data,delete e.attributes.src,delete e.attributes.width,delete e.attributes.height,delete e.attributes.type,delete e.attributes.typemustmatch,delete e.attributes.usemap,e.attributes.frameborder="1",e}}class X{constructor(e,t){this.node=e,this.id=t,this.allowedRelTypes=["icon","stylesheet","apple-icon-touch"],this.allowedAsAttributes=["font","image","style"],this.elementSerializer=new P(e,t)}serialize(){var e,t;const o=this.elementSerializer.serialize();{o.attributes&&(o.attributes.crossorigin="anonymous");const n=null===(e=o.attributes)||void 0===e?void 0:e.as;if(n&&!this.isAttributeAllowed(n,this.allowedAsAttributes))return;const s=null===(t=o.attributes)||void 0===t?void 0:t.rel;if(s&&!this.isAttributeAllowed(s,this.allowedRelTypes))return;this.rewriteHref(o)}return o}isAttributeAllowed(e,t){return t.includes(e.toLowerCase())}rewriteHref(e){var t;if(null==e?void 0:e.attributes){const o=null===(t=e.attributes)||void 0===t?void 0:t.href;o&&(e.attributes.href=new URL(o,document.baseURI).href)}}}class J extends P{serialize(){return super.serialize()}}class Z extends P{serialize(){const e=super.serialize();let t;try{t=this.node.toDataURL("image/webp")}catch(e){t=""}return e.canvas=t,e}}function Q(e){if(!e.cssSelectors)return!1;for(const t of e.cssSelectors){if(e.elem.nodeType!==Node.ELEMENT_NODE&&e.elem.nodeType!==Node.TEXT_NODE)continue;const o=e.elem.nodeType===Node.TEXT_NODE?oe(e.elem):e.elem;if(null===o)throw new Error(`Cannot determine if element ${e.elem.outerHTML} is of type ${e.selectorType}`);if(o.matches(t))return!0;if(e.checkParent&&o.closest(t))return!0}return!1}function ee(e,t,o){return Q({selectorType:"masking",elem:e,checkParent:t,cssSelectors:o})}function te(e,t,o){return Q({selectorType:"readonly",elem:e,checkParent:t,cssSelectors:o})}function oe(e){if(null===e.parentNode)throw new Error("parent node must not be null");return e.parentNode instanceof ShadowRoot?e.getRootNode().host:e.parentNode}function ne(e,t){const o=t.replace(/[[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\#&]"+o+"=([^&#]*)").exec(e.hash);return null===n?null:decodeURIComponent(n[1].replace(/\+/g," "))}var se="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ie={exports:{}};(function(e){var t=function(){return t=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var s in t=arguments[o])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},t.apply(this,arguments)};function o(e,t,o){if(o||2===arguments.length)for(var n,s=0,i=t.length;s<i;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))}var n,s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==se?se:"undefined"!=typeof self?self:{},i=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e},r=Object.prototype.hasOwnProperty;function a(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function l(e){try{return encodeURIComponent(e)}catch(e){return null}}function d(e){for(var t,o=/([^=?#&]+)=?([^&]*)/g,n={};t=o.exec(e);){var s=a(t[1]),i=a(t[2]);null===s||null===i||s in n||(n[s]=i)}return n}function c(e,t){t=t||"";var o,s,i=[];for(s in"string"!=typeof t&&(t="?"),e)if(r.call(e,s)){if((o=e[s])||null!==o&&o!==n&&!isNaN(o)||(o=""),s=l(s),o=l(o),null===s||null===o)continue;i.push(s+"="+o)}return i.length?t+i.join("&"):""}var h=c,u=d,g={stringify:h,parse:u},p=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,m=/[\n\r\t]/g,v=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,f=/:\d+$/,b=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,y=/^[a-zA-Z]:/;function w(e){return(e||"").toString().replace(p,"")}var E=[["#","hash"],["?","query"],function(e,t){return x(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],S={hash:1,query:1};function C(e){var t,o=("undefined"!=typeof window?window:void 0!==s?s:"undefined"!=typeof self?self:{}).location||{},n={},i=typeof(e=e||o);if("blob:"===e.protocol)n=new T(unescape(e.pathname),{});else if("string"===i)for(t in n=new T(e,{}),S)delete n[t];else if("object"===i){for(t in e)t in S||(n[t]=e[t]);void 0===n.slashes&&(n.slashes=v.test(e.href))}return n}function x(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function k(e,t){e=(e=w(e)).replace(m,""),t=t||{};var o,n=b.exec(e),s=n[1]?n[1].toLowerCase():"",i=!!n[2],r=!!n[3],a=0;return i?r?(o=n[2]+n[3]+n[4],a=n[2].length+n[3].length):(o=n[2]+n[4],a=n[2].length):r?(o=n[3]+n[4],a=n[3].length):o=n[4],"file:"===s?a>=2&&(o=o.slice(2)):x(s)?o=n[4]:s?i&&(o=o.slice(2)):a>=2&&x(t.protocol)&&(o=n[4]),{protocol:s,slashes:i||x(s),slashesCount:a,rest:o}}function I(e,t){if(""===e)return t;for(var o=(t||"/").split("/").slice(0,-1).concat(e.split("/")),n=o.length,s=o[n-1],i=!1,r=0;n--;)"."===o[n]?o.splice(n,1):".."===o[n]?(o.splice(n,1),r++):r&&(0===n&&(i=!0),o.splice(n,1),r--);return i&&o.unshift(""),"."!==s&&".."!==s||o.push(""),o.join("/")}function T(e,t,o){if(e=(e=w(e)).replace(m,""),!(this instanceof T))return new T(e,t,o);var n,s,r,a,l,d,c=E.slice(),h=typeof t,u=this,p=0;for("object"!==h&&"string"!==h&&(o=t,t=null),o&&"function"!=typeof o&&(o=g.parse),n=!(s=k(e||"",t=C(t))).protocol&&!s.slashes,u.slashes=s.slashes||n&&t.slashes,u.protocol=s.protocol||t.protocol||"",e=s.rest,("file:"===s.protocol&&(2!==s.slashesCount||y.test(e))||!s.slashes&&(s.protocol||s.slashesCount<2||!x(u.protocol)))&&(c[3]=[/(.*)/,"pathname"]);p<c.length;p++)"function"!=typeof(a=c[p])?(r=a[0],d=a[1],r!=r?u[d]=e:"string"==typeof r?~(l="@"===r?e.lastIndexOf(r):e.indexOf(r))&&("number"==typeof a[2]?(u[d]=e.slice(0,l),e=e.slice(l+a[2])):(u[d]=e.slice(l),e=e.slice(0,l))):(l=r.exec(e))&&(u[d]=l[1],e=e.slice(0,l.index)),u[d]=u[d]||n&&a[3]&&t[d]||"",a[4]&&(u[d]=u[d].toLowerCase())):e=a(e,u);o&&(u.query=o(u.query)),n&&t.slashes&&"/"!==u.pathname.charAt(0)&&(""!==u.pathname||""!==t.pathname)&&(u.pathname=I(u.pathname,t.pathname)),"/"!==u.pathname.charAt(0)&&x(u.protocol)&&(u.pathname="/"+u.pathname),i(u.port,u.protocol)||(u.host=u.hostname,u.port=""),u.username=u.password="",u.auth&&(~(l=u.auth.indexOf(":"))?(u.username=u.auth.slice(0,l),u.username=encodeURIComponent(decodeURIComponent(u.username)),u.password=u.auth.slice(l+1),u.password=encodeURIComponent(decodeURIComponent(u.password))):u.username=encodeURIComponent(decodeURIComponent(u.auth)),u.auth=u.password?u.username+":"+u.password:u.username),u.origin="file:"!==u.protocol&&x(u.protocol)&&u.host?u.protocol+"//"+u.host:"null",u.href=u.toString()}function D(e,t,o){var n=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(o||g.parse)(t)),n[e]=t;break;case"port":n[e]=t,i(t,n.protocol)?t&&(n.host=n.hostname+":"+t):(n.host=n.hostname,n[e]="");break;case"hostname":n[e]=t,n.port&&(t+=":"+n.port),n.host=t;break;case"host":n[e]=t,f.test(t)?(t=t.split(":"),n.port=t.pop(),n.hostname=t.join(":")):(n.hostname=t,n.port="");break;case"protocol":n.protocol=t.toLowerCase(),n.slashes=!o;break;case"pathname":case"hash":if(t){var s="pathname"===e?"/":"#";n[e]=t.charAt(0)!==s?s+t:t}else n[e]=t;break;case"username":case"password":n[e]=encodeURIComponent(t);break;case"auth":var r=t.indexOf(":");~r?(n.username=t.slice(0,r),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=t.slice(r+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(t))}for(var a=0;a<E.length;a++){var l=E[a];l[4]&&(n[l[1]]=n[l[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin="file:"!==n.protocol&&x(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n}function L(e){e&&"function"==typeof e||(e=g.stringify);var t,o=this,n=o.host,s=o.protocol;s&&":"!==s.charAt(s.length-1)&&(s+=":");var i=s+(o.protocol&&o.slashes||x(o.protocol)?"//":"");return o.username?(i+=o.username,o.password&&(i+=":"+o.password),i+="@"):o.password?(i+=":"+o.password,i+="@"):"file:"!==o.protocol&&x(o.protocol)&&!n&&"/"!==o.pathname&&(i+="@"),(":"===n[n.length-1]||f.test(o.hostname)&&!o.port)&&(n+=":"),i+=n+o.pathname,(t="object"==typeof o.query?e(o.query):o.query)&&(i+="?"!==t.charAt(0)?"?"+t:t),o.hash&&(i+=o.hash),i}T.prototype={set:D,toString:L},T.extractProtocol=k,T.location=C,T.trimLeft=w,T.qs=g;var O=T;function N(e,t){if(!e)throw new Error(t)}function R(e,t){void 0===t&&(t="value"),N(e instanceof Array,"".concat(t," must be an array of strings"));for(var o=0,n=e;o<n.length;o++)N("string"==typeof n[o],"Each item in ".concat(t," must be a string"))}function M(e){N("string"==typeof e,"url is not a string");var t=O(e,{});return N(t.protocol&&t.hostname,"invalid url: '".concat(e,"', unable to parse hostname")),t}function A(e){N(!!e&&"object"==typeof e,"Provided filters must be an object");var t=e;void 0!==t.env&&(N(t.env instanceof Array,"filters.env must be an array"),N(t.env.every((function(e){return P.indexOf(e)>=0})),"'".concat(t.env,"' - filters.env must be an array containing only: ").concat(P.join(",")))),void 0!==t.status&&(N(t.status instanceof Array,"filters.status must be an array"),N(t.status.every((function(e){return U.indexOf(e)>=0})),"'".concat(t.status,"' - filters.status must be an array containing only: ").concat(U.join(","))))}var _=[{name:"dev",env:"dev",region:"us-east-1",status:"stable",publicDomainName:"inindca.com",publicDomainAliases:[]},{name:"fedramp-use2-core",env:"fedramp",region:"us-east-2",status:"stable",publicDomainName:"use2.us-gov-pure.cloud",publicDomainAliases:[]},{name:"prod",env:"prod",region:"us-east-1",status:"stable",publicDomainName:"mypurecloud.com",publicDomainAliases:[]},{name:"prod-apne1",env:"prod",region:"ap-northeast-1",status:"stable",publicDomainName:"mypurecloud.jp",publicDomainAliases:[]},{name:"prod-apne2",env:"prod",region:"ap-northeast-2",status:"stable",publicDomainName:"apne2.pure.cloud",publicDomainAliases:[]},{name:"prod-apne3",env:"prod",region:"ap-northeast-3",status:"beta",publicDomainName:"apne3.pure.cloud",publicDomainAliases:[]},{name:"prod-aps1",env:"prod",region:"ap-south-1",status:"stable",publicDomainName:"aps1.pure.cloud",publicDomainAliases:[]},{name:"prod-apse2",env:"prod",region:"ap-southeast-2",status:"stable",publicDomainName:"mypurecloud.com.au",publicDomainAliases:[]},{name:"prod-cac1",env:"prod",region:"ca-central-1",status:"stable",publicDomainName:"cac1.pure.cloud",publicDomainAliases:[]},{name:"prod-euc1",env:"prod",region:"eu-central-1",status:"stable",publicDomainName:"mypurecloud.de",publicDomainAliases:[]},{name:"prod-euc2",env:"prod",region:"eu-central-2",status:"beta",publicDomainName:"euc2.pure.cloud",publicDomainAliases:[]},{name:"prod-euw1",env:"prod",region:"eu-west-1",status:"stable",publicDomainName:"mypurecloud.ie",publicDomainAliases:[]},{name:"prod-euw2",env:"prod",region:"eu-west-2",status:"stable",publicDomainName:"euw2.pure.cloud",publicDomainAliases:[]},{name:"prod-mec1",env:"prod",region:"me-central-1",status:"beta",publicDomainName:"mec1.pure.cloud",publicDomainAliases:[]},{name:"prod-sae1",env:"prod",region:"sa-east-1",status:"stable",publicDomainName:"sae1.pure.cloud",publicDomainAliases:[]},{name:"prod-usw2",env:"prod",region:"us-west-2",status:"stable",publicDomainName:"usw2.pure.cloud",publicDomainAliases:[]},{name:"test",env:"test",region:"us-east-1",status:"stable",publicDomainName:"inintca.com",publicDomainAliases:[]}],P=["dev","test","prod","fedramp"],U=["alpha","beta","stable","archived"],j=["localhost","127.0.0.1"],z={env:["prod","fedramp"],status:["stable"]},V={},$=function(e,t){return e.slice(e.length-t.length)===t},B=function(e){return function(t){return e===t||$(e,".".concat(t))}},q=function(e){void 0===e&&(e=z),A(e);var t=e.env,o=e.status;return _.filter((function(e){return void 0===t||t.indexOf(e.env)>=0})).filter((function(e){return void 0===o||o.indexOf(e.status)>=0}))},W=function(e,t){return!!H(e,t)},H=function(e,t){var n=M(e).hostname;return q(t).find((function(e){return o([e.publicDomainName],e.publicDomainAliases,!0).filter((function(e){return!!e})).some(B(n))}))},F=function(e,n){void 0===e&&(e=window.location.href),void 0===n&&(n=V),A(n);var s=M(e).hostname,i=H(e,n);if(i)return t(t({},i),{local:!1,currentDomainName:o([i.publicDomainName],i.publicDomainAliases,!0).filter((function(e){return!!e})).find(B(s))})},G=function(e){return void 0===e&&(e=j),function(o,n){void 0===o&&(o=window.location.href),void 0===n&&(n=V),A(n),R(e,"localHostnames");var s=M(o),i=s.hostname,r=s.pathname;if(e.indexOf(i)>=0){var a=r.split("/")[1],l=q(n).find((function(e){return e.name===a}));if(!l)return;return t(t({},l),{local:!0,currentDomainName:l.publicDomainName})}}},Y=function(e,t){return void 0===e&&(e=window.location.href),void 0===t&&(t=V),G()(e,t)||F(e,t)};e.ENVS=P,e.STATUSES=U,e.getEnvironments=q,e.isKnown=W,e.parse=H,e.parseDeployedRuntime=F,e.parseRuntime=Y,e.parseRuntimeFromLocalPath=G,Object.defineProperty(e,"__esModule",{value:!0})})(ie.exports);
/*!
	 * Service Discovery
	 * Resolves URIs and domains for the current env
	 */
const re="apps",ae=ie.exports.getEnvironments({}),le=new Map(ae.map((e=>[e.name,e.publicDomainName])));le.set("mock","localhost");const de={staticAssets:{subdomain:"apps",path:"/cobrowse-next",localPort:"8081"},api:{subdomain:"api",localPort:"8080"},auth:{localhostEnv:"dev",subdomain:"login",path:"/oauth/authorize"},fonts:{subdomain:"apps",path:"/webfonts",localPort:"8081"},proxy:{subdomain:"cobrowse-v2",name:"proxy"}};class ce{constructor(e,t){let o=e.toLowerCase();this.getKeyByValue(le,o)||("use1"===o||"prod-use1"===o?o="prod":"fedramp-use2"===o?o="fedramp-use2-core":["dev","test","mock","localhost"].includes(o)||(o=o.includes("prod")||o.includes("fedramp-use2-core")?o:`prod-${o}`));const n=this.getKeyByValue(le,o),s=this.getDomain(o);if("string"!=typeof s&&"mock"!==o)throw new Error(`Unknown environment '${e}'`);t&&(this.apps=this.isSubdomainApps(t)),this.environment=null!=n?n:e,this.domain=s}getDomain(e){if(!le.get(e)){const t=this.getKeyByValue(le,e);if(t)return le.get(t)}return le.get(e)}getKeyByValue(e,t){for(const[o,n]of e.entries())if(n===t)return o}getUri(e){const t=de[e],{subdomain:o,localPort:n,path:s,localhostEnv:i}=t;let r=this.domain;if("mock"===this.environment){if("proxy"===(null==t?void 0:t.name)){return`https://${o}.${this.getDomain("dev")}/proxy`}if(!i)return`http://localhost:${null!=n?n:"UNKNOWNPORT"}`;r=le.get(i)}let a=`https://${o}.${r}`;return"proxy"===(null==t?void 0:t.name)?`${a}/proxy`:(this.apps&&"apps"===t.subdomain&&(a=`https://${re}.${r}`),s&&(a+=s),a)}isSubdomainApps(e){return new URL(e).host.startsWith(re)}static discoverEnvFromDomain(e){for(const[t,o]of le.entries()){if(new RegExp(`^.*?${o}$`).test(e.hostname)){const e=ne(window.location,"state");if(!e)return t;const o=decodeURIComponent(e),n=new URLSearchParams(o).get("env");return n||t}}throw new Error(`Cannot discover environment from URL: '${e.href}'`)}}ce.SERVICES=de;class he{constructor(){this.urlRegExp=/(@import\s+)?url\(\s*[\"\']?([^\"\'\)]+)[\"\']?\s*\)|@import\s+[\"\']([^\"\']+)[\"\']|(\/\*)|(\*\/)/g}find(e,t){let o,n,s=!1;for(;null!==(o=this.urlRegExp.exec(e));){let e;if(s)o[5]&&(s=!1);else if(o[4])s=!0;else if(e=o[2]){if(0!==e.indexOf("data:")){n=o[0],e.replace("./","/");t(this.createUrlReference(e,n,o))}}else if(e=o[3]){n=o[0];t(this.createUrlReference(e,n,o))}}}createUrlReference(e,t,o){const n=o.index+t.indexOf(e);return{url:e,start:n,end:n+e.length}}findAndReplaceHover(e){return e.replace(/:hover|::hover/gi,".genesys_hover")}findAndReplace(e,t){const o=[];this.find(e,(e=>{e&&o.push(e)}));let n=o.length;for(;--n>=0;){const s=o[n],i=t(s);i&&(e=`${e.substring(0,s.start)}${i}${e.substring(s.end)}`)}return e=this.findAndReplaceHover(e)}}class ue{set proxyURL(e){ue._proxyURL=e}static getProxyURL(){return ue._proxyURL}constructor(e){this.hash="#",this.proxifyCSS=e=>{var t,o;const n=e.currentTarget,s=n.href.replace(`${ue._proxyURL}?url=`,""),i=null===(t=n.sheet)||void 0===t?void 0:t.cssRules;if(i)for(let e=0;e<i.length;e++){const t=null===(o=i.item(e))||void 0===o?void 0:o.cssText;t&&!t.includes("-webkit-scroll")&&(n.sheet.deleteRule(e),n.sheet.insertRule(this.proxifyCSSRule(t,s),e))}n.removeEventListener("load",this.proxifyCSS)},e||(e=ce.discoverEnvFromDomain(new URL(window.location.href))),this.serviceDiscovery=new ce(e),ue._proxyURL=`${this.serviceDiscovery.getUri("proxy")}`,this.cssUrlRewriter=new he}pointToProxy(e){e.href=`${ue._proxyURL}?url=${encodeURI(e.href)}`}scheduleCSSProxifying(e){e.addEventListener("load",this.proxifyCSS)}proxifyCSSRule(e,t){return this.cssUrlRewriter.findAndReplace(e,(e=>{const{url:o}=e,n=this.normalizeURL(o,t);return this.proxifyURL(n)}))}normalizeURL(e,t){if(e.startsWith(this.hash))return e;const o=this.getValidURL(t);return new URL(e,o).toString()}proxifyURL(e){if(e.startsWith(this.hash))return e;const t=e.split(this.hash);return 2===t.length?`${ue._proxyURL}?url=${encodeURIComponent(t[0])}${this.hash}${t[1]}`:`${ue._proxyURL}?url=${encodeURIComponent(e)}`}getValidURL(e){try{return new URL(String(e))}catch(e){return new URL(window.location.href)}}}function ge(e,...t){if(!("GENESYS_COBROWSE_DEBUG_DOM"in window))return;const o=[`%ccobrowse:DOM%c ${e}`,"color:#FF8FDD;font-weight:bold","color:#555;font-style:italic"].concat(t);console.log(...o)}function pe(e,t){for(;e.parentNode;){const o=e.parentNode;if(o.nodeType===Node.ELEMENT_NODE&&o.matches(t))return!0;e=o}return!1}function me(e,t){return null!==e.parentNode&&t.includes(e.parentNode)?me(e.parentNode,t):e}class ve{constructor(e,t,o,n,s){var i;this.target=e,this.mirror=t,this.env=n,this.config=s,this.nextId=1,this.nodeToId=new Map,this.idToNode=new Map,this.cssInJsTimers=new Map,this.ignoredSelectors=(null===(i=this.config)||void 0===i?void 0:i.ignore)||[],this.cobrowsableIframes=[],this.knownCanvases=[],this.proxifier=new ue(n),ge("recording current DOM snapshot, root node: ",e);const r=this.serializeNode(e).id,a=this.serializeChildren(e);ge("recorded DOM snapshot"),this.mirror.initialize(r,a);let l=[{all:!0}];o&&(l=l.concat(o)),ge("creating Mutation Summary"),this.mutationSummary=new I({rootNode:e,callback:e=>{ge("got Mutations callback with this: ",e),this.applyChanged(e[0]),ge("finished with a mutation")},queries:l}),this.onInputEvent=this.onInputEvent.bind(this),e.addEventListener("input",this.onInputEvent),e.addEventListener("keydown",this.onInputEvent),e.addEventListener("change",this.onInputEvent)}processSubTree(e){var t;ge("adding input listener for a subtree",e),e.addEventListener("input",this.onInputEvent.bind(this)),ge("creating Mutation Summary for a subtree",e);const o=new I({rootNode:e,callback:e=>{ge("Subtree got mutations. Summaries: ",e),this.applyChanged(e[0]),ge("finished with subtree mutations",e)},queries:[{all:!0}]});null===(t=this.subTreeMutationSummaries)||void 0===t||t.push(o)}onInputEvent(e){var t,o;if(!e.target)return;const n=e.target;if("INPUT"===n.tagName||"TEXTAREA"===n.tagName){const e=n,s=M(n,null===(t=this.config)||void 0===t?void 0:t.masking,null===(o=this.config)||void 0===o?void 0:o.readonly);"textualInput"===s||"readonlyTextualInput"===s?this.applyValueChanged(e):"readonlyMultiValueInput"===s?this.applyCheckedChanged(e):"maskedTextualInput"===s?this.applyMaskedValueChanged(e):"checkbox"===s&&this.applyCheckedChanged(e)}"SELECT"===n.tagName&&this.applySelectChanged(n)}disconnect(){var e;this.mutationSummary&&(this.mutationSummary.disconnect(),ge("Mutation Summary disconnected"),this.mutationSummary=void 0),(null===(e=this.subTreeMutationSummaries)||void 0===e?void 0:e.length)&&(this.subTreeMutationSummaries.forEach((e=>e.disconnect())),ge("Subtree Mutation Summary disconnected"),this.subTreeMutationSummaries=void 0),this.target.removeEventListener("input",this.onInputEvent),this.target.removeEventListener("keydown",this.onInputEvent),this.target.removeEventListener("change",this.onInputEvent),this.nodeToId.clear(),this.idToNode.clear();for(const e of this.cssInJsTimers.values())clearTimeout(e);this.cssInJsTimers.clear(),this.cobrowsableIframes=[]}rememberNode(e){const t=this.nextId++;return this.nodeToId.set(e,t),this.idToNode.set(t,e),e.__cb_id__=t,ge(`remembered node with id ${t}: `,e),t}forgetNode(e){const t=this.nodeToId.get(e);"number"==typeof t&&this.idToNode.delete(t),this.nodeToId.delete(e),ge("forgot node with id ",t,e)}getNodeById(e){const t=this.idToNode.get(e);if(!t)throw new Error(`trying to get node with unknown id "${e}"`);return t}getNodeId(e){const t=this.nodeToId.get(e);if(!t)throw new Error("trying to get id of unknown node");return t}isSynchronized(e){return!!this.nodeToId.get(e)}serializeChildren(e){const t=[];ge("serializing children of: ",e);for(let o=e.firstChild;o;o=o.nextSibling)if(this.isIgnored(o))ge("ignoring node: ",o);else{const e=this.serializeNode(o,!0);e&&t.push(e)}return ge("serialized children of: ",e,t),t}serializeNode(e,t){var o,n;if(null===e)throw new Error("cannot serialize null");ge("serializing node",e);let s=this.nodeToId.get(e);if(void 0!==s)return ge(`serialized known node with id ${s}`,e),{id:s};ge("this node was not serialized before"),s=this.rememberNode(e);const i=function(e,t,o,n){switch(M(e,o,n)){case"doctype":return new _(e,t);case"text":case"comment":return new U(e,t);case"cobrowsableIframe":return new q(e,t);case"crossDomainIframe":return new B(e,t);case"maskedText":return new G(e,t);case"generalElement":return new P(e,t);case"svg":return new Y(e,t);case"canvas":return new Z(e,t);case"readonlyContainerElement":return new P(e,t,{markElementAsMasked:ee(e,!1,o),markElementAsReadonly:!0});case"maskedContainerElement":return new P(e,t,{markElementAsMasked:!0,markElementAsReadonly:te(e,!1,n)});case"textualInput":return new W(e,t);case"maskedTextualInput":return new j(e,t,{markElementAsMasked:!0,markElementAsReadonly:!0});case"maskedImage":return new $(e,t);case"select":case"checkbox":return new j(e,t,{markElementAsMasked:ee(e,!0,o),markElementAsReadonly:te(e,!0,n)});case"readonlyTextualInput":case"readonlyMultiValueInput":case"readonlyButton":return new j(e,t,{markElementAsMasked:ee(e,!0,o),markElementAsReadonly:!0});case"head":return new V(e,t);case"cssInJsStyle":return new z(e,t);case"link":return new X(e,t);case"style":return new J(e,t);case"embedOrObject":return new K(e,t,{markElementAsReadonly:te(e,!0,n)});default:return new A(e,t)}}(e,s,null===(o=this.config)||void 0===o?void 0:o.masking,null===(n=this.config)||void 0===n?void 0:n.readonly);ge("serailizer for the node is: ",i);const r=i.serialize();if(r){if(ge("serialized (without children) as ",r),function(e){return"OBJECT"===e.nodeName}(e))return ge("going to drop children of Object element",e),r;if(function(e){return!(e.nodeType!==Node.ELEMENT_NODE||!e.childNodes.length)}(e)&&t&&(ge("now going to recursively serialize children"),r.childNodes=this.serializeChildren(e)),function(e){const t=e;return!(t.nodeType!==Node.ELEMENT_NODE||!t.shadowRoot||"open"!==t.shadowRoot.mode)}(e)){if(ge("now going to recursively serialize children of shadowRoot",e),e.shadowRoot&&e.shadowRoot.adoptedStyleSheets&&e.shadowRoot.adoptedStyleSheets.length>0){ge("going to add all the adopted Stylesheets for the shadowroot",e);let t="";e.shadowRoot.adoptedStyleSheets.forEach((e=>{for(const o of e.cssRules)t+=o.cssText+"\n"})),r.cssContent=t}r.shadowNodes=this.serializeChildren(e.shadowRoot),this.processSubTree(e.shadowRoot)}return O(e)&&(this.cobrowsableIframes.push(e),ge("now going to recursively serialize children of same-domain iframe",e),this.isIframeLoaded(e)?(ge("looks like this iframe is loaded alright, lets get inside it"),r.iframeChildNodes=this.serializeChildren(e.contentDocument),this.processSubTree(e.contentDocument)):(ge("looks like this iframe is still loading"),e.addEventListener("load",(()=>{ge("NOW this iframe is loaded alright, we are ready to get inside it",e);const t={iframeId:r.id,children:this.serializeChildren(e.contentDocument)};this.processSubTree(e.contentDocument),this.mirror.onLoadedIframe?(ge("calling onLoadedIframe callback"),this.mirror.onLoadedIframe(e,t)):ge("onLoadedIframe callback not setup, not calling")})))),T(e)&&this.treatCssInJsNode(e,r),function(e){const t=e;return!("LINK"!==t.nodeName||"stylesheet"!==t.rel)}(e)&&this.treatLinkedStyleSheets(e),D(e)&&this.treatStyleTag(e),function(e){return"CANVAS"===e.nodeName}(e)&&this.treatCanvas(e,s),L(e)&&(r.rootNodeId=this.getNodeId(e.getRootNode().host),e.__cb_root__=r.rootNodeId),ge("finished serializing node: ",r),r}ge("serialized to no data ",r)}treatStyleTag(e){const t=document.createElement(e.tagName),o=e.ownerDocument.location.href;t.classList.add("genesys-cbx-ignore","genesys-cbx-style"),t.innerHTML=this.proxifier.proxifyCSSRule(e.innerHTML,o),e.after(t)}treatLinkedStyleSheets(e){const t=e.cloneNode();t.classList.add("genesys-cbx-ignore","genesys-cbx-style"),t.crossOrigin="anonymous",this.proxifier.pointToProxy(t),e.after(t),this.proxifier.scheduleCSSProxifying(t)}treatCanvas(e,t){ge("checking if this canvas was already reported",t),this.knownCanvases.includes(t)?ge("this canvas was already reported, skipping"):(ge("this canvas is new, will report it via onCanvas callback",t,e),this.knownCanvases.push(t),setTimeout((()=>{this.mirror.onCanvas&&this.mirror.onCanvas(e,t)}),0))}isIframeLoaded(e){return"<head></head><body></body>"!==e.contentDocument.documentElement.innerHTML}treatCssInJsNode(e,t){let o=t.cssContent;ge("encountered css-in-js node: ",e),ge("it has css:",o),ge("it isConnected:",e.isConnected);const n=this.cssInJsTimers,s=setTimeout((function s(){if(ge("checking for css changes"),!e.isConnected)return;const a=z.getCss(e);a!==o&&(ge(`got css changed from:\n\n${o} \n\nto:\n\nf${a}`),r(i,a),o=a);const l=setTimeout(s,500);n.set(t.id,l)}),500),i=t.id,r=this.applyCssInJsChanged.bind(this);n.set(t.id,s)}serializePreviousSibling(e){var t;ge("looking for previous sibling of node",e);let o=e.previousSibling;for(;o&&this.isIgnored(o);)ge('previous sibling is "ignored", trying next previous sibling',o),o=o.previousSibling;return ge("final previous sibling: ",o),o&&null!==(t=this.serializeNode(o))&&void 0!==t?t:null}serializeAddedAndMoved(e,t,o){ge("serializing added, reparented and reordered nodes: ",e,t,o);const n=e.concat(t).concat(o).filter((e=>!this.isIgnored(e)));ge("added/moved nodes minus ignored nodes: ",n);const s=new I.NodeMap;n.forEach((e=>{const t=e.parentNode;if(null===t)throw new Error("parent node must not be null");let o=s.get(t);o||(o=new I.NodeMap,s.set(t,o)),o.set(e,!0)}));const i=[];return s.keys().forEach((e=>{const t=s.get(e);let o=t.keys();for(;o.length;){let e=o[0];for(;e.previousSibling&&t.has(e.previousSibling);)e=e.previousSibling;let n=e;for(;n&&t.has(n);){e=n,ge("1) serializing node itself",e);const o=this.serializeNode(e);if(o){if(ge("2) adding info about its previous sibling"),o.previousSibling=this.serializePreviousSibling(e),null===e.parentNode)throw new Error("parent node must not be null");ge("3) adding info about its parent");const s=this.serializeNode(oe(e));s&&(o.parentNode=s),e.parentNode&&e.parentNode instanceof ShadowRoot&&(ge("4) node was added to a shadow root, remembering that"),o.shadow=!0),i.push(o),t.delete(e),n=e.nextSibling}}o=t.keys()}})),i}serializeRemoved(e,t){ge("serializing removed nodes",e);const o=[];return e.filter((o=>!this.isRemovedIgnored(o,e,t))).forEach((e=>{const t=this.serializeNode(e);if(t){const n=e;if(n.nodeType!==Node.TEXT_NODE&&n.nodeType!==Node.COMMENT_NODE&&n.hasAttributes()){t.attributes={};for(const e of n.attributes)t.attributes[e.name]=e.value}o.push(t)}})),o}serializeCharacterData(e){return ge("serializing character data: ",e),e.filter((e=>!this.isIgnored(e))).map((e=>{var t,o;const n=this.serializeNode(e);if(n){const s=null!==(t=e.textContent)&&void 0!==t?t:"";ee(e,!0,null===(o=this.config)||void 0===o?void 0:o.masking)?n.textContent=F(s):n.textContent=H(s)}return n}))}serializeAttributeChanges(e){const t=new I.NodeMap;return ge("serializing attribute changes",e),Object.keys(e).forEach((o=>{e[o].filter((e=>!this.isIgnored(e))).forEach((e=>{let n=t.get(e);n||(n=this.serializeNode(e),n.attributes={},t.set(e,n)),"gcobrowse-draw-active"!=e.getAttribute(o)&&(n.attributes[o]=e.getAttribute(o))}))})),t.keys().map((e=>t.get(e)))}serializeValueChanged(e){if(this.isIgnored(e))return null;const t=this.nodeToId.get(e);if(void 0===t)throw new Error("cannot serialize unknown node");return{id:t,value:H(e.value)}}serializeMaskedValueChanged(e){if(this.isIgnored(e))return null;const t=this.nodeToId.get(e);if(void 0===t)throw new Error("cannot serialize unknown node");return{id:t,value:F(e.value)}}serializeCheckedChanged(e){if(this.isIgnored(e))return null;const t=this.nodeToId.get(e);if(void 0===t)throw new Error("cannot serialize unknown node");return{id:t,checked:e.checked}}serializeSelectedIndex(e){if(this.isIgnored(e))return null;const t=this.nodeToId.get(e);if(void 0===t)throw new Error("cannot serialize unknown node");return{id:t,index:e.selectedIndex}}applySelectChanged(e){const t=this.serializeSelectedIndex(e);t&&this.mirror.applySelectChanged&&this.mirror.applySelectChanged([t])}applyValueChanged(e){const t=this.serializeValueChanged(e);t&&this.mirror.applyValueChanged&&this.mirror.applyValueChanged([t])}applyMaskedValueChanged(e){const t=this.serializeMaskedValueChanged(e);t&&this.mirror.applyValueChanged&&this.mirror.applyValueChanged([t])}applyCheckedChanged(e){const t=this.serializeCheckedChanged(e);t&&this.mirror.applyCheckedChanged&&this.mirror.applyCheckedChanged([t])}applyCssInJsChanged(e,t){this.mirror.applyCssInJsChanged&&this.mirror.applyCssInJsChanged({id:e,cssContent:t})}isIgnored(e){if(ge('checking if a node is "ignored"',e),0===this.ignoredSelectors.length)return!1;for(const t of this.ignoredSelectors){const o=e;if(o.nodeType===Node.ELEMENT_NODE&&o.matches(t))return ge("yes, node matches ignored selector"),!0;if(pe(o,t))return ge("yes, node is a child of ignored node"),!0}return ge("no, node is not ignored"),!1}isRemovedIgnored(e,t,o){const n=o(me(e,t));return ge("checking if deleted node should be ignored by its non-deleted ancestor:",n),this.isIgnored(n)}hasRottenRoot(e){const t=e.getRootNode(),o=e;return!(!(t instanceof ShadowRoot&&L(e))||t instanceof ShadowRoot&&this.getNodeId(t.host)===o.__cb_root__)}applyChanged(e){try{const t=this.serializeRemoved(e.removed,e.getOldParentNode.bind(e));ge("serialized removed nodes: ",t);const o=this.serializeAddedAndMoved(e.added,e.reparented,e.reordered);ge("serialized added and moved nodes: ",o);const n=this.serializeAttributeChanges(e.attributeChanged);ge("serialized attribute changes: ",n);const s=this.serializeCharacterData(e.characterDataChanged);ge("serialized text changes: ",s),(t.length||o.length||n.length||s.length)&&this.mirror.applyChanged(t,o,n,s),e.removed.forEach((e=>{this.hasRottenRoot(e)||this.forgetNode(e)}))}catch(e){ge("Applying Change failed",e)}}}class fe{constructor(e,t,o){var n;this.rootElement=e,this.env=t,this.config=o;let s=["script",'input[type="hidden"]',".genesys-cbx-ignore"];(null===(n=this.config)||void 0===n?void 0:n.ignore.length)&&(s=s.concat(this.config.ignore)),this.config={ignore:s}}takeSnapshot(e,t,o){let n=[];const s={initialize:function(e,t){n=t},applyChanged:()=>{}};return e&&this.config&&(this.config.masking=e),t&&this.config&&(this.config.readonly=t),o&&this.config&&(this.config.maskingRegexps=o),this.treeMirrorClient=new ve(this.rootElement,s,[],this.env,this.config),n}onLoadedIframe(e){if(!this.treeMirrorClient)throw new Error("Call serializeDom() before calling onLoadedIframe");this.treeMirrorClient.mirror.onLoadedIframe=e}onChange(e){if(!this.treeMirrorClient)throw new Error("Call serializeDom() before calling onChange");this.treeMirrorClient.mirror.applyChanged=function(t,o,n,s){const i={};t.length&&(i.removed=t),o.length&&(i.moved=o),n.length&&(i.attributes=n),s.length&&(i.text=s),e(i)},this.treeMirrorClient.mirror.applyValueChanged=t=>{e({values:t})},this.treeMirrorClient.mirror.applyCheckedChanged=t=>{e({checked:t})},this.treeMirrorClient.mirror.applySelectChanged=t=>{e({selected:t})},this.treeMirrorClient.mirror.applyCssInJsChanged=t=>{e({cssInJs:t})}}onCanvas(e){if(!this.treeMirrorClient)throw new Error("Call serializeDom() before calling onCanvas");this.treeMirrorClient.mirror.onCanvas=e}disconnect(){this.treeMirrorClient&&this.treeMirrorClient.disconnect()}getCobrowsableIframes(){return this.treeMirrorClient?this.treeMirrorClient.cobrowsableIframes:[]}getNodeId(e){if(this.treeMirrorClient)return this.treeMirrorClient.getNodeId(e);throw new Error("trying to get node id while mirroring is not initialized")}isSynchronized(e){return!!this.treeMirrorClient&&this.treeMirrorClient.isSynchronized(e)}getNodeById(e){if(this.treeMirrorClient)return this.treeMirrorClient.getNodeById(e);throw new Error("trying to get node by id while mirroring is not initialized")}isIgnored(e){return e.classList.contains("genesys-cbx-ignore")}}class be{constructor(e,t=""){this.core=e,this.log=e.createLogger(t),this.events=e.events,this.notify=e.pubsub.notify.bind(e.pubsub),this.listen=e.pubsub.listen.bind(e.pubsub)}clearEventListeners(){throw new Error("Not implemented!")}getRootUIElement(){return this.core.getRootUIElement()}getWindow(){return this.core.getWindow()}getRole(){return this.core.getRole()}exposeGlobalVariable(e,t){return this.core.exposeGlobalVariable(e,t)}reloadWindow(){return this.core.reloadWindow()}getDOMRoot(){return this.core.getDOMRoot()}getWorkRootUIElement(){return this.core.getWorkRootUIElement()}getWorkWindow(){return this.core.getWorkWindow()}setDeploymentOptions(e){this.core.setDeploymentOptions(e)}getDeploymentOptions(){return this.core.getDeploymentOptions()}geti18n(){return this.core.geti18n()}getFontsURL(){return this.core.getFontsURL()}loadi18n(){return r(this,void 0,void 0,(function*(){return yield this.core.loadi18n()}))}getPrimaryColor(){return this.core.getPrimaryColor()}getAssetsURL(){return this.core.getAssetsURL()}getDeploymentId(){return this.core.getDeploymentId()}sendMessageToWebDirectory(e){return this.core.sendMessageToWebDirectory(e)}}class ye extends be{constructor(e,t=""){super(e,t),this.dom=e.dom,this.network=e.network,this.storage=e.storage,this.getInstrumentedDocument=e.getInstrumentedDocument.bind(e),this.canvas=e.canvas}}const we=window.localStorage,Ee="__genesys_cobrowse_n__";class Se{set(e,t){we.setItem(`${Ee}${e}`,t)}get(e){return we.getItem(`${Ee}${e}`)}remove(e){we.removeItem(`${Ee}${e}`)}}class Ce extends Se{constructor({clientRole:e}){super(),this.userIdKey=`${e}_user_id`,this.websocketUrlKey="websocket_url"}putSharerId(e){this.set(this.userIdKey,e)}getSharerId(){var e;return null!==(e=this.get(this.userIdKey))&&void 0!==e?e:void 0}removeSharerId(){this.remove(this.userIdKey)}putViewerIdForSession(e,t){this.set(`${this.userIdKey}_session_${e}`,t)}getViewerIdForSession(e){var t;return null!==(t=this.get(`${this.userIdKey}_session_${e}`))&&void 0!==t?t:void 0}removeViewerIdForSession(e){this.remove(`${this.userIdKey}_session_${e}`)}setWebSocketUrl(e){this.set(this.websocketUrlKey,e)}getWebSocketUrl(){var e;return null!==(e=this.get(this.websocketUrlKey))&&void 0!==e?e:void 0}removeWebSocketUrl(){this.remove(this.websocketUrlKey)}}var xe={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,o="~";function n(){}function s(e,t,o){this.fn=e,this.context=t,this.once=o||!1}function i(e,t,n,i,r){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,i||e,r),l=o?o+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function r(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(o=!1)),a.prototype.eventNames=function(){var e,n,s=[];if(0===this._eventsCount)return s;for(n in e=this._events)t.call(e,n)&&s.push(o?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},a.prototype.listeners=function(e){var t=o?o+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,i=n.length,r=new Array(i);s<i;s++)r[s]=n[s].fn;return r},a.prototype.listenerCount=function(e){var t=o?o+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,s,i,r){var a=o?o+e:e;if(!this._events[a])return!1;var l,d,c=this._events[a],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,s),!0;case 5:return c.fn.call(c.context,t,n,s,i),!0;case 6:return c.fn.call(c.context,t,n,s,i,r),!0}for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c.fn.apply(c.context,l)}else{var u,g=c.length;for(d=0;d<g;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),h){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,n);break;case 4:c[d].fn.call(c[d].context,t,n,s);break;default:if(!l)for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c[d].fn.apply(c[d].context,l)}}return!0},a.prototype.on=function(e,t,o){return i(this,e,t,o,!1)},a.prototype.once=function(e,t,o){return i(this,e,t,o,!0)},a.prototype.removeListener=function(e,t,n,s){var i=o?o+e:e;if(!this._events[i])return this;if(!t)return r(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||s&&!a.once||n&&a.context!==n||r(this,i);else{for(var l=0,d=[],c=a.length;l<c;l++)(a[l].fn!==t||s&&!a[l].once||n&&a[l].context!==n)&&d.push(a[l]);d.length?this._events[i]=1===d.length?d[0]:d:r(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=o?o+e:e,this._events[t]&&r(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=o,a.EventEmitter=a,e.exports=a}(xe);var ke=xe.exports,Ie=new RegExp("^((?:\\d+)?\\.?\\d+) *("+["milliseconds?","msecs?","ms","seconds?","secs?","s","minutes?","mins?","m","hours?","hrs?","h","days?","d","weeks?","wks?","w","years?","yrs?","y"].join("|")+")?$","i"),Te=36e5,De=24*Te,Le=function(e){var t,o,n=typeof e;if("number"===n)return e;if("string"!==n||"0"===e||!e)return 0;if(+e)return+e;if(e.length>1e4||!(o=Ie.exec(e)))return 0;switch(t=parseFloat(o[1]),o[2].toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 31536e6*t;case"weeks":case"week":case"wks":case"wk":case"w":return 6048e5*t;case"days":case"day":case"d":return t*De;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Te;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*t;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*t;default:return t}},Oe=Object.prototype.hasOwnProperty,Ne=Le;function Re(e,t,o,n){this.start=+new Date,this.duration=o,this.clear=t,this.timer=e,this.fns=[n]}function Me(e){clearTimeout(e)}function Ae(e){clearInterval(e)}function _e(e){clearImmediate(e)}function Pe(e){if(!(this instanceof Pe))return new Pe(e);this.timers={},this.context=e||this}Re.prototype.remaining=function(){return this.duration-this.taken()},Re.prototype.taken=function(){return+new Date-this.start},Pe.prototype.tock=function(e,t){var o=this;return function(){if(e in o.timers){var n=o.timers[e].fns.slice(),s=n.length,i=0;for(t?o.clear(e):o.start=+new Date;i<s;i++)n[i].call(o.context)}}},Pe.prototype.setTimeout=function(e,t,o){var n,s=this;return s.timers[e]?(s.timers[e].fns.push(t),s):(n=Ne(o),s.timers[e]=new Re(setTimeout(s.tock(e,!0),Ne(o)),Me,n,t),s)},Pe.prototype.setInterval=function(e,t,o){var n,s=this;return s.timers[e]?(s.timers[e].fns.push(t),s):(n=Ne(o),s.timers[e]=new Re(setInterval(s.tock(e),Ne(o)),Ae,n,t),s)},Pe.prototype.setImmediate=function(e,t){var o=this;return"function"!=typeof setImmediate?o.setTimeout(e,t,0):o.timers[e]?(o.timers[e].fns.push(t),o):(o.timers[e]=new Re(setImmediate(o.tock(e,!0)),_e,0,t),o)},Pe.prototype.active=function(e){return e in this.timers},Pe.prototype.clear=function(){var e,t,o,n=arguments.length?arguments:[],s=this;if(1===n.length&&"string"==typeof n[0]&&(n=n[0].split(/[, ]+/)),!n.length)for(e in s.timers)Oe.call(s.timers,e)&&n.push(e);for(t=0,o=n.length;t<o;t++)(e=s.timers[n[t]])&&(e.clear(e.timer),e.fns=e.timer=e.clear=null,delete s.timers[n[t]]);return s},Pe.prototype.adjust=function(e,t){var o,n=this,s=Ne(t),i=n.timers[e];return i?(o=i.clear===Ae,i.clear(i.timer),i.start=+new Date,i.duration=s,i.timer=(o?setInterval:setTimeout)(n.tock(e,!o),s),n):n},Pe.prototype.end=Pe.prototype.destroy=function(){return!!this.context&&(this.clear(),this.context=this.timers=null,!0)},Pe.Timer=Re;var Ue=Pe,je={exports:{}};!function(e){var t="function"!=typeof Object.create&&"~";function o(e,t,o){this.fn=e,this.context=t,this.once=o||!1}function n(){}n.prototype._events=void 0,n.prototype.listeners=function(e,o){var n=t?t+e:e,s=this._events&&this._events[n];if(o)return!!s;if(!s)return[];if(s.fn)return[s.fn];for(var i=0,r=s.length,a=new Array(r);i<r;i++)a[i]=s[i].fn;return a},n.prototype.emit=function(e,o,n,s,i,r){var a=t?t+e:e;if(!this._events||!this._events[a])return!1;var l,d,c=this._events[a],h=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,o),!0;case 3:return c.fn.call(c.context,o,n),!0;case 4:return c.fn.call(c.context,o,n,s),!0;case 5:return c.fn.call(c.context,o,n,s,i),!0;case 6:return c.fn.call(c.context,o,n,s,i,r),!0}for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c.fn.apply(c.context,l)}else{var u,g=c.length;for(d=0;d<g;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),h){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,o);break;case 3:c[d].fn.call(c[d].context,o,n);break;default:if(!l)for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c[d].fn.apply(c[d].context,l)}}return!0},n.prototype.on=function(e,n,s){var i=new o(n,s||this),r=t?t+e:e;return this._events||(this._events=t?{}:Object.create(null)),this._events[r]?this._events[r].fn?this._events[r]=[this._events[r],i]:this._events[r].push(i):this._events[r]=i,this},n.prototype.once=function(e,n,s){var i=new o(n,s||this,!0),r=t?t+e:e;return this._events||(this._events=t?{}:Object.create(null)),this._events[r]?this._events[r].fn?this._events[r]=[this._events[r],i]:this._events[r].push(i):this._events[r]=i,this},n.prototype.removeListener=function(e,o,n,s){var i=t?t+e:e;if(!this._events||!this._events[i])return this;var r=this._events[i],a=[];if(o)if(r.fn)(r.fn!==o||s&&!r.once||n&&r.context!==n)&&a.push(r);else for(var l=0,d=r.length;l<d;l++)(r[l].fn!==o||s&&!r[l].once||n&&r[l].context!==n)&&a.push(r[l]);return a.length?this._events[i]=1===a.length?a[0]:a:delete this._events[i],this},n.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[t?t+e:e]:this._events=t?{}:Object.create(null),this):this},n.prototype.off=n.prototype.removeListener,n.prototype.addListener=n.prototype.on,n.prototype.setMaxListeners=function(){return this},n.prefixed=t,e.exports=n}(je);var ze=function(e,t){var o=/[, ]+/;function n(e,n){if(t[e]){if("string"==typeof t[e]&&(t[e]=t[e].split(o)),"function"==typeof t[e])return t[e].call(n);for(var s,i,r=0;r<t[e].length;r++)"function"===(s=typeof(i=t[e][r]))?i.call(n):"string"===s&&"function"==typeof n[i]&&n[i]()}}return t=t||{},"string"==typeof(e=e||[])&&(e=e.split(o)),function(){var t,o=this,s=0;if(null===o[e[0]])return!1;for(n("before",o);s<e.length;s++)o[t=e[s]]&&("function"==typeof o[t].destroy&&o[t].destroy(),o[t]=null);return o.emit&&o.emit("destroy"),n("after",o),!0}},Ve=je.exports,$e=Le,Be=ze,qe=Ue,We=function(e){var t,o=0;function n(){return o||(o=1,t=e.apply(this,arguments),e=null),t}return n.displayName=e.displayName||e.name||n.displayName||n.name,n};function He(e,t,o){return $e(e in o?o[e]:e in t?t[e]:Fe[e])}function Fe(e){var t=this;if(!(t instanceof Fe))return new Fe(e);e=e||{},t.attempt=null,t._fn=null,t["reconnect timeout"]=He("reconnect timeout",t,e),t.retries=He("retries",t,e),t.factor=He("factor",t,e),t.max=He("max",t,e),t.min=He("min",t,e),t.timers=new qe(t)}Fe.prototype=new Ve,Fe.prototype.constructor=Fe,Fe["reconnect timeout"]="30 seconds",Fe.max=1/0,Fe.min="500 ms",Fe.retries=10,Fe.factor=2,Fe.prototype.reconnect=function(){var e=this;return e.backoff((function(t,o){if(o.duration=+new Date-o.start,t)return e.emit("reconnect failed",t,o);e.emit("reconnected",o)}),e.attempt)},Fe.prototype.backoff=function(e,t){var o=this;return(t=t||o.attempt||{}).backoff?o:(t["reconnect timeout"]=He("reconnect timeout",o,t),t.retries=He("retries",o,t),t.factor=He("factor",o,t),t.max=He("max",o,t),t.min=He("min",o,t),t.start=+t.start||+new Date,t.duration=+t.duration||0,t.attempt=+t.attempt||0,t.attempt===t.retries?(e.call(o,new Error("Unable to recover"),t),o):(t.backoff=!0,t.attempt++,o.attempt=t,t.scheduled=1!==t.attempt?Math.min(Math.round((Math.random()+1)*t.min*Math.pow(t.factor,t.attempt-1)),t.max):t.min,o.timers.setTimeout("reconnect",(function(){t.duration=+new Date-t.start,t.backoff=!1,o.timers.clear("reconnect, timeout");var n=o._fn=We((function(n){if(o.reset(),n)return o.backoff(e,t);e.call(o,void 0,t)}));o.emit("reconnect",t,n),o.timers.setTimeout("timeout",(function(){var e=new Error("Failed to reconnect in a timely manner");t.duration=+new Date-t.start,o.emit("reconnect timeout",e,t),n(e)}),t["reconnect timeout"])}),t.scheduled),o.emit("reconnect scheduled",t),o))},Fe.prototype.reconnecting=function(){return!!this.attempt},Fe.prototype.reconnected=function(e){return this._fn&&this._fn(e),this},Fe.prototype.reset=function(){return this._fn=this.attempt=null,this.timers.clear("reconnect, timeout"),this},Fe.prototype.destroy=Be("timers attempt _fn");var Ge=Fe,Ye=Object.prototype.hasOwnProperty;function Ke(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function Xe(e){try{return encodeURIComponent(e)}catch(e){return null}}var Je,Ze=function(e,t){t=t||"";var o,n,s=[];for(n in"string"!=typeof t&&(t="?"),e)if(Ye.call(e,n)){if((o=e[n])||null!=o&&!isNaN(o)||(o=""),n=Xe(n),o=Xe(o),null===n||null===o)continue;s.push(n+"="+o)}return s.length?t+s.join("&"):""},Qe=function(e){for(var t,o=/([^=?#&]+)=?([^&]*)/g,n={};t=o.exec(e);){var s=Ke(t[1]),i=Ke(t[2]);null===s||null===i||s in n||(n[s]=i)}return n},et="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var o=function(){};o.prototype=t.prototype,e.prototype=new o,e.prototype.constructor=e},tt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ot=64,nt={},st=0,it=0;function rt(e){var t="";do{t=tt[e%ot]+t,e=Math.floor(e/ot)}while(e>0);return t}function at(){var e=rt(+new Date);return e!==Je?(st=0,Je=e):e+"."+rt(st++)}for(;it<ot;it++)nt[tt[it]]=it;at.encode=rt,at.decode=function(e){var t=0;for(it=0;it<e.length;it++)t=t*ot+nt[e.charAt(it)];return t};var lt,dt=at,ct=/\u2028/g,ht=/\u2029/g;function ut(e,t){if(!(e instanceof gt)){var o=new Error("Primus#"+t+"'s context should called with a Primus instance");if("function"!=typeof e.listeners||!e.listeners("error").length)throw o;e.emit("error",o)}}try{lt=location.origin?location.origin:location.protocol+"//"+location.host}catch(e){lt="http://127.0.0.1"}function gt(e,t){if(!(this instanceof gt))return new gt(e,t);if(gt.Stream.call(this),"function"!=typeof this.client)return this.critical(new Error("The client library has not been compiled correctly, see https://github.com/primus/primus#client-library for more details"));if("object"==typeof e?e=(t=e).url||t.uri||lt:t=t||{},"ping"in t||"pong"in t)return this.critical(new Error("The `ping` and `pong` options have been removed"));var o=this;t.queueSize="queueSize"in t?t.queueSize:1/0,t.timeout="timeout"in t?t.timeout:1e4,t.reconnect="reconnect"in t?t.reconnect:{},t.pingTimeout="pingTimeout"in t?t.pingTimeout:45e3,t.strategy="strategy"in t?t.strategy:[],t.transport="transport"in t?t.transport:{},o.buffer=[],o.writable=!0,o.readable=!0,o.url=new URL(e||lt),o.readyState=gt.CLOSED,o.options=t,o.timers=new Ue(this),o.socket=null,o.disconnect=!1,o.transport=t.transport,o.transformers={outgoing:[],incoming:[]},o.recovery=new Ge(t.reconnect),"string"==typeof t.strategy&&(t.strategy=t.strategy.split(/\s?,\s?/g)),!1===t.strategy?t.strategy=[]:t.strategy.length||(t.strategy.push("disconnect","online"),this.authorization||t.strategy.push("timeout")),t.strategy=t.strategy.join(",").toLowerCase(),"websockets"in t&&(o.AVOID_WEBSOCKETS=!t.websockets),"network"in t&&(o.NETWORK_EVENTS=t.network),t.manual||o.timers.setTimeout("open",(function(){o.timers.clear("open"),o.open()}),0),o.initialise(t)}gt.requires=gt.require=function(e){if("function"==typeof require)return"function"==typeof define&&define.amd?void 0:require(e)};try{gt.Stream=gt.requires("stream")}catch(e){}gt.Stream||(gt.Stream=ke),et(gt,gt.Stream),gt.OPENING=1,gt.CLOSED=2,gt.OPEN=3,gt.prototype.AVOID_WEBSOCKETS=!1,gt.prototype.NETWORK_EVENTS=!1,gt.prototype.online=!0;try{(gt.prototype.NETWORK_EVENTS="onLine"in navigator&&(window.addEventListener||document.body.attachEvent))&&(navigator.onLine||(gt.prototype.online=!1))}catch(e){}if(gt.prototype.ark={},gt.prototype.emits=function(){for(var e,t=this,o=0,n=arguments.length,s=new Array(n);o<n;o++)s[o]=arguments[o];return"function"!=typeof s[s.length-1]?function(){for(var e=0,o=arguments.length,n=new Array(o);e<o;e++)n[e]=arguments[e];return t.emit.apply(t,s.concat(n))}:(e=s.pop(),function(){for(var o=0,n=arguments.length,i=new Array(n+1);o<n;o++)i[o+1]=arguments[o];return i[0]=function(e,o){if(e)return t.emit("error",e);i=void 0===o?i.slice(1):null===o?[]:o,t.emit.apply(t,s.concat(i))},e.apply(t,i),!0})},gt.prototype.plugin=function(e){if(ut(this,"plugin"),e)return this.ark[e];var t={};for(e in this.ark)t[e]=this.ark[e];return t},gt.prototype.reserved=function(e){return/^(incoming|outgoing)::/.test(e)||e in this.reserved.events},gt.prototype.reserved.events={"reconnect scheduled":1,"reconnect timeout":1,readyStateChange:1,"reconnect failed":1,reconnected:1,reconnect:1,offline:1,timeout:1,destroy:1,online:1,error:1,close:1,open:1,data:1,end:1},gt.prototype.initialise=function(e){var t=this;for(var o in t.recovery.on("reconnected",t.emits("reconnected")).on("reconnect failed",t.emits("reconnect failed",(function(e){t.emit("end"),e()}))).on("reconnect timeout",t.emits("reconnect timeout")).on("reconnect scheduled",t.emits("reconnect scheduled")).on("reconnect",t.emits("reconnect",(function(e){t.emit("outgoing::reconnect"),e()}))),t.on("outgoing::open",(function(){var e=t.readyState;t.readyState=gt.OPENING,e!==t.readyState&&t.emit("readyStateChange","opening")})),t.on("incoming::open",(function(){var e=t.readyState;if(t.recovery.reconnecting()&&t.recovery.reconnected(),t.writable=!0,t.readable=!0,t.online||(t.online=!0,t.emit("online")),t.readyState=gt.OPEN,e!==t.readyState&&t.emit("readyStateChange","open"),t.heartbeat(),t.buffer.length){var o=t.buffer.slice(),n=o.length,s=0;for(t.buffer.length=0;s<n;s++)t._write(o[s])}t.emit("open")})),t.on("incoming::ping",(function(e){t.online=!0,t.heartbeat(),t.emit("outgoing::pong",e),t._write("primus::pong::"+e)})),t.on("incoming::error",(function(e){var o=t.timers.active("connect"),n=e;if("string"==typeof e)n=new Error(e);else if(!(e instanceof Error)&&"object"==typeof e)for(var s in n=new Error(e.message||e.reason),e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s]);if(t.recovery.reconnecting())return t.recovery.reconnected(n);t.listeners("error").length&&t.emit("error",n),o&&(~t.options.strategy.indexOf("timeout")?t.recovery.reconnect():t.end())})),t.on("incoming::data",(function(e){t.decoder(e,(function(o,n){if(o)return t.listeners("error").length&&t.emit("error",o);t.protocol(n)||t.transforms(t,t,"incoming",n,e)}))})),t.on("incoming::end",(function(){var e=t.readyState;return t.disconnect?(t.disconnect=!1,t.end()):(t.readyState=gt.CLOSED,e!==t.readyState&&t.emit("readyStateChange","end"),t.timers.active("connect")&&t.end(),e!==gt.OPEN?!!t.recovery.reconnecting()&&t.recovery.reconnect():(this.writable=!1,this.readable=!1,this.timers.clear(),t.emit("close"),~t.options.strategy.indexOf("disconnect")?t.recovery.reconnect():(t.emit("outgoing::end"),void t.emit("end"))))})),t.client(),t.ark)t.ark[o].call(t,t,e);return t.NETWORK_EVENTS?(t.offlineHandler=function(){t.online&&(t.online=!1,t.emit("offline"),t.end(),t.recovery.reset())},t.onlineHandler=function(){t.online||(t.online=!0,t.emit("online"),~t.options.strategy.indexOf("online")&&t.recovery.reconnect())},window.addEventListener?(window.addEventListener("offline",t.offlineHandler,!1),window.addEventListener("online",t.onlineHandler,!1)):document.body.attachEvent&&(document.body.attachEvent("onoffline",t.offlineHandler),document.body.attachEvent("ononline",t.onlineHandler)),t):t},gt.prototype.protocol=function(e){if("string"!=typeof e||0!==e.indexOf("primus::"))return!1;var t=e.indexOf(":",8),o=e.slice(t+2);switch(e.slice(8,t)){case"ping":this.emit("incoming::ping",+o);break;case"server":"close"===o&&(this.disconnect=!0);break;case"id":this.emit("incoming::id",o);break;default:return!1}return!0},gt.prototype.transforms=function(e,t,o,n,s){var i={data:n},r=e.transformers[o];return function e(o,n){var s=r[o++];if(!s)return n();if(1===s.length){if(!1===s.call(t,i))return;return e(o,n)}s.call(t,i,(function(s,i){if(s)return t.emit("error",s);!1!==i&&e(o,n)}))}(0,(function(){if("incoming"===o)return t.emit("data",i.data,s);t._write(i.data)})),this},gt.prototype.id=function(e){return this.socket&&this.socket.id?e(this.socket.id):(this._write("primus::id::"),this.once("incoming::id",e))},gt.prototype.open=function(){return ut(this,"open"),!this.recovery.reconnecting()&&this.options.timeout&&this.timeout(),this.emit("outgoing::open"),this},gt.prototype.write=function(e){return ut(this,"write"),this.transforms(this,this,"outgoing",e),!0},gt.prototype._write=function(e){var t=this;return gt.OPEN!==t.readyState?(this.buffer.length===this.options.queueSize&&this.buffer.splice(0,1),this.buffer.push(e),!1):(t.encoder(e,(function(e,o){if(e)return t.listeners("error").length&&t.emit("error",e);"string"==typeof o&&(~o.indexOf("\u2028")&&(o=o.replace(ct,"\\u2028")),~o.indexOf("\u2029")&&(o=o.replace(ht,"\\u2029"))),t.emit("outgoing::data",o)})),!0)},gt.prototype.heartbeat=function(){return this.options.pingTimeout?(this.timers.clear("heartbeat"),this.timers.setTimeout("heartbeat",(function(){this.online&&(this.online=!1,this.emit("offline"),this.emit("incoming::end"))}),this.options.pingTimeout),this):this},gt.prototype.timeout=function(){var e=this;function t(){e.removeListener("error",t).removeListener("open",t).removeListener("end",t).timers.clear("connect")}return e.timers.setTimeout("connect",(function(){t(),e.readyState===gt.OPEN||e.recovery.reconnecting()||(e.emit("timeout"),~e.options.strategy.indexOf("timeout")?e.recovery.reconnect():e.end())}),e.options.timeout),e.on("error",t).on("open",t).on("end",t)},gt.prototype.end=function(e){if(ut(this,"end"),this.readyState===gt.CLOSED&&!this.timers.active("connect")&&!this.timers.active("open"))return this.recovery.reconnecting()&&(this.recovery.reset(),this.emit("end")),this;void 0!==e&&this.write(e),this.writable=!1,this.readable=!1;var t=this.readyState;return this.readyState=gt.CLOSED,t!==this.readyState&&this.emit("readyStateChange","end"),this.timers.clear(),this.emit("outgoing::end"),this.emit("close"),this.emit("end"),this},gt.prototype.destroy=ze("url timers options recovery socket transport transformers",{before:"end",after:["removeAllListeners",function(){this.NETWORK_EVENTS&&(window.addEventListener?(window.removeEventListener("offline",this.offlineHandler),window.removeEventListener("online",this.onlineHandler)):document.body.attachEvent&&(document.body.detachEvent("onoffline",this.offlineHandler),document.body.detachEvent("ononline",this.onlineHandler)))}]}),gt.prototype.clone=function(e){return this.merge({},e)},gt.prototype.merge=function(e){for(var t,o,n=1;n<arguments.length;n++)for(t in o=arguments[n])Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t]);return e},gt.prototype.querystring=Qe,gt.prototype.querystringify=Ze,gt.prototype.uri=function(e){var t=this.url,o=[],n=!1;e.query&&(n=!0),(e=e||{}).protocol="protocol"in e?e.protocol:"http:",e.query=!(!t.search||!n)&&t.search.slice(1),e.secure="secure"in e?e.secure:"https:"===t.protocol||"wss:"===t.protocol,e.auth="auth"in e?e.auth:t.auth,e.pathname="pathname"in e?e.pathname:this.pathname,e.port="port"in e?+e.port:+t.port||(e.secure?443:80);var s=this.querystring(e.query||"");return s._primuscb=dt(),e.query=this.querystringify(s),this.emit("outgoing::url",e),o.push(e.secure?e.protocol.replace(":","s:"):e.protocol,""),o.push(e.auth?e.auth+"@"+t.host:t.host),e.pathname&&o.push(e.pathname.slice(1)),n?o[o.length-1]+="?"+e.query:delete e.query,e.object?e:o.join("/")},gt.prototype.transform=function(e,t){return ut(this,"transform"),e in this.transformers?(this.transformers[e].push(t),this):this.critical(new Error("Invalid transformer type"))},gt.prototype.critical=function(e){if(this.emit("error",e))return this;throw e},gt.connect=function(e,t){return new gt(e,t)},gt.EventEmitter=ke,gt.prototype.client=function(){var e,t=this,o=function(){if("undefined"!=typeof WebSocket)return WebSocket;if("undefined"!=typeof MozWebSocket)return MozWebSocket;try{return gt.requires("ws")}catch(e){}}();if(!o)return t.critical(new Error("Missing required `ws` module. Please run `npm install --save ws`"));t.on("outgoing::open",(function(){t.emit("outgoing::end");try{var n={protocol:"ws+unix:"===t.url.protocol?"ws+unix:":"ws:",query:!0};3===o.length?("ws+unix:"===n.protocol&&(n.pathname="/"+t.url.hostname+t.url.pathname+":"+t.pathname),t.socket=e=new o(t.uri(n),[],t.transport)):(t.socket=e=new o(t.uri(n)),e.binaryType="arraybuffer")}catch(e){return t.emit("error",e)}e.onopen=t.emits("incoming::open"),e.onerror=t.emits("incoming::error"),e.onclose=t.emits("incoming::end"),e.onmessage=t.emits("incoming::data",(function(e,t){e(void 0,t.data)}))})),t.on("outgoing::data",(function(n){if(e&&e.readyState===o.OPEN)try{e.send(n)}catch(e){t.emit("incoming::error",e)}})),t.on("outgoing::reconnect",(function(){t.emit("outgoing::open")})),t.on("outgoing::end",(function(){e&&(e.onerror=e.onopen=e.onclose=e.onmessage=function(){},e.close(),e=null)}))},gt.prototype.authorization=!1,gt.prototype.pathname="/cobrowse",gt.prototype.encoder=function(e,t){var o;try{e=JSON.stringify(e)}catch(e){o=e}t(o,e)},gt.prototype.decoder=function(e,t){var o;if("string"!=typeof e)return t(o,e);try{e=JSON.parse(e)}catch(e){o=e}t(o,e)},gt.prototype.version="8.0.5","undefined"!=typeof document&&"undefined"!=typeof navigator){document.addEventListener&&document.addEventListener("keydown",(function(e){27===e.keyCode&&e.preventDefault&&e.preventDefault()}),!1);var pt=(navigator.userAgent||"").toLowerCase(),mt=pt.match(/.+(?:rv|it|ra|ie)[/: ](\d+)\.(\d+)(?:\.(\d+))?/)||[],vt=+[mt[1],mt[2]].join(".");!~pt.indexOf("chrome")&&~pt.indexOf("safari")&&vt<534.54&&(gt.prototype.AVOID_WEBSOCKETS=!0)}function ft(e,t,o,n){return new(o||(o=Promise))((function(s,i){function r(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))}gt.prototype.ark.emit=function(e){var t=Object.prototype.toString,o=e.emit;e.transform("incoming",(function(n){var s=n.data;if(this===e&&"object"==typeof s&&~t.call(s.emit).indexOf(" Array]"))return this.reserved(s.emit[0])||o.apply(e,s.emit),!1})),e.emit=function(t){return e.reserved(t)||"newListener"===t||"removeListener"===t?o.apply(this,arguments):(e.write({emit:Array.prototype.slice.call(arguments,0)}),!0)}},"function"==typeof SuppressedError&&SuppressedError;const bt={reconnect:{retries:30,max:4e3,min:500}};class yt{constructor(e,t,o){this.networkPromiseTimeout=5e3,this.id=o,this.role=t,this.apiUrl=e,this.handlersMap=new Map,this.connected=!1}setWebsocketUrl(e){this.websocketUrl=e}subscribe(e,t){var o;this.handlersMap.get(e)||this.handlersMap.set(e,[]),null===(o=this.handlersMap.get(e))||void 0===o||o.push(t)}send(e,t){if(!this.socket)throw new Error("Trying to send data before connection is open");if(!e)throw new Error("Please define a topic for sending data");if(!this.connected)throw new Error("Trying to send data before connecting");this.socket.emit("cb:data",{topic:e,data:t})}close(){this.connected=!1,this._clearId(),this.socket&&(this.socket.end(),this.socket=void 0)}_dataHandler(e){const t=e,o=this.handlersMap.get(t.topic);o?o.forEach((e=>{var o;e(null!==(o=t.data)&&void 0!==o?o:{})})):this.log(`got message with topic "${t.topic}" but can't find handler for it, ${JSON.stringify(t)}`)}_errorHandler(e){const t=e;this.log(`Error ${t.code}: ${t.message}`),this._dataHandler({topic:t.code,data:t.message})}_connect(e){return ft(this,void 0,void 0,(function*(){if(this.connected)this.log(`User ${String(this._id())} is already connected. Role: ${this.role}.`);else try{this.socket=this.createSocket(null!=e?e:bt),yield this.registerSocketEventHandlers()}catch(e){throw this.log("Error connecting: ",e),(this.connected||this.socket)&&this.close(),e}}))}registerSocketEventHandlers(){return ft(this,void 0,void 0,(function*(){const e=new Promise((e=>{if(!this.socket)throw new Error("Socket should be created before connecting");this.socket.on("open",(()=>ft(this,void 0,void 0,(function*(){if(yield this.awaitConnectionAcknowledged(),!this.socket)throw new Error("Socket should have been created");this.socket.on("cb:error",(e=>{this.log("got cb:error",e)})),this.socket.on("error",(e=>{this.log("got error",e)})),this.socket.on("close",(()=>{this.log("socket has been closed")})),this.socket.on("reconnect",(()=>{this.log("Reconnection attempt started")})),this.socket.on("reconnect scheduled",(e=>{const t=e;this.log(`Reconnect scheduled ${t.scheduled} ms (attempt ${t.attempt} out of ${t.retries}`)})),this.socket.on("reconnected",(e=>{const t=e;this.log(`It took ${t.duration} ms to reconnect`)})),this.socket.on("reconnect timeout",(e=>{const t=e;this.log("Timeout expired: %s",t.message),this.close()})),this.socket.on("reconnect failed",(e=>{const t=e;this.log("The reconnection failed: %s",t.message),this.close()})),this.socket.on("cb:data",this._dataHandler.bind(this)),e()}))))}));return this.promiseWithTimeout(e,this.networkPromiseTimeout)}))}awaitConnectionAcknowledged(){return ft(this,void 0,void 0,(function*(){yield this._awaitAck("open");const e=yield this._awaitUserId();this._assignId(e),this.connected=!0}))}_awaitUserId(){var e;const t=new Promise(((e,t)=>{if(!this.socket)throw this.log("There is no socket"),new Error("There is no socket");this.socket.once("cb:id",(o=>{if(!function(e){return"object"==typeof e&&"string"==typeof e.id}(o))return this.log("unrecognized cb:id response: ",{response:o}),t("Server did not assign id");e(o.id)}))}));return null===(e=this.socket)||void 0===e||e.emit("cb:auth",{id:this._id(),role:this.role}),this.promiseWithTimeout(t,this.networkPromiseTimeout)}_assignId(e){this.log(`User ID assigned (${e})`),this.id=e}_id(){var e;return null!==(e=null==this?void 0:this.id)&&void 0!==e?e:void 0}_clearId(){this.log(`Clearing user ID assigned (${this.id})`),this.id=void 0}_awaitAck(e){return ft(this,void 0,void 0,(function*(){let t=!1;const o=new Promise(((o,n)=>{if(!this.socket)return n(`Trying to await an ack msg ("${e}") but socket is closed`);this.socket.once("cb:error",(o=>{t||(this.log(`could not ${e}, got error: `,o),n(o))})),this.socket.once(`cb:error:${e}`,(o=>{t||(this.log(`could not ${e}, got error: `,o),n(o))})),this.socket.once("end",(()=>{t||(this.log(`could not ack "${e}", server closed connection`),n(new Error("server closed connection")))})),this.socket.once(`cb:ack:${e}`,(n=>{t||(this.log(`got ${e} ack with data, `,n),o(n))}))})),n=this.promiseWithTimeout(o,this.networkPromiseTimeout);return n.finally((()=>{t=!0})),n}))}promiseWithTimeout(e,t){return ft(this,void 0,void 0,(function*(){let o;const n=new Promise(((e,n)=>{o=setTimeout(n,t,new Error("promise timed out"))}));return Promise.race([e,n]).finally((()=>clearTimeout(o)))}))}}class wt extends yt{rejoinSession(){return ft(this,void 0,void 0,(function*(){this.connected||(yield this._connect());const e=this._awaitAck("rejoin");this.socket&&this.socket.emit("cb:rejoin",{});const t=yield e;if(!("object"==typeof(o=t)&&o&&o.hasOwnProperty("options")&&o.hasOwnProperty("joinCode")&&"string"==typeof o.joinCode))throw new Error("Wrong data returned on rejoin");var o;return t}))}joinSession(e){return ft(this,void 0,void 0,(function*(){if(this.connected||(yield this._connect()),!this.socket)throw new Error("Trying to join session before connection is open");const t=this._awaitAck("join");this.socket.emit("cb:join",{sessionId:e});const o=yield t;if("object"!=typeof(n=o)||!n||!n.hasOwnProperty("options"))throw new Error("Join response looks wrong");var n;return o}))}leaveSession(){return ft(this,void 0,void 0,(function*(){if(!this.socket)throw new Error("Trying to exit session before connection is open");if(!this.connected)throw new Error("Trying to exit session before connecting");const e=this._awaitAck("leave");return this.socket.emit("cb:leave",{}),yield e,this.close(),e}))}}class Et extends wt{constructor({apiUrl:e,storage:t,clientRole:o,level:n}){super(e,o),this.storage=t,this.log=i("network",n)}createSocket(e){return new gt(this.websocketUrl,e)}leaveSession(){const e=Object.create(null,{leaveSession:{get:()=>super.leaveSession}});return r(this,void 0,void 0,(function*(){yield e.leaveSession.call(this),this.clearStorage()}))}joinSession(e){const t=Object.create(null,{joinSession:{get:()=>super.joinSession}});return r(this,void 0,void 0,(function*(){try{this.restoreWebSocketUrl();const o=yield t.joinSession.call(this,e);return this.rememberUserId(e),o}catch(t){throw this.log("joinSession failed",t),this.close(),this.clearStorage(e),t}}))}rejoinSession(){const e=Object.create(null,{rejoinSession:{get:()=>super.rejoinSession}});return r(this,void 0,void 0,(function*(){return yield e.rejoinSession.call(this)}))}clearStorage(e){e&&this.storage.removeViewerIdForSession(e),this.storage.removeSharerId(),this.storage.removeWebSocketUrl()}rememberUserId(e){const t=super._id();if("string"!=typeof t)throw this.log("Unexpected userId: ",t),new Error("Unexpected userId");"sharer"===this.role?this.storage.putSharerId(t):this.storage.putViewerIdForSession(e,this._id())}restoreUserId(){if(!this.id){const e=this.storage.getSharerId();if(!e)throw new Error("failed to retrieve clientId from localStorage");this._assignId(e)}}restoreWebSocketUrl(){if(!this.websocketUrl){const e=this.storage.getWebSocketUrl();if(!e)throw new Error("failed to get websocketUrl from localStorage");this.log("Restored WS URL: ",e),this.websocketUrl=e}}}class St extends Et{constructor({apiUrl:e,clientRole:t,deploymentId:o,pubsub:n,level:s}){super({apiUrl:e,storage:new Ce({clientRole:t}),clientRole:t,pubsub:n,level:s}),this.deploymentId=o}setDeploymentId(e){this.deploymentId=e}setWebsocketUrl(e){const t=new URL(e);t.searchParams.set("deploymentId",this.deploymentId),super.setWebsocketUrl(t.toString()),this.storage.setWebSocketUrl(t.toString())}fetch(e,t){return fetch(e,t)}cookGetSessionUrl(e){const t=new URL(this.apiUrl);return t.pathname=`/api/v2/webdeployments/deployments/${this.deploymentId}/cobrowse/${e}`,t.toString()}cookDeleteSessionUrl(e){const t=new URL(this.apiUrl);return t.pathname=`/api/v2/webdeployments/deployments/${this.deploymentId}/cobrowse/${e}`,t.toString()}fetchSessionInfo(e){const t=this.cookGetSessionUrl(e);return this.fetch(t,{method:"GET"})}getSessionInfo(e){return r(this,void 0,void 0,(function*(){const t=yield this.fetchSessionInfo(e);if(!t.ok)throw new Error("getting session failed");const o=yield t.json();if(!o.websocketUrl||!o.id||!o.joinCode)throw new Error("get session returned wrong payload");return o}))}deleteSession(e){return r(this,void 0,void 0,(function*(){const t=this.cookDeleteSessionUrl(e);if(!(yield this.fetch(t.toString(),{method:"DELETE"})).ok)throw new Error(`Delete session ${e} failed`)}))}rejoinSession(){const e=Object.create(null,{rejoinSession:{get:()=>super.rejoinSession}});return r(this,void 0,void 0,(function*(){try{return this.restoreUserId(),this.restoreWebSocketUrl(),yield e.rejoinSession.call(this)}catch(e){throw this.log("rejoinSession failed",e),this.close(),this.clearStorage(),e}}))}generateCreateSessionUrl(e){throw new Error(`generateCreateSessionUrl(${e}) not implemented`)}createSession(){throw new Error("createSession() not implemented")}}class Ct extends Se{constructor({logLevel:e}){super(),this.log=i("storage",e),this.controlEnabledSessionKey="control_enabled_session",this.toolbarPositionKey="toolbar_position",this.offerStateKey="offer_state",this.sessionStateKey="ongoing_session",this.pauseStateKey="pause_state"}putControlEnabledSession(e){this.set(this.controlEnabledSessionKey,e)}getControlEnabledSession(){var e;return null!==(e=this.get(this.controlEnabledSessionKey))&&void 0!==e?e:void 0}removeControlEnabledSession(){this.remove(this.controlEnabledSessionKey)}setPauseState(e){this.set(this.pauseStateKey,e.toString())}getPauseState(){var e;return null!==(e=this.get(this.pauseStateKey))&&void 0!==e?e:void 0}removePauseState(){this.remove(this.pauseStateKey)}setToolbarPosition(e){this.set(this.toolbarPositionKey,JSON.stringify(e))}getToolbarPosition(){const e=this.get(this.toolbarPositionKey);if(e){const t=JSON.parse(e);return function(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e){const t=e;return"number"==typeof t.x&&"number"==typeof t.y}return!1}(t)?t:null}return null}removeToolbarPosition(){this.remove(this.toolbarPositionKey)}setOfferState(e){const t=this.getOfferState();null==t||t.push(e),this.log("saving offerState: ",e,t),this.set(this.offerStateKey,JSON.stringify(t))}getOfferState(e){this.log(`retrieving offerState for session ${e}`);const t=this.get(this.offerStateKey);let o=[];return t&&(o=JSON.parse(t),this.log("retrieved offerStates: ",o),e&&(o=o.filter((t=>t.sessionId===e))),this.log("parsed offerStates: ",o),o=o.sort(((e,t)=>e.timestamp-t.timestamp)),this.log("sorted offerStates: ",o)),this.log(`resolving with offerState for session ${e}=${JSON.stringify(o)}`),o}storeSessionState(e){this.set(this.sessionStateKey,e)}getStoredSessionState(){return this.get(this.sessionStateKey)}removeStoredSessionState(){this.remove(this.sessionStateKey)}}function xt(e){return r(this,void 0,void 0,(function*(){return new Promise(((t,o)=>{const n=new FileReader;n.onerror=o,n.onloadend=()=>{if(n.result&&"string"==typeof n.result)return t(n.result);o(new Error("Failed to convert blob to base64"))},n.readAsDataURL(e)}))}))}class kt{constructor(e,t){this.canvas=e,this.recheckInterval=t,this.lastBlob=null}onChange(e){this.callback=e}start(){return r(this,void 0,void 0,(function*(){try{this.lastBlob=yield It(this.canvas)}catch(e){return void(this.callback&&this.callback(e,null))}this.timeout=setTimeout((()=>{this.checkRecursive()}),this.recheckInterval)}))}checkRecursive(){return r(this,void 0,void 0,(function*(){const e=this.canvas;if(!e.isConnected)return void this.stop();let t;try{t=yield It(e)}catch(e){return void(this.callback&&this.callback(e,null))}(yield function(e,t){return r(this,void 0,void 0,(function*(){if(null===e&&null===t)return!0;if(null===e||null===t)return!1;const o=yield e.arrayBuffer(),n=yield t.arrayBuffer();if(o.byteLength!==n.byteLength)return!1;const s=new DataView(o),i=new DataView(n);for(let e=0;e<o.byteLength;e++)if(s.getUint8(e)!==i.getUint8(e))return!1;return!0}))}(this.lastBlob,t))||(this.callback&&this.callback(null,t),this.lastBlob=t),this.timeout=setTimeout((()=>{this.checkRecursive()}),this.recheckInterval)}))}onStop(e){this.onStopCallback=e}stop(){this.timeout&&clearTimeout(this.timeout),this.callback=void 0,this.lastBlob=null,this.onStopCallback&&this.onStopCallback()}}function It(e){return r(this,void 0,void 0,(function*(){return new Promise(((t,o)=>{try{e.toBlob((e=>{t(e)}),"image/webp")}catch(e){o(e)}}))}))}class Tt{constructor(e,t,o){this.pubsub=e,this.network=t,this.logLevel=o,this.log=i("Session",this.logLevel),this.network.subscribe("leave",(()=>{this.log("viewer left")})),this.network.subscribe("session-timeout",(e=>{this.log(`disconnected by timeout from session ${null==e?void 0:e.sessionId}`),this.pubsub.notify("int:session-expired",{sessionId:e.sessionId}),this.end()})),this.network.subscribe("join",(()=>{this.log("viewer joined")})),this.network.subscribe("session-offering-sent",(e=>{this.pubsub.notify("int:session-offering-sent",{sessionId:e.sessionId,offerTimeout:e.timeout})})),this.network.subscribe("session-wrapup",(()=>{this.end()}))}join(e){var t;return r(this,void 0,void 0,(function*(){let o,n;this.log("joinSession, fetching session");try{o=yield this.network.getSessionInfo(e)}catch(t){const o=t;return this.log.info(`Session with join code: ${e} not found.`),this.log(`Error: ${o.message}`),void this.pubsub.notify("int:session-load-failed")}if(!o)return this.log.info(`Session with join code: ${e} not found.`),void this.pubsub.notify("int:session-load-failed");this.log("joinSession, fetched session",o),this.pubsub.notify("int:session-loaded",{joinCode:e}),this.log("storing WS URL",o.websocketUrl),this.network.setWebsocketUrl(o.websocketUrl);try{n=null===(t=yield this.network.joinSession(e))||void 0===t?void 0:t.options}catch(e){return this.log.info("Failed while joining session",e),void this.pubsub.notify("int:session-load-failed")}if(!n)return this.log("Did not get session options, got:",n),void this.pubsub.notify("int:session-load-failed");this.pubsub.notify("int:session-options",{options:n});const s=Object.assign({},n);null==s||delete s.agentName,this.log.info(`Session options: ${JSON.stringify(s)}`),this.pubsub.notify("int:session-ready",{id:o.id,joinCode:e})}))}rejoin(){return r(this,void 0,void 0,(function*(){this.log("rejoining session");try{const e=yield this.network.rejoinSession();this.log.info("rejoined session",e);const t=null==e?void 0:e.options;if(!t)throw this.log("Did not get session options, got:",t),new Error("Did not get session options");this.pubsub.notify("int:session-options",{options:t}),this.pubsub.notify("int:session-ready",{id:e.joinCode,joinCode:e.joinCode}),this.pubsub.notify("int:sharer-reconnected",{joinCode:e.joinCode})}catch(e){return this.log.info("Failed while rejoining session",e),void this.pubsub.notify("int:session-load-failed")}}))}leave(){return r(this,void 0,void 0,(function*(){yield this.network.leaveSession(),this.end()}))}end(){this.pubsub.notify("int:session-end");try{this.log("closing the socket"),this.network.close()}catch(e){this.log("socket already closed")}finally{this.log("Session ended"),this.network.clearStorage()}}}class Dt extends c{constructor(e,t,o){super(e,t,o),this.serviceDiscovery=t,this.l10n=o,this.dom=new fe(this.getDOMRoot(),e.env,{ignore:e.ignoredSelectors}),this.primaryColor=e.primaryColor,this.deploymentId=e.deploymentId,this.network=new St({apiUrl:e.apiUrl,clientRole:this.getRole(),deploymentId:e.deploymentId,pubsub:this.pubsub,level:this.logLevel}),this.storage=new Ct({logLevel:this.logLevel}),this.canvas={createChecker:(e,t)=>new kt(e,t),blobToBase64:xt},this.session=new Tt(this.pubsub,this.network,this.logLevel)}register(e,t){this.modules.set(e,{constructor:t,instance:new t(new ye(this,e))})}isInIframeButWantsToBreakFree(){return"GENESYS_COBROWSE_START_IN_TOP_WINDOW"in window}getDOMRoot(){if(this.isInIframeButWantsToBreakFree()){if(!window.top||!window.top.document)throw new Error("Co-browse is configured to run in an iframe but cannot access window.top.document");return window.top.document}return document}getWindow(){if(this.isInIframeButWantsToBreakFree()){if(!window.top)throw new Error("Co-browse is configured to run in an iframe but cannot access window.top");return window.top}return window}setDeploymentId(e){this.log("Changing Deployment Id"),this.deploymentId=e,this.network.setDeploymentId(this.deploymentId)}getInstrumentedDocument(){return document}getNetwork(){return this.network}getRole(){return"sharer"}getPrimaryColor(){return this.primaryColor}getDeploymentId(){return this.deploymentId}getDeviceInfo(){let e;const t=navigator.userAgent;return e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)?"Mobile":"Desktop",e}}class Lt{constructor(e){this.sandbox=e,this.maskingClass=".cobrowse-masked",this.readonlyClass=".cobrowse-readonly",this.initialMaskSelectors=[this.maskingClass],this.maskSelectors=this.initialMaskSelectors,this.initialReadonlySelectors=[this.readonlyClass],this.readonlySelectors=this.initialReadonlySelectors,this.maskingRegexps=[]}onCreate(){}onSessionStart(){this.startDOMListening()}onPause(){this.sandbox.log("disconnecting the DOM"),this.sandbox.dom.disconnect()}onUnPause(){this.startDOMListening()}startDOMListening(){const e=this.sandbox.getDeploymentOptions();e.maskSelectors&&this.maskSelectors.push(...e.maskSelectors),e.readonlySelectors&&this.readonlySelectors.push(...e.readonlySelectors),e.maskingRegexps&&(this.maskingRegexps=e.maskingRegexps),this.sandbox.log("Sharer DOM module initialized...",{maskSelectors:this.maskSelectors,readonlySelectors:this.readonlySelectors});try{const e=this.sandbox.dom.takeSnapshot(this.maskSelectors,this.readonlySelectors,this.maskingRegexps);this.validateSnapshotSize(e),this.sandbox.network.send("sharer:dom-snapshot",e),this.sandbox.log("sent DOM snapshot",e)}catch(e){this.sandbox.log.error("Failed to create Snapshot",e),this.sandbox.notify("int:user-requested-stop")}this.captureUrl(),this.listenToDomChanges(),this.sandbox.notify("int:dom-initialized");for(const e of this.sandbox.dom.getCobrowsableIframes())this.sandbox.notify("int:dom-new-cobrowsable-iframe",{iframe:e});this.sandbox.dom.onLoadedIframe(((e,t)=>{this.sandbox.notify("int:dom-new-cobrowsable-iframe",{iframe:e}),this.sandbox.network.send("sharer:dom-iframe-changes",t),this.sandbox.log("sent DOM changes",t)}))}captureUrl(){const e=this.sandbox.getWindow().location.href;this.sandbox.network.send("sharer:url",{url:e})}listenToDomChanges(){this.sandbox.dom.onChange((e=>{try{this.sandbox.network.send("sharer:dom-changes",e),this.sandbox.notify("int:dom-changed"),this.sandbox.log("sent DOM changes",e)}catch(e){this.sandbox.log("not sending anything")}}))}onDestroy(){this.sandbox.log("disconnecting the DOM"),this.sandbox.dom.disconnect()}validateSnapshotSize(e){var t;if(!((new TextEncoder).encode(JSON.stringify(e)).length<=(null===(t=this.sandbox.getDeploymentOptions())||void 0===t?void 0:t.maxPayloadSize)))throw this.sandbox.network.send("sharer:dom-snapshot-size-exceeded"),new Error("Allowed snapshot size exceeded")}}class Ot{constructor(e){this.sandbox=e,this.listenersAttached=!1,this.iframeListeners=new Map,this.boundOnMouseMove=this.onMouseMove.bind(this),this.sendMouseMove=this.createThrottledCoordsSender()}onCreate(){this.sandbox.listen("int:dom-new-cobrowsable-iframe",(e=>{this.handleIframe(e.data.iframe)}))}onPause(){this.removeEventListeners()}onUnPause(){this.attachEventListeners()}attachEventListeners(){this.listenersAttached?this.sandbox.log("listeners already attached, not reattaching"):(this.addMouseMoveListener(),this.addNetworkListener(),this.listenersAttached=!0)}handleIframe(e){const t=e.contentDocument;this.sandbox.log("handling iframe",e),t&&this.addIframeMouseListener(t,e)}addIframeMouseListener(e,t){this.sandbox.log("adding mousemove listener to iframe",t);const o=this.createBoundIframeListener(t);e.addEventListener("mousemove",o),this.iframeListeners.set(t,o)}createBoundIframeListener(e){return(t=>{const o=e.getBoundingClientRect(),n=t.clientX+o.x,s=t.clientY+o.y;this.sendMouseMove({x:n,y:s})}).bind(this)}createThrottledCoordsSender(){let e=!1,t={x:0,y:0};return o=>{e||o.x===t.x||o.y===t.y||(this.sandbox.network.send("ext:mouse-move",o),e=!0,t=o,setTimeout((function(){e=!1}),N))}}addMouseMoveListener(){const e=this.sandbox.getDOMRoot();e&&e.addEventListener("mousemove",this.boundOnMouseMove)}onNetworkMouseMove(e){if("object"!=typeof e||"number"!=typeof e.x||"number"!=typeof e.y)throw new Error(`unexpected network data for "ext:mouse-move": ${JSON.stringify(e)}`);this.sandbox.notify("int:mouse-move",e)}addNetworkListener(){this.sandbox.network.subscribe("ext:mouse-move",this.onNetworkMouseMove.bind(this))}onMouseMove(e){this.sendMouseMove({x:e.clientX,y:e.clientY})}removeEventListeners(){this.listenersAttached=!1;const e=this.sandbox.getDOMRoot();null==e||e.removeEventListener("mousemove",this.boundOnMouseMove)}onDestroy(){this.removeEventListeners()}}class Nt extends Ot{constructor(e){super(e),this.sandbox=e}onCreate(){super.onCreate()}onSessionStart(){this.attachEventListeners()}onDestroy(){var e;super.onDestroy();for(const[t,o]of this.iframeListeners)null===(e=null==t?void 0:t.contentDocument)||void 0===e||e.removeEventListener("mousemove",o)}}class Rt{constructor(e){this.sandbox=e,this.i18n=this.sandbox.geti18n()}onCreate(){}onDestroy(){}}class Mt extends Rt{constructor(e){super(e),this.sandbox=e}onCreate(){this.sandbox.network.subscribe("ext:draw-enabled",(()=>{const e=this.getGhostPointer();e&&(e.innerHTML=this.getDrawingCursorHTML())})),this.sandbox.network.subscribe("ext:draw-disabled",(()=>{const e=this.getGhostPointer();e&&(e.innerHTML=this.getPointingCursorHTML())}))}onPause(){var e;null===(e=this.getGhostPointer())||void 0===e||e.remove()}onUnPause(){this.createGhostPointer()}getPointingCursorHTML(){return`<svg\n\t\t\taria-hidden="true" \n\t\t\tclass="genesys-cbx-ignore"\n\t\t\tfill="${this.sandbox.getPrimaryColor()}"\n\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\tviewBox="0 0 512 512">\n\t\t\t\t<title>Cobrowse Ghost Pointer</title>\n\t\t\t\t<path id="gcobrowse-ghost-pointer-glyph" d="M449.87,248.29c.94-7.2-2.19-14.71-8.45-18.46L90.74,3A18.21,18.21,0,0,0,71.66,2.4,19.2,19.2,0,0,0,62,19V420a19.28,19.28,0,0,0,10.32,16.9A18.76,18.76,0,0,0,92,435l99.48-74.45,91,142.65a18.72,18.72,0,0,0,16,8.76,20.06,20.06,0,0,0,9.39-2.5l92.91-53.81a18.9,18.9,0,0,0,8.76-11.89A17.83,17.83,0,0,0,407,429.41L322.24,295.84l114.5-32.22a19,19,0,0,0,13.14-15.33ZM287.51,266.43A19.51,19.51,0,0,0,275,277.69a18.94,18.94,0,0,0,1.56,16.9l87.6,138.27-60.38,35L212.12,323.36a18.66,18.66,0,0,0-12.51-8.45,12.88,12.88,0,0,0-3.45-.31,18.76,18.76,0,0,0-11.26,3.75L99.19,382.49V53.39L386.37,238.9Zm0,0" />\n\t\t</svg>${this.getPointerTitleHTML()}`}getDrawingCursorHTML(){return`<svg               \n\t\t\tclass="genesys-cbx-ignore" \n\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\tfill="${this.sandbox.getPrimaryColor()}"\n\t\t\tviewBox="0 0 24 24">\n\t\t\t\t<title>arrow-pointer-outline-glyph</title>\n\t\t\t\t<path d="M0 0h24v24H0z" fill="none"/><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>\n\t\t</svg>${this.getPointerTitleHTML()}`}getPointerTitleHTML(){return`<span role="complementary" id="${Mt.POINTER_TITLE_ID}" class="genesys-cbx-ignore" aria-hidden="true">${this.getPointerTitleText()}</span>`}onDestroy(){var e;try{null===(e=this.getGhostPointer())||void 0===e||e.remove()}catch(e){this.sandbox.log(`Couldn't find ghost pointer. ${e}`)}}getCursorParent(){return this.getDocument().body}createGhostPointer(){var e;this.getDocument().getElementById(Mt.GHOST_POINTER_ID)||null===(e=this.getCursorParent())||void 0===e||e.insertAdjacentHTML("beforeend",`<div class="genesys-cbx-ignore" id="${Mt.GHOST_POINTER_ID}">${this.getPointingCursorHTML()}</div>`)}getGhostPointer(){return this.getDocument().getElementById(Mt.GHOST_POINTER_ID)}}Mt.GHOST_POINTER_ID="gcobrowse-ghost-pointer",Mt.POINTER_TITLE_ID="gcobrowse-ghost-pointer-title",Mt.TOOLBAR_ID="gcobrowse-viewer-toolbar",Mt.URL_ID="url-area";class At extends Mt{constructor(e){super(e),this.sandbox=e}onCreate(){super.onCreate(),this.sandbox.listen("int:mouse-move",(e=>{this.setGhostPointerPosition(e.data)}))}onSessionStart(){this.createGhostPointer(),this.sandbox.notify("int:pointer-created")}getPointerTitleText(){var e;const t=null===(e=this.sandbox.getDeploymentOptions())||void 0===e?void 0:e.agentName;return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):this.i18n.viewer}getDocument(){const e=this.sandbox.getDOMRoot();if(!e)throw new Error("Cannot get document");return e}setGhostPointerPosition(e){var t,o;null===(t=this.getGhostPointer())||void 0===t||t.style.setProperty("left",`${e.x}px`),null===(o=this.getGhostPointer())||void 0===o||o.style.setProperty("top",`${e.y}px`)}}class _t{constructor(e){this.sandbox=e,this.iframeListeners=new Map,this.pointerOnMouseClick=this.onMouseClick.bind(this),this.preventDefault=this.preventDefaultHandler.bind(this),this.controlAllowed=!1,this.viewerZoomValue=1,this.isDrawEnabled=!1,this.listenersAttached=!1}onCreate(){this.sandbox.listen("int:draw-start",(()=>{this.isDrawEnabled=!0})),this.sandbox.listen("int:draw-end",(()=>{this.isDrawEnabled=!1})),this.sandbox.listen("int:control-granted",(()=>{this.controlAllowed=!0})),this.sandbox.listen("int:control-revoked",(()=>{this.controlAllowed=!1})),this.sandbox.listen("int:dom-new-cobrowsable-iframe",(e=>{this.handleIframe(e.data.iframe)}))}handleIframe(e){const t=e.contentDocument;this.sandbox.log("mousclick module handling iframe",e),t&&this.addIframeMouseListener(t,e)}addIframeMouseListener(e,t){this.sandbox.log("adding click listener to iframe",t);const o=this.createBoundIframeListener(t);e.addEventListener("click",o),this.iframeListeners.set(t,o)}createBoundIframeListener(e){throw new Error("method createBoundIframeListener not implemented")}attachEventListeners(){this.listenersAttached?this.sandbox.log("listeners already attached, not reattaching"):(this.handleMouseClick(),this.handleIncomingMouseClick(),this.listenersAttached=!0)}preventDefaultHandler(e){return e.preventDefault(),!1}handleMouseClick(){var e;null===(e=this.sandbox.getDOMRoot())||void 0===e||e.addEventListener("click",this.pointerOnMouseClick)}handleIncomingMouseClick(){this.sandbox.network.subscribe("ext:mouse-click",this.onNetworkMouseClick.bind(this))}sendNodeIdForHighlight(e){if(!this.sandbox.dom.isIgnored(e)&&!this.isDrawEnabled){const t=this.sandbox.dom.getNodeId(e);this.sandbox.network.send("ext:mouse-click-dom-highlight",{nodeId:t})}}onMouseClick(e){throw new Error("method onMouseClick not implemented")}onNetworkMouseClick(e){if("object"!=typeof e||"number"!=typeof e.x||"number"!=typeof e.y)throw new Error(`unexpected network data for "ext:mouse-click": ${JSON.stringify(e)}`);this.sandbox.notify("int:mouse-click",e)}onDestroy(){var e,t;this.controlAllowed=!1,this.listenersAttached=!1,null===(e=this.sandbox.getDOMRoot())||void 0===e||e.removeEventListener("click",this.pointerOnMouseClick);for(const[e,o]of this.iframeListeners)null===(t=null==e?void 0:e.contentDocument)||void 0===t||t.removeEventListener("click",o)}}class Pt extends _t{constructor(e){super(e),this.sandbox=e,this.pointerOnMouseClick=this.onMouseClick.bind(this)}onCreate(){super.onCreate(),this.sandbox.network.subscribe("viewer:zoom",(e=>{this.viewerZoomValue=e.factor})),this.sandbox.network.subscribe("ext:mouse-click-on-node",(e=>{this.replayClick(e.nodeId)}))}onSessionStart(){this.attachEventListeners()}createBoundIframeListener(e){return(t=>{const o=e.getBoundingClientRect();let n=t.clientX+o.x,s=t.clientY+o.y;0!=n&&0!=s&&(n*=this.viewerZoomValue,s*=this.viewerZoomValue),this.sandbox.network.send("ext:mouse-click",{x:n,y:s}),this.sendNodeIdForHighlight(t.target)}).bind(this)}onMouseClick(e){const t=e;let o=t.clientX,n=t.clientY;0!=o&&0!=n&&(o*=this.viewerZoomValue,n*=this.viewerZoomValue,this.sandbox.network.send("ext:mouse-click",{x:o,y:n})),this.sendNodeIdForHighlight(t.target)}replayClick(e){if(this.controlAllowed){const t=this.sandbox.dom.getNodeById(e);t.dataset.gcobrowseReadonly||this.sandbox.events.replayClick(t)}}}class Ut{constructor(e){this.sandbox=e,this.listenersAttached=!1}onCreate(){this.sandbox.listen("int:pointer-created",(()=>{this.listenersAttached?this.sandbox.log("Mouse click UI module already initialized"):(this.addClickListener(),this.listenersAttached=!0)})),this.createGhostPointerClick()}createGhostPointerClick(){throw new Error("createGhostPointerClick not implemented on the base class.")}moveClick(e){throw new Error("method moveClick not implemented")}getGhostClickElement(){throw new Error("method getGhostClickElement not implemented")}addClickListener(){this.sandbox.listen("int:mouse-click",this.onExternalClick.bind(this))}onExternalClick(e){var t;this.sandbox.log(`triggering click animation at ${e.data.x}, ${e.data.y}`);const o=e.data;this.moveClick({x:o.x,y:o.y}),null===(t=this.getGhostClickElement())||void 0===t||t.classList.add("active"),setTimeout((()=>{var e;try{this.sandbox.log("hiding the click back"),null===(e=this.getGhostClickElement())||void 0===e||e.classList.remove("active")}catch(e){}}),400)}onDestroy(){this.listenersAttached=!1;const e=this.getGhostClickElement();e&&e.remove()}}Ut.CLICK_ELEMENT_ID="gcobrowse-click",Ut.TOOLBAR_ID="gcobrowse-viewer-toolbar",Ut.URL_ID="url-area";class jt extends Ut{constructor(e){super(e),this.sandbox=e}createGhostPointerClick(){var e;null===(e=this.sandbox.getDOMRoot())||void 0===e||e.body.insertAdjacentHTML("beforeend",'<i id="gcobrowse-click" class="genesys-cbx-ignore" aria-hidden="true"></i>')}onPause(){var e;null===(e=this.getGhostClickElement())||void 0===e||e.remove()}onUnPause(){this.createGhostPointerClick()}moveClick(e){const t=this.getGhostClickElement();null==t||t.style.setProperty("left",`${e.x}px`),null==t||t.style.setProperty("top",`${e.y}px`)}getGhostClickElement(){const e=this.sandbox.getDOMRoot();return e?e.getElementById(Ut.CLICK_ELEMENT_ID):null}}class zt{constructor(e){this.sandbox=e,this.controlGranted=!1,this.supportedScrollableElements=["div","table","textarea"],this.scrollElementListenerAttachDelay=70,this.debugScroll="GENESYS_COBROWSE_DEBUG_SCROLL"in window,this.localElementScrollListeners={add:e=>e.addEventListener("scroll",this.boundSendElementScroll,{passive:!1}),remove:e=>e.removeEventListener("scroll",this.boundSendElementScroll)},this.boundSendElementScroll=this.sendElementScroll.bind(this)}onCreate(){}onDestroy(){}subscribeToNetworkElementScroll(){const e="viewer"===this.sandbox.getRole()?"ext:sharer-element-scroll":"viewer:element-scroll";this.sandbox.network.subscribe(e,(e=>{this.onNetworkElementScroll(e)}))}debugLog(e,...t){this.debugScroll&&this.sandbox.log(e,t)}onNetworkElementScroll(e){var t;if(this.debugLog("received scroll event over network",e),!this.controlGranted&&"sharer"===this.sandbox.getRole())return void this.sandbox.log.error('got "scroll" event while control was not allowed');const o=this.sandbox.dom.getNodeById(e.nodeId),n=null===(t=o.nodeName)||void 0===t?void 0:t.toLocaleLowerCase();if(this.supportedScrollableElements.includes(n)){const t=o;t.removeEventListener("scroll",this.boundSendElementScroll),this.debugLog("going to scroll",t),t.scroll({left:null==e?void 0:e.scrollLeft,top:null==e?void 0:e.scrollTop}),setTimeout((()=>{this.debugLog("readding scroll listener to",t),t.addEventListener("scroll",this.boundSendElementScroll)}),this.scrollElementListenerAttachDelay)}}startListeningToLocalElementScroll(){this.addOrRemoveLocalScrollListener("add")}stopListeningToLocalElementScroll(){this.addOrRemoveLocalScrollListener("remove")}getRootChildren(){throw new Error("getRootChildren not implemented on the base class.")}addOrRemoveLocalScrollListener(e){const t=this.getRootChildren();if(this.debugLog(`${e}-ing scroll listeners to root children: `,t),t)for(const o of t)this.attachListener(e,o)}attachListener(e,t){if(this.localElementScrollListeners[e](t),this.debugLog(`${e}-ing scroll listeners to element: `,t),t.shadowRoot)for(const o of t.shadowRoot.children)this.attachListener(e,o);else if(t.children)for(const o of t.children)this.attachListener(e,o)}sendElementScroll(e){var t;const o=this.sandbox.getRole();if(!this.controlGranted&&"viewer"===o)return;e.preventDefault();const n=e.target,s=null===(t=n.nodeName)||void 0===t?void 0:t.toLocaleLowerCase();if(!this.supportedScrollableElements.includes(s))return void this.debugLog(`element "${s} is excluded, not scrolling`);const i=this.sandbox.dom.getNodeId(n),r="viewer"===this.sandbox.getRole()?"viewer:element-scroll":"ext:sharer-element-scroll",a={nodeId:i,scrollTop:null==n?void 0:n.scrollTop,scrollLeft:null==n?void 0:n.scrollLeft};this.debugLog("sending scroll",a),this.sandbox.network.send(r,a)}}class Vt extends zt{constructor(e){super(e),this.sandbox=e,this.listenerAttached=!1,this.lastKnownScrollXPosition=this.sandbox.getWindow().scrollX,this.lastKnownScrollYPosition=this.sandbox.getWindow().scrollY,this.ticking=!1,this.boundSendScroll=this.sendCurrentRootScroll.bind(this)}onCreate(){this.sandbox.listen("int:control-granted",(()=>{this.controlGranted=!0})),this.sandbox.listen("int:control-revoked",(()=>{this.controlGranted=!1})),this.sandbox.network.subscribe("viewer:scroll",(e=>this.onNetworkScroll(e))),this.sandbox.network.subscribe("viewer:wheel",(e=>this.onNetworkWheel(e)))}onSessionStart(){this.addRootEventListener(),this.sendCurrentRootScroll(),this.subscribeToNetworkElementScroll(),this.startListeningToLocalElementScroll()}addRootEventListener(){var e;this.listenerAttached?this.sandbox.log("listener already attached"):(null===(e=this.sandbox.getDOMRoot())||void 0===e||e.addEventListener("scroll",this.boundSendScroll),this.listenerAttached=!0)}removeEventListener(){var e;null===(e=this.sandbox.getDOMRoot())||void 0===e||e.removeEventListener("scroll",this.boundSendScroll),this.listenerAttached=!1}sendCurrentRootScroll(){this.lastKnownScrollXPosition=this.sandbox.getWindow().scrollX,this.lastKnownScrollYPosition=this.sandbox.getWindow().scrollY,this.ticking||(this.sandbox.getWindow().requestAnimationFrame((()=>{const e={x:this.lastKnownScrollXPosition,y:this.lastKnownScrollYPosition};this.debugLog("sending sharer scroll",e),this.sandbox.network.send("sharer:scroll",e),this.ticking=!1})),this.ticking=!0)}onNetworkScroll(e){if(this.controlGranted){if("object"!=typeof e||"number"!=typeof e.x||"number"!=typeof e.y)throw new Error(`unexpected network data for "viewer:scroll": ${JSON.stringify(e)}`);this.removeEventListener(),this.sandbox.getWindow().scroll(e.x,e.y),setTimeout(this.addRootEventListener.bind(this),70)}}onNetworkWheel(e){this.controlGranted&&"object"==typeof e&&"number"==typeof e.deltaY&&(this.sandbox.log("dispathing wheelEvt: ",e.deltaY),this.sandbox.events.replayWheel(e.deltaY))}getRootChildren(){return this.sandbox.getRootUIElement().children}onDestroy(){this.stopListeningToLocalElementScroll(),this.removeEventListener()}}class $t{constructor(e){this.sandbox=e,this.controlAllowed=!1}onCreate(){this.sandbox.network.subscribe("viewer:input",this.onViewerInput.bind(this)),this.sandbox.network.subscribe("viewer:input-change",this.onViewerInputChange.bind(this)),this.sandbox.listen("int:control-granted",(()=>{this.controlAllowed=!0})),this.sandbox.listen("int:control-revoked",(()=>{this.controlAllowed=!1}))}onViewerInput(e){if(!this.controlAllowed)return void this.sandbox.log.error('got "input" event while control was not allowed');this.sandbox.log.info("got input event",e);const t=e,o=this.sandbox.dom.getNodeById(t.id);this.sandbox.log("input event is on element:",o),"INPUT"!==o.nodeName&&"TEXTAREA"!==o.nodeName||this.sandbox.events.replayTyping(o,H(t.value))}onViewerInputChange(e){if(this.controlAllowed){if(this.sandbox.log.info("got change event",e),e){const t=this.sandbox.dom.getNodeById(e.nodeId);this.sandbox.log("change event is on element:",t),"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName||this.sandbox.events.replayChange(t)}}else this.sandbox.log.error('got "change" event while control was not allowed')}onDestroy(){}}class Bt extends Rt{constructor(e){super(e),this.sandbox=e,this.tooltipCss=`\n\t\tdiv {\n\t\t\tbackground: #6d6d6d;\n\t\t\tcolor: white;\n\t\t\tfont-size: 14px;\n\t\t\theight: 24px;\n\t\t\tpadding: 0 8px;\n\t\t\tfont-family: sans-serif;\n\t\t\tborder-radius: 4px;\n\t\t\tline-height: 24px;\n\t\t}\n\t\t\n\t\tdiv.${Bt.onClassName} {\n\t\t\tanimation: fadeIn 0.1s ease-in;\n\t\t}\n\t\t\n\t\tdiv.${Bt.offClassName} {\n\t\t\tanimation: fadeOut 0.5s ease-in;\n\t\t\tanimation-fill-mode: forwards; /* stay hidden */\n\t\t}\n\t\t\n\t\t@keyframes fadeIn {\n\t\t\tfrom {\n\t\t\t\topacity: 0;\n\t\t\t\ttransform: scale3d(0.7, 0.7, 0.7);\n\t\t\t}\n\t\t\n\t\t\t50% {\n\t\t\t\topacity: 1;\n\t\t\t}\n\t\t}\n\t\t@keyframes fadeOut {\n\t\t\tfrom {\n\t\t\t\topacity: 1;\n\t\t\t}\n\t\t\n\t\t\tto {\n\t\t\t\topacity: 0;\n\t\t\t}\n\t\t}`}onCreate(){}createTooltipEl(e){var t,o;const n=document.createElement("div");n.setAttribute("id",Bt.tooltipContainerId),n.setAttribute("style","position: absolute; display: none;"),n.attachShadow({mode:"open"});const s=document.createElement("div");s.className=Bt.offClassName,s.innerText=e;const i=document.createElement("style");return i.innerText=this.tooltipCss,null===(t=n.shadowRoot)||void 0===t||t.appendChild(s),null===(o=n.shadowRoot)||void 0===o||o.appendChild(i),n}displayTooltip(e){var t;const o=this.tooltipContainer;if(o){o.style.display="block",o.style.top=e.offsetTop+e.offsetHeight+15-e.scrollTop+"px",o.style.left=`${e.offsetLeft+(e.offsetWidth-o.offsetWidth)/2}px`;const n=null===(t=o.shadowRoot)||void 0===t?void 0:t.querySelector("div");n&&(n.className=Bt.onClassName)}}getTooltipEl(){var e,t;return null===(t=null===(e=this.tooltipContainer)||void 0===e?void 0:e.shadowRoot)||void 0===t?void 0:t.querySelector("div")}hideTooltip(){const e=this.getTooltipEl();this.tooltipContainer&&e&&(this.tooltipContainer.style.display="none",e.className=Bt.offClassName)}onDestroy(){}}Bt.onClassName="fade-in",Bt.offClassName="fade-out",Bt.tooltipContainerId="gcobrowse-tooltip-container";class qt extends Bt{constructor(e){super(e),this.sandbox=e,this.paused=!1,this.sandbox.listen("int:dom-initialized",(()=>{this.paused||(this.createSharerTooltip(),this.attachTooltip())})),this.sandbox.listen("int:dom-changed",(()=>{this.paused||this.attachTooltip()}))}onPause(){var e;this.paused=!0,this.detachTooltip(),null===(e=this.tooltipContainer)||void 0===e||e.remove()}onUnPause(){this.paused=!1,this.createSharerTooltip(),this.attachTooltip()}attachTooltip(){var e;null===(e=this.getElsThatShouldHaveTooltip())||void 0===e||e.forEach((e=>{e.addEventListener("mouseenter",(()=>this.displayTooltip(e))),e.addEventListener("mouseleave",(()=>this.hideTooltip()))}))}detachTooltip(){var e;null===(e=this.getElsThatShouldHaveTooltip())||void 0===e||e.forEach((e=>{e.removeEventListener("mouseenter",(()=>this.displayTooltip(e))),e.removeEventListener("mouseleave",(()=>this.hideTooltip()))}))}createSharerTooltip(){var e,t;this.tooltipContainer=this.createTooltipEl(this.i18n.maskedTooltip),this.tooltipContainer.classList.add("genesys-cbx-ignore"),null===(t=null===(e=this.sandbox.getDOMRoot())||void 0===e?void 0:e.body)||void 0===t||t.appendChild(this.tooltipContainer)}getElsThatShouldHaveTooltip(){var e;return null===(e=this.sandbox.getDOMRoot())||void 0===e?void 0:e.querySelectorAll("[data-gcobrowse-masked], [data-is-embed-or-object]")}onDestroy(){var e;this.detachTooltip(),null===(e=this.tooltipContainer)||void 0===e||e.remove(),super.onDestroy()}}class Wt{constructor(e){this.sandbox=e}onCreate(){this.sandbox.network.subscribe("viewer:control-request",(()=>{this.handleViewerControlRequest()})),this.sandbox.network.subscribe("viewer:control-revoke",(()=>{this.handleViewerControlRevoke()})),this.sandbox.listen("int:control-enable",(()=>{try{this.giveControl()}catch(e){this.sandbox.log.error(e)}})),this.sandbox.listen("int:control-disable",(()=>{this.revokeControl()}))}onSessionStart(e){this.currentSessionCode=e}onReconnect(e){try{e&&this.handleSessionReconnect(e)}catch(e){this.sandbox.log.error(e)}}handleViewerControlRequest(){this.sandbox.notify("int:control-requested"),this.sandbox.log("viewer requested input control")}handleViewerControlRevoke(){this.sandbox.notify("int:control-revoked"),this.sandbox.log.info("viewer revoked input control"),this.sandbox.log.info("removing control enabled key"),this.clearControlEnabled()}giveControl(){this.sandbox.network.send("sharer:control-response",{allowed:!0}),this.storeControlEnabled(),this.sandbox.notify("int:control-granted")}revokeControl(){this.sandbox.network.send("sharer:control-revoke"),this.sandbox.notify("int:control-revoked"),this.sandbox.log.info("viewer control disabled"),this.sandbox.log.info("removing control enabled key"),this.clearControlEnabled()}handleSessionReconnect(e){this.sandbox.log("checking control enabled key on reconnect");this.checkControlEnabledForSession(e)&&(this.sandbox.log("found control enabled key for current session, enabling control"),this.sandbox.notify("int:control-granted"))}checkControlEnabledForSession(e){const t=this.sandbox.storage.getControlEnabledSession();return!!t&&(t===e||(this.sandbox.log(`found control enabled key for ${t}, but current session is ${e}`),this.clearControlEnabled(),!1))}storeControlEnabled(){if(!this.currentSessionCode)throw new Error("Trying to give control within an undefined session");this.sandbox.log(`storing control enabled key for session ${this.currentSessionCode}`),this.sandbox.storage.putControlEnabledSession(this.currentSessionCode)}clearControlEnabled(){this.sandbox.storage.removeControlEnabledSession()}onDestroy(){this.currentSessionCode=void 0,this.clearControlEnabled()}}class Ht{constructor(e){this.sandbox=e,this.boundSendResizeEvent=this.sendResizeEvent.bind(this)}onCreate(){this.sandbox.getWindow().addEventListener("resize",this.boundSendResizeEvent)}onSessionStart(){this.sendResizeEvent()}sendResizeEvent(){const e=this.sandbox.getWindow().innerWidth,t=this.sandbox.getWindow().innerHeight;this.sandbox.network.send("sharer:resize",{x:e,y:t})}onDestroy(){this.sandbox.getWindow().removeEventListener("resize",this.boundSendResizeEvent)}}class Ft{constructor(e){this.sandbox=e,this.controlAllowed=!1}onCreate(){this.sandbox.network.subscribe("viewer:input-select",this.onViewerInput.bind(this)),this.sandbox.listen("int:control-granted",(()=>{this.controlAllowed=!0})),this.sandbox.listen("int:control-revoked",(()=>{this.controlAllowed=!1}))}onViewerInput(e){if(!this.controlAllowed)return void this.sandbox.log.error('got "input" event while control was not allowed');this.sandbox.log.info("got input:select event",e);const t=this.sandbox.dom.getNodeById(e.id);this.sandbox.log("change event is on select element:",t),"SELECT"===t.nodeName&&this.sandbox.events.replaySelectChange(t,e.value)}onDestroy(){}}class Gt{constructor(e,t,o,n){this.i18n=e,this.cxbus=t,this.storage=o,this.toolbarUrl=n,this.log=i("toolbar")}onCreate(){this.createToolbar(),this.addViewportMetaTag();const e=this.storage.getToolbarPosition();e&&(this.log("Toolbar position found, repositioning",e),this.setToolbarPosition(e))}addViewportMetaTag(){if(!document.head.querySelector('meta[name="viewport"]')){this.log('meta[name="viewport"] not found, adding a default-ish one for Android Chrome');const e=document.createElement("meta");e.name="viewport",e.content="height=device-height, \n\t\t\twidth=device-width, initial-scale=1.0, \n\t\t\tuser-scalable=yes, target-densitydpi=device-dpi",e.id=Gt.VIEWPORT_ID,document.head.appendChild(e)}}createToolbar(){let e=this.getToolbar();if(e)return this.log("Toolbar already exists, resetting width/height"),e.style.height="110px",void(e.style.width="320px");this.cxbus.command("MessengerHelper.injectFrame",{htmlUrl:this.toolbarUrl,id:Gt.TOOLBAR_ID,title:this.i18n.sharerToolbar,name:this.i18n.sharerToolbar,styles:{width:"320px",height:"110px",top:"20px","touch-action":"none",position:"fixed",transition:"left 0.05s ease, top 0.05s ease"}}),this.cxbus.subscribe("Cobrowse.onDrag",(e=>{const t=e.data;this.repositionToolbar(t)})),this.cxbus.subscribe("CobrowseService.sessionEnded",(()=>{this.onDestroy()})),window.addEventListener("resize",(()=>{this.repositionToolbar()})),this.cxbus.subscribe("Cobrowse.setDimensions",(t=>{const o=t.data;e=this.getToolbar(),e&&(e.style.width=`${o.width}px`,e.style.height=`${o.height}px`)})),this.cxbus.subscribe("CobrowseService.controlGranted",(()=>{setTimeout((()=>{this.repositionToolbar()}),100)}))}repositionToolbar(e={x:0,y:0}){const t=this.getToolbar();if(!t)return void this.log("Toolbar not found");const o=t.getBoundingClientRect(),n=o.width;let s=o.x+e.x,i=o.y+e.y;s=s<0?0:1.5*n<window.innerWidth?Math.min(s,window.innerWidth-n):Math.min(s,window.innerWidth-.5*n),i=i<0?0:Math.min(i,window.innerHeight-o.height),s=Math.floor(s),i=Math.floor(i),this.setToolbarPosition({x:s,y:i}),i>0&&i!==o.y&&(t.classList.add("animate"),setTimeout((()=>{t.classList.remove("animate")}),50))}setToolbarPosition(e){const t=this.getToolbar();t&&(t.style.left=`${e.x}px`,t.style.top=`${e.y}px`,this.storage.setToolbarPosition(e))}getToolbar(){const e=document.getElementById(Gt.TOOLBAR_ID);return e||null}getToolbarElement(e){var t;if(this.getToolbar()){return(null===(t=this.getToolbar())||void 0===t?void 0:t.contentDocument).getElementById(e)}return null}getViewportElement(){return document.querySelector(Gt.VIEWPORT_ID)}closeToolbar(){const e=this.getToolbar();e&&(e.style.height="0px",e.style.width="0px")}onDestroy(){var e;this.closeToolbar(),null===(e=this.getViewportElement())||void 0===e||e.remove(),this.storage.removeToolbarPosition()}}Gt.TOOLBAR_ID="gcobrowse-sharer-toolbar",Gt.VIEWPORT_ID="gcobrowse-viewport";class Yt{constructor(e){this.sandbox=e,this.boundOnMouseDown=this.onMouseDown.bind(this),this.boundOnMouseMove=this.onMouseMove.bind(this),this.boundOnMouseUp=this.onMouseUp.bind(this),this.boundTouchStart=this.onTouchStart.bind(this),this.boundTouchMove=this.onTouchMove.bind(this),this.boundTouchEnd=this.onTouchEnd.bind(this),this.activeCanvas=!1}onCreate(){this.sandbox.network.subscribe("ext:draw",(e=>{const{x:t,y:o,isMultiTouchEvent:n}=e;this.draw({x:t,y:o,isExternalEvent:!0,isMultiTouchEvent:n})})),this.sandbox.network.subscribe("ext:draw-end",(()=>this.removeAndAnimateCanvasHide())),this.sandbox.network.subscribe("ext:draw-disabled",(()=>this.stopDrawing())),this.sandbox.listen("int:draw-start",(()=>this.startDrawing())),this.sandbox.listen("int:draw-end",(()=>{this.stopDrawing(),this.sendDrawDisabledMessage()}))}onPause(){this.stopDrawing(),this.removeEventListeners()}createCanvas(){var e,t,o,n,s,i;Yt.count+=1,null===(e=this.getUIElement())||void 0===e||e.insertAdjacentHTML("beforebegin",Yt.CANVAS_ELEMENT.replace("<uniqueId>",Yt.count.toString())),null===(t=this.getUIElement())||void 0===t||t.insertAdjacentHTML("beforeend",Yt.CANVAS_STYLE.replace(new RegExp("<uniqueId>","g"),Yt.count.toString())),this.canvas=null!==(o=this.getCanvasElement(Yt.count))&&void 0!==o?o:void 0,this.canvasStyle=null!==(n=this.getCanvasStyleElement(Yt.count))&&void 0!==n?n:void 0,this.ctx=null!==(i=null===(s=this.canvas)||void 0===s?void 0:s.getContext("2d"))&&void 0!==i?i:void 0,this.resizeCanvas(),this.activeCanvas=!0}createCursorStyleElement(e){const t=e.createElement("style");return t.setAttribute("id",Yt.CURSOR_VIEWER_STYLE_ID),t.textContent=`body.${Yt.ACTIVE_DRAWING}{\n\t\tcursor: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iIzAwMDAwMERFIj48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIj48L3BhdGg+PHBhdGggZD0iTTMgMTcuMjVWMjFoMy43NUwxNy44MSA5Ljk0bC0zLjc1LTMuNzVMMyAxNy4yNXpNMjAuNzEgNy4wNGMuMzktLjM5LjM5LTEuMDIgMC0xLjQxbC0yLjM0LTIuMzRjLS4zOS0uMzktMS4wMi0uMzktMS40MSAwbC0xLjgzIDEuODMgMy43NSAzLjc1IDEuODMtMS44M3oiPjwvcGF0aD48L3N2Zz4=),\n\t\t\tauto !important;\n\t\t}`,t}resizeCanvas(){if(!this.ctx)return;const e=this.sandbox.getDOMRoot();e&&(this.ctx.canvas.width=e.body.scrollWidth>this.sandbox.getWindow().innerWidth?e.body.scrollWidth:e.documentElement.clientWidth,this.ctx.canvas.height=e.body.scrollHeight>this.sandbox.getWindow().innerHeight?e.body.scrollHeight:this.sandbox.getWindow().innerHeight)}removeAndAnimateCanvasHide(){const e=Yt.count;this.activeCanvas=!1,this.startX=void 0,this.startY=void 0;const t=this.getCanvasElement(e),o=this.getCanvasStyleElement(e);t&&null!==t&&(t.classList.add("gcobrowse-hide"),setTimeout((()=>{t.remove(),o&&null!==o&&o.remove()}),Yt.HIDE_TIMEOUT))}draw(e){this.activeCanvas||this.createCanvas();const{isMultiTouchEvent:t}=e;if(t)return;const{isExternalEvent:o}=e;this.toggleSharerScroll(o);const{x:n,y:s}=e;void 0===this.startX&&void 0===this.startY&&(this.startX=n,this.startY=s),this.ctx&&void 0!==this.startX&&void 0!==this.startY&&(this.ctx.beginPath(),this.ctx.lineWidth=Yt.LINE_WIDTH,this.ctx.lineCap="round",this.ctx.strokeStyle=Yt.STROKE_COLOR,this.ctx.moveTo(this.startX,this.startY),this.ctx.lineTo(n,s),this.startX=n,this.startY=s,this.ctx.stroke())}toggleSharerScroll(e){const t="sharer"===this.sandbox.getRole();this.canvas&&(this.canvas.style.touchAction=e&&t?"auto":"none")}onTouchStart(e){this.createCanvas(),this.isMultiTouchEvent(e)&&this.onMultiTouch(e)}onTouchMove(e){var t,o,n,s;this.isMultiTouchEvent(e)&&this.onMultiTouch(e);const i=e,r=null!==(o=null===(t=this.getWindowElement())||void 0===t?void 0:t.scrollX)&&void 0!==o?o:0,a=null!==(s=null===(n=this.getWindowElement())||void 0===n?void 0:n.scrollY)&&void 0!==s?s:0,l=i.targetTouches[0].clientX+r,d=i.targetTouches[0].clientY+a,c=this.isMultiTouchEvent(e);this.draw({x:l,y:d,isExternalEvent:!1,isMultiTouchEvent:c}),this.sandbox.network.send("ext:draw",{x:l,y:d,isMultiTouchEvent:c})}onTouchEnd(){this.removeAndAnimateCanvasHide(),this.sandbox.network.send("ext:draw-end")}onMultiTouch(e){this.isMultiTouchEvent(e)&&this.canvas&&(this.canvas.style.touchAction="auto")}isMultiTouchEvent(e){var t;const o=e;return(null===(t=null==o?void 0:o.touches)||void 0===t?void 0:t.length)>=2}startDrawing(){this.sandbox.network.send("ext:draw-enabled"),this.createCanvas();const e=this.sandbox.getDOMRoot();if(!e)return;e.addEventListener("mousedown",this.boundOnMouseDown),e.addEventListener("touchstart",this.boundTouchStart),e.addEventListener("touchmove",this.boundTouchMove),e.addEventListener("touchend",this.boundTouchEnd);const t=e.body;t&&t.classList.add("gcobrowse-draw-active"),"viewer"===this.sandbox.getRole()&&e.head.appendChild(this.createCursorStyleElement(e))}stopDrawing(){Yt.count>0&&(this.cleanupExistingDrawingsAndStyles(),this.removeEventListeners(),this.cleanBodyAndCanvas(),this.removeViewerStyles())}removeEventListeners(){[{event:"touchstart",listener:this.boundTouchStart},{event:"touchmove",listener:this.boundTouchMove},{event:"touchend",listener:this.boundTouchEnd},{event:"mousemove",listener:this.boundOnMouseMove},{event:"mousedown",listener:this.boundOnMouseDown},{event:"mouseup",listener:this.boundOnMouseUp}].forEach((({event:e,listener:t})=>{var o;return null===(o=this.sandbox.getDOMRoot())||void 0===o?void 0:o.removeEventListener(e,t)}))}cleanBodyAndCanvas(){var e,t,o;const n=null===(e=this.sandbox.getDOMRoot())||void 0===e?void 0:e.body;n&&n.classList.remove("gcobrowse-draw-active"),this.activeCanvas=!1,null===(t=this.canvas)||void 0===t||t.remove(),null===(o=this.canvasStyle)||void 0===o||o.remove(),this.canvasStyle=void 0,this.canvas=void 0,this.ctx=void 0,this.startX=void 0,this.startY=void 0}removeViewerStyles(){var e,t;if("viewer"===this.sandbox.getRole()){const o=this.sandbox.getDOMRoot();null===(e=null==o?void 0:o.querySelector(`#${Yt.CURSOR_VIEWER_STYLE_ID}`))||void 0===e||e.remove(),null===(t=null==o?void 0:o.body)||void 0===t||t.classList.remove("gcobrowse-draw-active")}}sendDrawDisabledMessage(){try{this.sandbox.network.send("ext:draw-disabled")}catch(e){this.sandbox.log("not sending anything, already disconnected")}}onMouseDown(){var e,t,o;this.createCanvas(),null===(e=this.canvas)||void 0===e||e.classList.add(Yt.CURSOR_DRAW_CLASS),null===(t=this.sandbox.getDOMRoot())||void 0===t||t.addEventListener("mouseup",this.boundOnMouseUp),null===(o=this.sandbox.getDOMRoot())||void 0===o||o.addEventListener("mousemove",this.boundOnMouseMove)}onMouseUp(){var e;null===(e=this.sandbox.getDOMRoot())||void 0===e||e.removeEventListener("mousemove",this.boundOnMouseMove),this.removeAndAnimateCanvasHide(),this.sandbox.network.send("ext:draw-end")}onMouseMove(e){var t,o,n,s;e.preventDefault();const i=e;if(1!==i.buttons)return void this.onMouseUp();const r=null!==(o=null===(t=this.getWindowElement())||void 0===t?void 0:t.scrollX)&&void 0!==o?o:0,a=null!==(s=null===(n=this.getWindowElement())||void 0===n?void 0:n.scrollY)&&void 0!==s?s:0,l=i.clientX+r,d=i.clientY+a,c=this.isMultiTouchEvent(e);this.draw({x:l,y:d,isExternalEvent:!1,isMultiTouchEvent:c}),this.sandbox.network.send("ext:draw",{x:l,y:d,isMultiTouchEvent:c})}getCanvasElement(e){var t;return null===(t=this.sandbox.getDOMRoot())||void 0===t?void 0:t.getElementById(`${Yt.CANVAS_ID}-${e}`)}getCanvasStyleElement(e){const t=this.sandbox.getDOMRoot();return t?t.getElementById(`${Yt.CANVAS_STYLE_ID}-${e}`):null}getUIElement(){return"sharer"===this.sandbox.getRole()?this.sandbox.getRootUIElement():this.sandbox.getWorkRootUIElement()}getWindowElement(){return"sharer"===this.sandbox.getRole()?this.sandbox.getWindow():this.sandbox.getWorkWindow()}cleanupExistingDrawingsAndStyles(){var e;const t=null===(e=this.sandbox.getDOMRoot())||void 0===e?void 0:e.querySelectorAll(`[id^="${Yt.CANVAS_ID}-"]`);if(t&&t.length>0)for(const e of t)e.remove()}onDestroy(){this.stopDrawing(),this.sendDrawDisabledMessage()}}Yt.count=0,Yt.CANVAS_ID="gcobrowse-draw",Yt.CANVAS_STYLE_ID="gcobrowse-draw-style",Yt.CURSOR_DRAW_CLASS="gcobrowse-draw-cursor",Yt.CURSOR_VIEWER_STYLE_ID="gcobrowse-draw-cursor-style",Yt.ACTIVE_DRAWING="gcobrowse-draw-active",Yt.HIDE_TIMEOUT=3e3,Yt.LINE_WIDTH=1,Yt.STROKE_COLOR="#00000",Yt.CANVAS_ELEMENT=`<canvas id="${Yt.CANVAS_ID}-<uniqueId>" class="genesys-cbx-ignore"></canvas>`,Yt.CANVAS_STYLE=`\n    <style id='${Yt.CANVAS_STYLE_ID}-<uniqueId>' class="genesys-cbx-ignore">\n        #${Yt.CANVAS_ID}-<uniqueId> {\n            position: absolute;\n\t\t\ttouch-action: none;\n            opacity: 1;\n            visibility: visible;\n\t\t\tz-index: 9999999;\n        }\n\t\t#${Yt.CANVAS_ID}-<uniqueId>.${Yt.CURSOR_DRAW_CLASS} {\n\t\t\tcursor: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iIzAwMDAwMERFIj48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIj48L3BhdGg+PHBhdGggZD0iTTMgMTcuMjVWMjFoMy43NUwxNy44MSA5Ljk0bC0zLjc1LTMuNzVMMyAxNy4yNXpNMjAuNzEgNy4wNGMuMzktLjM5LjM5LTEuMDIgMC0xLjQxbC0yLjM0LTIuMzRjLS4zOS0uMzktMS4wMi0uMzktMS40MSAwbC0xLjgzIDEuODMgMy43NSAzLjc1IDEuODMtMS44M3oiPjwvcGF0aD48L3N2Zz4=) 0 24, auto;\n\t\t}\n        #${Yt.CANVAS_ID}-<uniqueId>.gcobrowse-hide {\n            transition: visibility 0s linear ${Yt.HIDE_TIMEOUT}ms, opacity ${Yt.HIDE_TIMEOUT}ms linear;\n            visibility: hidden;\n            opacity: 0;\n        }\n    </style>\n    `;class Kt extends be{constructor(e,t=""){super(e,t),this.dom=e.dom,this.network=e.network,this.iframe=e.getWorkFrame(),this.auth=e.auth,this.conversationId=e.conversationId,this.getDocument=e.getDocument.bind(e),this.storage=e.storage,this.canvas=e.canvas}getWorkFrame(){return this.iframe}}class Xt{constructor(e){this.sandbox=e,this.primaryColor=this.sandbox.getPrimaryColor()}onCreate(){this.createRootElementStyles()}createRootElementStyles(){const e=this.sandbox.getDOMRoot();e&&this.addRootStylesToDoc(e),this.addRootStylesToDoc(this.sandbox.getInstrumentedDocument())}addRootStylesToDoc(e){const t=[this.touchDeviceStyle(),this.mouseClickStyles(),this.domHighlightActiveStyles(),this.ghostPointerStyles(),this.controlBorderStyles(),this.setDrawCursor(),this.tooltipOutlineStyles()],o=e.createElement("style");o.classList.add("genesys-cbx-ignore"),o.id=Xt.ROOT_STYLES,t.forEach((e=>{o.innerHTML+=e})),e.head.appendChild(o)}importFonts(){const e=this.sandbox.getFontsURL();return`\n             @import url('${e}/roboto.css');\n             @import url('${e}/material-icons.css');\n            .icons {\n                font-family: 'material-icons';\n                font-weight: normal;\n                font-style: normal;\n                font-size: 24px;  /* Preferred icon size */\n                display: inline-block;\n                line-height: 1;\n                text-transform: none;\n                letter-spacing: normal;\n                word-wrap: normal;\n                white-space: nowrap;\n                direction: ltr;\n            \n                /* Support for all WebKit browsers. */\n                -webkit-font-smoothing: antialiased;\n                /* Support for Safari and Chrome. */\n                text-rendering: optimizeLegibility;\n            \n                /* Support for Firefox. */\n                -moz-osx-font-smoothing: grayscale;\n            \n                /* Support for IE. */\n                font-feature-settings: 'liga';\n            }`}mouseClickStyles(){return`          \n            #${Xt.CLICK_ID} {\n                position: absolute;\n                background: red;\n                height: 60px;\n                width: 60px;\n                margin: -30px;\n                opacity: 1;\n                transform: scale(0) !important;\n                border-radius: 100%;\n                z-index: 9999999;\n              }\n            #${Xt.CLICK_ID}.active {\n                transition: transform 400ms ease, opacity 400ms ease;\n                opacity: 0;\n                transform: scale(1) !important;\n              }`}domHighlightActiveStyles(){return`\n            .${Xt.DOM_HIGHLIGHT_ACTIVE_CLASS}{\n                background-color: rgba(255,0,0,0.5);\n                animation: fade-in-out 1500ms ease;\n            }\n\n            @keyframes fade-in-out {\n                0% {\n                    background-color: rgba(255,0,0,0.0);\n                }\n\n                50% {\n                    background-color: rgba(255,0,0,0.5);\n                }\n\n                100% {\n                    background-color: rgba(255,0,0,0.0);\n                }\n            }`}ghostPointerStyles(){return`\n            #${Xt.GHOST_POINTER_ID} {\n                position: fixed;\n                z-index: 9999999;\n                pointer-events: none;\n                top:100px;\n                left:100px;\n            }\n            \n            #${Xt.GHOST_POINTER_ID} svg {\n                width: 16px;\n                height: auto;\n                fill: fill: ${this.primaryColor};\n            }\n            \n            #${Xt.GHOST_POINTER_TITLE_ID} {\n                font-size: 16px;\n                font-weight: bold;\n                color: ${this.primaryColor};\n                font-family: Roboto, helvetica, sans-serif;\n                vertical-align: super;\n                margin-left: 5px;\n            }`}controlBorderStyles(){return`\n            #${Xt.BORDER_ID} {\n                position: fixed;\n                top: 0;\n                left: 0;\n                bottom: 0;\n                right: 0;\n                border: ${Xt.BORDER_SIZE}px solid ${this.primaryColor};\n                pointer-events: none;\n                z-index: 2147483647;\n            }\n            html.${Xt.ACTIVE_SCREEN_SHARED_CLASS} {\n                overscroll-behavior: none;\n            }\n        `}tooltipOutlineStyles(){return`\n            [data-gcobrowse-masked] {\n                outline: 1px solid transparent;\n                transition: outline 0.5s;\n            }\n            [data-gcobrowse-masked]:hover {\n                outline-color: ${this.sandbox.getPrimaryColor()};\n            }\n        `}setDrawCursor(){return`body.${Xt.DRAW_ACTIVE} {\n            cursor: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iIzAwMDAwMERFIj48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIj48L3BhdGg+PHBhdGggZD0iTTMgMTcuMjVWMjFoMy43NUwxNy44MSA5Ljk0bC0zLjc1LTMuNzVMMyAxNy4yNXpNMjAuNzEgNy4wNGMuMzktLjM5LjM5LTEuMDIgMC0xLjQxbC0yLjM0LTIuMzRjLS4zOS0uMzktMS4wMi0uMzktMS40MSAwbC0xLjgzIDEuODMgMy43NSAzLjc1IDEuODMtMS44M3oiPjwvcGF0aD48L3N2Zz4=), auto !important;\n        }`}touchDeviceStyle(){return window.matchMedia("(pointer: coarse)").matches?"html {\n                    overflow: hidden;\n                    width: 100%;\n                }\n                \n                body {\n                    height: 100%;\n                    position: fixed;\n                    overflow: auto;\n                    -webkit-overflow-scrolling: touch;\n                }":null}onDestroy(){var e,t,o;null===(t=null===(e=this.sandbox.getDOMRoot())||void 0===e?void 0:e.querySelector(Xt.ROOT_STYLES))||void 0===t||t.remove(),null===(o=this.sandbox.getInstrumentedDocument().querySelector(Xt.ROOT_STYLES))||void 0===o||o.remove()}}Xt.TOOLBAR_ID="gcobrowse-sharer-toolbar",Xt.TOOLBAR_SCREEN_SHARE="gcobrowse-toolbar-screen-share",Xt.TOOLBAR_REQUEST_CONTROL="gcobrowse-toolbar-request-control",Xt.TOOLBAR_CONTROL_GRANTED="gcobrowse-toolbar-control-granted",Xt.DRAW_BUTTON_ID="gcobrowse-draw-ui",Xt.SHARER_BUTTON_ID="gcobrowse-stop-session-ui",Xt.BUTTON_ACCEPT_ID="gcobrowse-control-accept",Xt.BUTTON_DECLINE_ID="gcobrowse-control-decline",Xt.BUTTON_REVOKE_ID="gcobrowse-control-revoke",Xt.BUTTON_END_SESSION_ID="gcobrowse-end-session",Xt.TOOLTIP_REQUEST_CONTROL="gcobrowse-request-control-info-tooltip",Xt.TOOLTIP_REQUEST_CONTROL_TEXT="gcobrowse-request-control-info-text",Xt.GHOST_POINTER_TITLE_ID="gcobrowse-ghost-pointer-title",Xt.GHOST_POINTER_ID="gcobrowse-ghost-pointer",Xt.SHARER_ACTIONS="gcobrowse-sharer-actions",Xt.DRAW_ACTIVE="gcobrowse-draw-active",Xt.CLICK_ID="gcobrowse-click",Xt.ACTIVE_SCREEN_SHARED_CLASS="gcobrowse_screen_being_shared",Xt.BORDER_SIZE=5,Xt.BORDER_ID="gcobrowse-border",Xt.CANVAS_STYLE_ID="gcobrowse-draw-style",Xt.IFRAME_STYLES="gcobrowse-iframe-styles",Xt.ROOT_STYLES="gcobrowse-styles",Xt.DOM_HIGHLIGHT_ACTIVE_CLASS="gcobrowse-element-highlight",Xt.TOUCH_MOBILE_STYLES="gcobrowse-touch-styles";class Jt{constructor(e){this.sandbox=e}onCreate(){this.sandbox.network.subscribe("ext:mouse-click-dom-highlight",(e=>{this.highlightDOMelement(e.nodeId)}))}highlightDOMelement(e){let t;t=this.sandbox instanceof ye||this.sandbox instanceof Kt?this.sandbox.dom.getNodeById(e):null,t&&(t.classList.add(Jt.ACTIVE_CLASS),this.stopAnimationHandler(t))}stopAnimationHandler(e){e.addEventListener("animationend",(()=>{var t,o;e.classList.remove(Jt.ACTIVE_CLASS),null===(o=null===(t=e.shadowRoot)||void 0===t?void 0:t.querySelector(`#${Jt.HIGHLIGHT_ID}`))||void 0===o||o.remove(),e.removeEventListener("animationend",(()=>!1))}))}onDestroy(){var e;null===(e=document.getElementsByClassName(Jt.ACTIVE_CLASS)[0])||void 0===e||e.removeEventListener("animationend",(()=>!1))}}Jt.ACTIVE_CLASS=Xt.DOM_HIGHLIGHT_ACTIVE_CLASS,Jt.HIGHLIGHT_ID="gcobrowse-highlight-style";class Zt{constructor(e){this.sandbox=e,this.visibilityChanged=this.handleVisibilityChange.bind(this)}onCreate(){}onSessionStart(){this.setVisibilityEventListener()}setVisibilityEventListener(){var e;null===(e=this.sandbox.getDOMRoot())||void 0===e||e.addEventListener("visibilitychange",this.visibilityChanged)}handleVisibilityChange(){var e;this.sandbox.network.send("sharer:focus",{hidden:"hidden"===(null===(e=this.sandbox.getDOMRoot())||void 0===e?void 0:e.visibilityState)})}onDestroy(){var e;null===(e=this.sandbox.getDOMRoot())||void 0===e||e.removeEventListener("visibilitychange",this.visibilityChanged)}}const Qt=Xt.ACTIVE_SCREEN_SHARED_CLASS;class eo{constructor(e){this.sandbox=e}onCreate(){}onSessionStart(){this.initBorder()}onDestroy(){var e,t;const o=null===(e=this.sandbox.getDOMRoot())||void 0===e?void 0:e.getElementById(Xt.BORDER_ID);null==o||o.remove(),null===(t=this.sandbox.getDOMRoot())||void 0===t||t.documentElement.classList.remove(Qt)}initBorder(){const e=this.sandbox.getDOMRoot();if(!(null==e?void 0:e.getElementById(Xt.BORDER_ID))&&e){const t=e.createElement("div");t.setAttribute("id",Xt.BORDER_ID),t.classList.add("genesys-cbx-ignore"),e.body.appendChild(t),e.documentElement.classList.add(Qt)}}}class to{constructor(e){this.sandbox=e,this.boundOnViewerFocusingEvent=this.onViewerFocusingEvent.bind(this),this.boundOnViewerFocusOutEvent=this.onViewerFocusOutEvent.bind(this),this.boundOnSharerFocusingEvent=this.onSharerFocusingEvent.bind(this),this.boundOnSharerFocusOutEvent=this.onSharerFocusOutEvent.bind(this)}onCreate(){}onSessionStart(){const e=this.sandbox.getDOMRoot();null==e||e.addEventListener("click",this.boundOnSharerFocusingEvent),null==e||e.addEventListener("mousedown",this.boundOnSharerFocusingEvent),null==e||e.addEventListener("keydown",this.boundOnSharerFocusingEvent),null==e||e.addEventListener("focusin",this.boundOnSharerFocusingEvent),null==e||e.addEventListener("focusout",this.boundOnSharerFocusOutEvent),this.sandbox.network.subscribe("viewer:input-focus",this.boundOnViewerFocusingEvent),this.sandbox.network.subscribe("viewer:input-focusout",this.boundOnViewerFocusOutEvent)}onSharerFocusingEvent(e){const t=e.target;if("INPUT"===t.tagName.toUpperCase()||"TEXTAREA"===t.tagName.toUpperCase()){const e=this.sandbox.dom.getNodeId(t);this.sandbox.network.send("ext:sharer-input-focus",{nodeId:e})}}onSharerFocusOutEvent(e){const t=e.target;if("INPUT"===t.tagName.toUpperCase()||"TEXTAREA"===t.tagName.toUpperCase()){const e=this.sandbox.dom.getNodeId(t);this.sandbox.network.send("ext:sharer-input-focusout",{nodeId:e})}}onViewerFocusingEvent(e){const t=this.getFocusedNodeById(e.nodeId);this.setFocus(t)}onViewerFocusOutEvent(e){const t=this.getFocusedNodeById(e.nodeId);this.sandbox.events.replayFocusOut(t)}setFocus(e){e.focus()}getFocusedNodeById(e){const t=this.sandbox.dom.getNodeById(e);if(t)return t;throw new Error("Could not find Node")}onDestroy(){const e=this.sandbox.getDOMRoot();null==e||e.removeEventListener("mousedown",this.boundOnSharerFocusingEvent),null==e||e.removeEventListener("click",this.boundOnSharerFocusingEvent),null==e||e.removeEventListener("keydown",this.boundOnSharerFocusingEvent),null==e||e.removeEventListener("focusin",this.boundOnSharerFocusingEvent),null==e||e.removeEventListener("focusout",this.boundOnSharerFocusOutEvent)}}class oo{constructor(e){this.sandbox=e}onCreate(){}onMouseOver(e){const t=e.target;if(t&&this.sandbox.dom.isSynchronized(t)){const o=e.composedPath();t.classList.add(oo.HOVER_CLASS);const n=this.sandbox.dom.getNodeId(t);this.sandbox.network.send("hover-in",{nodeId:n});o.filter((e=>{const t=e;return t.nodeName&&"window"!==t.nodeName&&"#document"!==t.nodeName&&"#text"!==t.nodeName})).forEach((e=>{var t,o;const n=e;n&&((null===(t=n.classList)||void 0===t?void 0:t.contains(oo.HOVER_CLASS))||null===(o=n.classList)||void 0===o||o.add(oo.HOVER_CLASS))}))}}onMouseOut(e){const t=e.target;if(t&&this.sandbox.dom.isSynchronized(t)){t.classList.remove(oo.HOVER_CLASS);const o=e.composedPath(),n=this.sandbox.dom.getNodeId(t);this.sandbox.network.send("hover-out",{nodeId:n});o.filter((e=>null!==e&&e!==window&&e!==document&&"#text"!==e.nodeName)).forEach((e=>{var t,o;const n=e;n&&(null===(t=n.classList)||void 0===t?void 0:t.contains(oo.HOVER_CLASS))&&(null===(o=n.classList)||void 0===o||o.remove(oo.HOVER_CLASS))}))}}onDestroy(){}}oo.HOVER_CLASS="genesys_hover";class no extends oo{constructor(e){super(e),this.sandbox=e,this.boundOnMouseOverEvent=this.onMouseOver.bind(this),this.boundOnMouseOutEvent=this.onMouseOut.bind(this),this.currentElem=null,this.proxyEnabled=R}onCreate(){this.proxyEnabled&&(this.sandbox.network.subscribe("hover-in",(e=>{const t=this.sandbox.dom.getNodeById(e.nodeId);this.findParents(t).forEach((e=>{var t;(null===(t=e.classList)||void 0===t?void 0:t.contains(no.HOVER_CLASS))||e.classList.add(no.HOVER_CLASS)}))})),this.sandbox.network.subscribe("hover-out",(e=>{const t=this.sandbox.dom.getNodeById(e.nodeId);this.findParents(t).forEach((e=>{e.classList.remove(no.HOVER_CLASS)}))})))}onSessionStart(){const e=this.sandbox.getDOMRoot();this.proxyEnabled&&(null==e||e.addEventListener("mouseover",this.boundOnMouseOverEvent),null==e||e.addEventListener("mouseout",this.boundOnMouseOutEvent))}findParents(e){const t=[];for(t.push(e);e.parentElement;)e=e.parentElement,t.push(e);return t}onDestroy(){const e=this.sandbox.getDOMRoot();null==e||e.removeEventListener("mouseover",this.boundOnMouseOverEvent),null==e||e.removeEventListener("mouseout",this.boundOnMouseOutEvent)}}no.HOVER_CLASS="genesys_hover";class so{constructor(e){this.sandbox=e}onCreate(){this.sandbox.network.subscribe("viewer:navigation-request",(e=>{this.sandbox.notify("int:navigation-requested",e)})),this.sandbox.listen("int:navigation-accepted",(e=>{this.performNavigation(e.data.url)})),this.sandbox.listen("int:navigation-declined",(e=>{this.sandbox.network.send("sharer:navigation-declined",{url:e.data.url})}))}performNavigation(e){this.sandbox.network.send("sharer:navigation-accepted",{url:e}),setTimeout((()=>{this.sandbox.getWindow().location.assign(e)}),500)}onDestroy(){}}class io{constructor(e){this.sandbox=e,this.checkers={}}onCreate(){}onSessionStart(){this.sandbox.dom.onCanvas(((e,t)=>{this.createAndStartChecker(e,t)}))}createAndStartChecker(e,t){const o=this.sandbox.canvas.createChecker(e,io.RECHECK_INTERVAL);this.checkers[t]=o,o.onChange(this.createOnChangeCallback(t)),o.onStop((()=>{this.sandbox.log("stopped watching canvas",t)})),o.start()}createOnChangeCallback(e){return(t,o)=>r(this,void 0,void 0,(function*(){if(t)this.sandbox.log("failed to watch canvas",e,t);else{this.sandbox.log("canvas changed",e);try{yield this.sendBlob(e,o),this.sandbox.log("canvas sent",e)}catch(t){this.sandbox.log("failed to send canvas",e,t)}}}))}sendBlob(e,t){return r(this,void 0,void 0,(function*(){let o="";t&&(o=yield this.sandbox.canvas.blobToBase64(t)),this.sandbox.network.send("sharer:canvas-changed",{nodeId:e,canvas:o})}))}onDestroy(){for(const e in this.checkers)this.checkers[e].stop();this.checkers={}}}io.RECHECK_INTERVAL=3e3;
/*! https://mths.be/punycode v1.4.1 by @mathias */
var ro=2147483647,ao=36,lo=1,co=26,ho=38,uo=700,go=72,po=128,mo="-",vo=/^xn--/,fo=/[\x2E\u3002\uFF0E\uFF61]/g,bo={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},yo=ao-lo,wo=Math.floor,Eo=String.fromCharCode;function So(e){throw new RangeError(bo[e])}function Co(e,t){for(var o=e.length,n=[];o--;)n[o]=t(e[o]);return n}function xo(e,t,o){var n=0;for(e=o?wo(e/uo):e>>1,e+=wo(e/t);e>yo*co>>1;n+=ao)e=wo(e/yo);return wo(n+(yo+1)*e/(e+ho))}function ko(e){var t,o,n,s,i,r,a,l,d,c,h,u=[],g=e.length,p=0,m=po,v=go;for((o=e.lastIndexOf(mo))<0&&(o=0),n=0;n<o;++n)e.charCodeAt(n)>=128&&So("not-basic"),u.push(e.charCodeAt(n));for(s=o>0?o+1:0;s<g;){for(i=p,r=1,a=ao;s>=g&&So("invalid-input"),((l=(h=e.charCodeAt(s++))-48<10?h-22:h-65<26?h-65:h-97<26?h-97:ao)>=ao||l>wo((ro-p)/r))&&So("overflow"),p+=l*r,!(l<(d=a<=v?lo:a>=v+co?co:a-v));a+=ao)r>wo(ro/(c=ao-d))&&So("overflow"),r*=c;v=xo(p-i,t=u.length+1,0==i),wo(p/t)>ro-m&&So("overflow"),m+=wo(p/t),p%=t,u.splice(p++,0,m)}return Co(u,(function(e){var t="";return e>65535&&(t+=Eo((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+Eo(e)})).join("")}function Io(e){return o=function(e){return vo.test(e)?ko(e.slice(4).toLowerCase()):e},n=(t=e).split("@"),s="",n.length>1&&(s=n[0]+"@",t=n[1]),s+Co((t=t.replace(fo,".")).split("."),o).join(".");var t,o,n,s}class To{constructor(e){this.sandbox=e,this.boundOnURLChange=this.onURLChange.bind(this),this.pauseCriteria=[]}onCreate(){}onSessionStart(){var e;const t=this.sandbox.getDeploymentOptions();t.allowPause&&(null===(e=t.pauseCriteria)||void 0===e?void 0:e.length)&&(this.pauseCriteria.push(...t.pauseCriteria),this.pausePage(this.sandbox.getWindow().location.toString()),this.sandbox.getWindow().addEventListener("popstate",this.boundOnURLChange),this.sandbox.getWindow().addEventListener("hashchange",this.boundOnURLChange))}onURLChange(){this.pausePage(this.sandbox.getWindow().location.toString())}pausePage(e){if(this.shouldPausePage(e))this.sandbox.log.info("URL meets the pause criteria, pausing initiated."),this.sandbox.notify("int:pause"),this.sandbox.network.send("pause"),this.sandbox.storage.setPauseState(!0);else{const e=this.sandbox.storage.getPauseState();e&&"true"===e&&(this.sandbox.log.info("No pause criteria matched for this URL, proceeding with sharing.."),this.sandbox.notify("int:unpause"),this.sandbox.network.send("unpause"),this.sandbox.storage.setPauseState(!1))}}shouldPausePage(e){const t=this.normalizeURL(e).toLowerCase(),o=e.toLowerCase(),n=this.getCheckers();return this.pauseCriteria.some((({condition:e,urlFragment:s})=>{const i=s.toLowerCase(),r=n[e];return r?"DoesNotInclude"===e?r(t,i)&&r(o,i):r(t,i)||r(o,i):(this.sandbox.log.error(`Unknown pause condition: ${e}`),!1)}))}normalizeURL(e){try{const t=e.replace(/xn--[\w-]+/gi,(e=>Io(e)));return decodeURIComponent(t)}catch(t){return this.sandbox.log.error("Error normalizing URL:",t),e}}getCheckers(){return{Includes:(e,t)=>e.includes(t),DoesNotInclude:(e,t)=>!e.includes(t),StartsWith:(e,t)=>e.startsWith(t),EndsWith:(e,t)=>e.endsWith(t),Equals:(e,t)=>e===t}}onDestroy(){this.sandbox.getWindow().removeEventListener("hashchange",this.boundOnURLChange),this.sandbox.getWindow().removeEventListener("popstate",this.boundOnURLChange),this.sandbox.storage.removePauseState()}}class Do{constructor(e,t,o){this.core=e,this.plugin=t,this.headlessMode=o,this.log=e.createLogger("Sharer"),this.session=e.session,e.pubsub.listenForever("int:session-ready",(e=>{var t;try{this.core.network.send("ext:sharer-joined",{id:e.data.joinCode,deviceType:this.core.getDeviceInfo()}),this.core.startAll(e.data.joinCode),null===(t=this.core.getRootUIElement())||void 0===t||t.classList.add("gcobrowse_screen_being_shared"),this.renderUI(),this.core.storage.storeSessionState(e.data.joinCode)}catch(e){const t=e;this.log(`Failed to start session: ${t.message}`),this.core.network.leaveSession().then((()=>{this.core.pubsub.notify("int:session-end")})).catch((e=>{this.log(`Error while leaving session: ${e}`)}))}})),this.core.pubsub.listenForever("int:session-end",(()=>{this.onSessionEnd()})),this.core.pubsub.listen("int:sharer-reconnected",(e=>{this.core.reconnectAll(e.data.joinCode)})),this.core.pubsub.listenForever("int:session-load-failed",(()=>{this.onSessionEnd()})),this.core.pubsub.listenForever("int:session-options",(e=>{var t,o,n,s,i,r,a;this.core.setDeploymentOptions(e.data.options),this.core.pubsub.notify("int:session-options-ready",(t=e.data.options,{maxPayloadSize:null!==(o=null==t?void 0:t.maxPayloadSize)&&void 0!==o?o:73400320,enableMouseCursors:!1!==(null==t?void 0:t.enableMouseCursors),allowAgentControl:!0===(null==t?void 0:t.allowAgentControl),allowAgentNavigation:null===(n=null==t?void 0:t.allowAgentNavigation)||void 0===n||n,maskSelectors:null!==(s=null==t?void 0:t.maskSelectors)&&void 0!==s?s:[],readonlySelectors:null!==(i=null==t?void 0:t.readonlySelectors)&&void 0!==i?i:[],allowedDomains:null!==(r=null==t?void 0:t.allowedDomains)&&void 0!==r?r:[],pauseCriteria:null!==(a=null==t?void 0:t.pauseCriteria)&&void 0!==a?a:[]}))})),this.core.network.subscribe("viewer:reconnected",(e=>{this.core.startAll(e.joinCode)})),this.core.pubsub.listenForever("int:pause",(()=>{this.core.pauseAll()})),this.core.pubsub.listenForever("int:unpause",(()=>{this.core.unPauseAll()})),this.core.pubsub.listenForever("int:user-requested-join",(e=>{this.session.join(e.data.joinCode)})),this.core.pubsub.listenForever("int:user-requested-rejoin",(()=>{this.session.rejoin()})),this.core.pubsub.listenForever("int:user-requested-stop",(()=>{this.session.leave()})),this.onPageLoad()}onPageLoad(){return r(this,void 0,void 0,(function*(){this.log("page loaded"),this.log("patching the canvas to attempt the webgl support"),function(){const e=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(t,o){return"webgl"===t&&(o=Object.assign({},o,{preserveDrawingBuffer:!0})),e.call(this,t,o)}}(),this.log("checking if there is an ongoing session");const e=this.getRememberedSession();e?(this.log(`rejoining session ${e}`),yield this.core.loadi18n(),this.log("fetched i18n, about to register modules"),this.createModules(),this.core.pubsub.notify("int:user-requested-rejoin")):this.log("did not find an ongoing session to rejoin")}))}createModules(){this.registerAllModules(),this.core.createAll()}stopAndDestroyAllModules(){var e;this.log("stopping all modules"),this.core.destroyAll(),this.core.deregisterAll(),null===(e=this.toolbar)||void 0===e||e.onDestroy(),this.toolbar=void 0,this.log("stopped all modules")}registerAllModules(){const e=this.core;this.log("registering modules"),e.register("dom",Lt),e.register("mousemove",Nt),e.register("mousemoveUI",At),e.register("click",Pt),e.register("mouseclickUI",jt),e.register("input",$t),e.register("scroll",Vt),e.register("tooltip",qt),e.register("CSS",Xt),e.register("sharercontrol",Wt),e.register("sharerresize",Ht),e.register("sharerselectinput",Ft),e.register("draw",Yt),e.register("DomHighlight",Jt),e.register("pageinfocus",Zt),e.register("border",eo),e.register("focus",to),e.register("pushUrl",so),e.register("pause",To),"GENESYS_COBROWSE_DEBUG_DOM"in window||"GENESYS_COBROWSE_DEBUG_SCROLL"in window||e.register("hover",no),e.register("canvas",io),this.log("registered modules")}onSessionEnd(){this.core.storage.removeStoredSessionState(),setTimeout((()=>{var e;this.stopAndDestroyAllModules(),this.log("clearing registered event listeners"),this.core.pubsub.clearEventListeners(),this.log("event listeners removed"),this.log("removing all added elements from sharer"),null===(e=this.core.getRootUIElement())||void 0===e||e.classList.remove("gcobrowse_screen_being_shared");document.querySelectorAll(".genesys-cbx-style").forEach((e=>{e.remove()}))}),0)}getRememberedSession(){const e=this.core.storage.getStoredSessionState();return this.log(`session state stored: ${e}`),e}renderUI(){if(this.headlessMode)return void this.log("headless mode - no built-in UI");this.log("creating the toolbar UI");const e=this.core.getAssetsURL()+"/sharer-toolbar.html?lang="+this.core.getLang();this.toolbar=new Gt(this.core.geti18n(),this.plugin,this.core.storage,e),this.toolbar.onCreate(),this.log("toolbar started")}}class Lo{constructor(e,t,o){this.log=i("l10n",o),this.baseUrl=new URL(t);let n=e;Lo.supportedLangs.includes(e)||(this.log.info(`unsupported lang ${e}`),n="en-us"),this.log(`locale: ${n}`),this.lang=n}loadJsLocale(){return r(this,void 0,void 0,(function*(){this.log(`fetching locale: ${this.lang}`);const e=new URL(this.baseUrl);e.pathname+=`/${this.lang}.json`,e.pathname=e.pathname.replace("//","/");const t=yield this.fetch(e.toString());if(!t.ok)throw new Error("Network response for localization was not OK");return t.json()}))}fetch(e){return fetch(e)}}Lo.supportedLangs="ar cs da de en-us es et fi fr he it ja ko lt lv nl no pl pt-br pt-pt ru sv th tr uk zh-cn zh-tw".split(" ");let Oo="ERROR",No="#0071BC",Ro=!1;let Mo,Ao;const _o=i("CXBusPlugin");function Po(e){return e.data("offerState")}function Uo(e,t,o){function n(o,n,s){const i={sessionId:n,offerState:o,timeout:s||null,timestamp:Date.now()};return e.data("offerState",i),t.storage.setOfferState(i)}function s(){const t=e.data("activeSession");return t&&"object"==typeof t&&("joinCode"in t||"sessionId"in t)}e.registerEvents(["sessionStarted","sessionDeclined","sessionEnded","controlRequested","controlGranted","controlRevoked","navigationRequested","navigationGranted","navigationDeclined","drawing","paused","unpaused"]),e.registerCommand("configure",(e=>{var o,n,s,i;_o("CXBus configure command called with",e.data.config);const r=e.data.config;(null===(n=null===(o=null==r?void 0:r.messenger)||void 0===o?void 0:o.styles)||void 0===n?void 0:n.primaryColor)&&"string"==typeof(null===(i=null===(s=null==r?void 0:r.messenger)||void 0===s?void 0:s.styles)||void 0===i?void 0:i.primaryColor)&&(t.primaryColor=r.messenger.styles.primaryColor),(null==r?void 0:r.id)&&"string"==typeof r.id&&(_o("Setting Deployment Id to ",r.id),t.setDeploymentId(r.id))})),e.registerCommand("offerState",(o=>r(this,void 0,void 0,(function*(){const i=o.data.joinCode;let r,a;_o("CXBus offerState command called with: ",o);try{r=t.storage.getOfferState(i)}catch(t){_o.error("Error while getting offer states",t),e.data("offerState",!1),o.reject(t.message)}if(r&&r.length&&(_o(`offer state found in storage for session ${i}: `,r,r[0]),a=r[0]),!a&&s()&&(n("failed",i),a=Po(e),_o(`another session in progress, setting offer state to "failed" for session ${i}`)),!a){_o(`offer state not found in storage for session ${i}`);try{let e="expired",o=null;_o(`offer state not found in storage for session ${i}, assuming it has expired`);const s=yield t.network.fetchSessionInfo(i);if(s.ok){_o(`actually, turns out user has not yet accepted, so marking offer as "active" for session ${i}`),e="active";const t=(yield s.json()).dateOfferEnds;o=Date.parse(t)}else n(e,i);a={sessionId:i,offerState:e,timeout:o,timestamp:Date.now()}}catch(t){return _o(`error getting state data, rejecting offerState command for session ${i}`,t),e.data("offerState",!1),void o.reject(t.message)}}e.data("offerState",a),_o(`resolving offerState command for session ${i} with: `,a.offerState,a),o.resolve(a)})))),e.registerCommand("acceptSession",(i=>r(this,void 0,void 0,(function*(){let r;_o("CXBus acceptSession",i.data),r="string"==typeof i.data?i.data:i.data.joinToken||i.data.joinCode;if("string"!=typeof r||"string"!=typeof r)throw _o.error("Got wrong data from CXBus caller: ",i),new Error("acceptSession requires cobrowse `joinCode` as a string");if(s())return _o.error("Cannot call acceptSession while another session is in progress"),void i.reject({code:"COBROWSEACTIVE"});n("accepted",r),e.data("activeSession",{sessionId:r,joinCode:r});try{t.geti18n(),_o("localization was already loaded")}catch(e){_o("localization was not loaded, loading"),yield t.loadi18n()}_o(`begin session ${r}`),o.createModules(),t.pubsub.notify("int:user-requested-join",{joinCode:r}),t.pubsub.listen("int:session-ready",(e=>{e.data.joinCode===r&&i.resolve()})),t.pubsub.listen("int:session-load-failed",(()=>{e.data("activeSession",void 0),i.reject({code:"JOINFAILURE"})}))})))),e.registerCommand("declineSession",(o=>r(this,void 0,void 0,(function*(){_o("CXBus declineSession",o.data);const s=o.data.sessionId,i=o.data.joinToken||o.data.joinCode;e.publish("sessionDeclined",{sessionId:s,joinCode:i}),e.publish("sessionDeleted",{sessionId:s,joinCode:i}),n("rejected",i);try{yield t.network.deleteSession(null!=s?s:i)}catch(e){_o("Failed to delete session: ",e)}o.resolve()})))),e.registerCommand("stopSession",(o=>{_o("CXBus stopSession"),s()?(e.data("activeSession",void 0),t.pubsub.notify("int:user-requested-stop")):(_o("Looks like there is no active session to stop"),o.reject()),o.resolve()})),e.registerCommand("clear",(t=>r(this,void 0,void 0,(function*(){return _o("CXBus clear"),t.commander?"Genesys"!==t.commander&&"Messenger"!==t.commander?t.reject(`${t.commander} plugin does not have permission to access clear command`):(s()?yield e.command("stopSession"):_o("Looks like there is no active session to clear"),e.publish("cleared"),void t.resolve()):t.reject("Commander is missing or invalid.")})))),e.registerCommand("acceptControl",(o=>{if(_o("CXBus acceptControl"),s()&&e.data("controlRequested"))return t.pubsub.notify("int:control-enable"),e.data("controlRequested",!1),i&&(e.command("Toaster.decline"),i=!1),void o.resolve();_o("Cannot accept control as it was not requested"),o.reject()})),e.registerCommand("declineControl",(o=>{if(_o("CXBus declineControl"),e.data("controlRequested",!1),!s())return _o("Cannot decline control as no active session"),void o.reject();i&&(e.command("Toaster.decline"),i=!1),t.pubsub.notify("int:control-disable"),o.resolve()})),e.registerCommand("acceptNavigation",(o=>{if(_o("CXBus acceptNavigation"),!s())return _o("no active session, exiting"),o.reject();i&&(e.command("Toaster.decline"),i=!1);const n=e.data("navigationRequestedUrl");if("string"!=typeof n)return _o("Unexpected url ",n),void o.reject();e.publish("navigationGranted"),e.data("navigationRequested",!1),e.data("navigationRequestedUrl",!1),t.pubsub.notify("int:navigation-accepted",{url:n}),o.resolve()})),e.registerCommand("declineNavigation",(o=>{_o("CXBus declineNavigation");const n=e.data("navigationRequestedUrl");return e.data("navigationRequested",!1),e.data("navigationRequestedUrl",!1),s()?(i&&(e.command("Toaster.decline"),i=!1),"string"!=typeof n?(_o("Unexpected url ",n),void o.reject(new Error("Invalid navigation url"))):(t.pubsub.notify("int:navigation-declined",{url:n}),e.publish("navigationDeclined"),void o.resolve())):(_o("Cannot decline navigation as no active session"),void o.reject())})),e.registerCommand("startDrawing",(o=>{if(_o("CXBus startDrawing"),!s())return _o("no active session, exiting"),o.reject();t.pubsub.notify("int:draw-start"),e.data("drawing",!0),o.resolve()})),e.registerCommand("stopDrawing",(o=>{if(_o("CXBus stopDrawing"),!s())return _o("no active session, exiting"),o.reject();t.pubsub.notify("int:draw-end"),e.data("drawing",!1),o.resolve()}));let i=!1;e.subscribe("Toaster.accepted",(()=>{const t=e.data("navigationRequested"),o=e.data("controlRequested");t&&(i=!1,e.command("acceptNavigation")),o&&(i=!1,e.command("acceptControl"))})),e.subscribe("Toaster.declined",(()=>{const t=e.data("navigationRequested"),o=e.data("controlRequested");t&&(i=!1,e.command("declineNavigation")),o&&(i=!1,e.command("declineControl"))})),e.subscribe("Toaster.opened",(()=>{const t=!!e.data("navigationRequested"),o=!!e.data("controlRequested");(t||o)&&(i=!0)})),e.subscribe("Toaster.closed",(()=>{i=!1})),e.subscribe("Cobrowse.ready",(()=>{!!e.data("controlGranted")&&e.publish("controlGranted"),e.data("paused")&&"true"===t.storage.getPauseState()?e.publish("paused"):e.publish("unpaused")})),e.subscribe("Messenger.ready",(()=>{if(s()){const t=e.data("activeSession");e.publish("sessionStarted",{sessionId:t.sessionId,joinCode:t.joinCode})}})),e.subscribe("Auth.loggedOut",(()=>{e.command("stopSession")})),e.subscribe("MessengerHelper.onWebSocketMessage",(t=>{var o;"ConnectionClosedEvent"===(null===(o=null==t?void 0:t.data)||void 0===o?void 0:o.class)&&e.command("stopSession")})),e.subscribe("MessagingService.cobrowseOffer",(e=>{var o,n;if(!s())return void _o("No active Session returning");const i=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.sessionId,r=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.sessionJoinToken;t.network.deleteSession(i).then((()=>{_o(`deleted session ${r} as another one is in progress`)}),(()=>{_o(`failed to delete session ${r}`)}))})),t.pubsub.listenForever("int:session-ready",(t=>{const o=t.data,s=Po(e);(null==s?void 0:s.sessionId)&&(s.sessionId===o.joinCode&&"active"===s.offerState?n("accepted",o.joinCode):s.sessionId===o.id&&"active"===s.offerState&&n("accepted",o.id)),e.publish("sessionStarted",{sessionId:o.id,joinCode:o.joinCode}),e.data("activeSession",{sessionId:t.data.id,joinCode:t.data.joinCode})})),t.pubsub.listenForever("int:session-offering-sent",(e=>{n("active",e.data.sessionId,e.data.offerTimeout)})),t.pubsub.listenForever("int:session-end",(()=>{_o("Session ended"),e.data("activeSession",void 0),e.data("offerState",void 0),e.data("controlRequested",!1),e.data("navigationRequested",!1),e.data("controlGranted",!1),i&&(e.command("Toaster.decline"),i=!1),e.publish("sessionEnded")})),t.pubsub.listenForever("int:session-expired",(e=>{n("expired",e.data.sessionId)})),t.pubsub.listenForever("int:control-requested",(()=>{var o,n,s,r;e.data("controlRequested",!0),e.publish("controlRequested"),Ro||i||e.command("Toaster.open",{title:null===(o=t.i18n)||void 0===o?void 0:o.requestControlHeader,body:null===(n=t.i18n)||void 0===n?void 0:n.requestControlDescription,buttons:{type:"binary",primary:null===(s=t.i18n)||void 0===s?void 0:s.accept,secondary:null===(r=t.i18n)||void 0===r?void 0:r.decline}}).catch((e=>{_o(`Error while calling Toaster Open: ${e.message}`)}))})),t.pubsub.listenForever("int:control-granted",(()=>{e.publish("controlGranted"),e.data("controlGranted",!0),e.data("controlRequested",!1)})),t.pubsub.listenForever("int:control-revoked",(()=>{e.publish("controlRevoked"),e.data("controlGranted",!1),e.data("controlRequested",!1)})),t.pubsub.listenForever("int:navigation-requested",(o=>{var n,s,r,a;e.data("navigationRequested",!0),e.publish("navigationRequested",{url:o.data.url}),e.data("navigationRequestedUrl",o.data.url),i||e.command("Toaster.open",{title:null===(n=t.i18n)||void 0===n?void 0:n.requestNavigationTitle,body:null===(s=t.i18n)||void 0===s?void 0:s.requestNavigationBody,buttons:{type:"binary",primary:null===(r=t.i18n)||void 0===r?void 0:r.requestNavigationAccept,secondary:null===(a=t.i18n)||void 0===a?void 0:a.requestNavigationDecline}}).catch((e=>{_o(`Error while calling Toaster Open. Error: ${e.message}`)}))})),t.pubsub.listenForever("int:pause",(()=>{var o,n;i&&e.command("Toaster.decline"),Ro||(e.command("Toaster.open",{title:null===(o=t.i18n)||void 0===o?void 0:o.sharingPausedTitle,body:null===(n=t.i18n)||void 0===n?void 0:n.sharingPausedDescription}).catch((e=>{_o(`Error while calling Toaster Open. Error: ${e.message}`)})),i=!0),e.data("paused",!0),e.publish("paused")})),t.pubsub.listenForever("int:unpause",(()=>{var o,n;i&&e.command("Toaster.decline"),Ro||e.command("Toaster.open",{title:null===(o=t.i18n)||void 0===o?void 0:o.sharingResumedTitle,body:null===(n=t.i18n)||void 0===n?void 0:n.sharingResumedDescription}).catch((e=>{_o(`Error while calling Toaster Open. Error: ${e.message}`)})),e.data("paused",!1),e.publish("unpaused")})),e.data("activeSession",void 0),e.data("controlRequested",!1),e.data("controlGranted",!1),e.data("navigationRequested",!1),e.data("navigationRequestedUrl",!1),e.data("paused",!1),e.ready()}function jo(e,t=window.navigator){const o=function(e=window.navigator){const t=e.languages&&e.languages[0]||e.language;return t&&"string"==typeof t?t.toLowerCase():""}(t);if(e){const t=e.defaultLanguage;let n=e.languages||void 0;return n&&(n=n.map((e=>e.toLowerCase()))),n&&-1!==n.indexOf(o)?Mo=o:t&&(Mo=t),Mo}const n="Default language not specified";throw _o.error(n),Error(n)}const zo=new class{registerWithCXBus2(){const e=window;if(!function(e){return"Genesys"in e}(e))throw new Error("Failed to register with CXBus. Make sure you have genesys.js loaded on the page to use cobrowse");!function(e,t,o){e.Genesys("registerPlugin",t,o)}(e,"CobrowseService",(e=>{var t,o,n,s,i,r;const a=e.data("GenesysJS.deploymentConfig"),l=e.data("GenesysJS.snippetConfig");if("string"!=typeof(null==l?void 0:l.deploymentId))return void _o.error("configuration error, exiting (deployment id is not found)");if("boolean"!=typeof(null===(t=null==a?void 0:a.cobrowse)||void 0===t?void 0:t.allowAgentControl))return void _o.error("configuration error, exiting (allowAgentControl is not found)");if("object"!=typeof(null===(o=null==a?void 0:a.cobrowse)||void 0===o?void 0:o.maskSelectors))return void _o.error("configuration error, exiting (maskSelectors is not found)");(null===(n=null==l?void 0:l.cobrowse)||void 0===n?void 0:n.logLevel)&&(Oo=l.cobrowse.logLevel),(null==l?void 0:l.debug)&&(Oo="DEBUG"),_o.setLogLevel(Oo),(null==l?void 0:l.environment)&&(Ao=l.environment),(null===(i=null===(s=null==a?void 0:a.messenger)||void 0===s?void 0:s.styles)||void 0===i?void 0:i.primaryColor)&&(No=a.messenger.styles.primaryColor),(null==a?void 0:a.headlessMode)&&(null===(r=null==a?void 0:a.headlessMode)||void 0===r?void 0:r.enabled)&&(Ro=a.headlessMode.enabled);const d=jo(a),c=new ce(Ao);let h=c.getUri("api");"cobrowseUrl"in window&&(_o("window.cobrowseUrl is set, overriding the API URL"),h=window.cobrowseUrl);const u=new Lo(d,c.getUri("staticAssets"),Oo),g={apiUrl:h,logLevel:Oo,primaryColor:No,env:Ao,ignoredSelectors:[".genesys-mxg-frame",".orgspan-app .free-trial-support"],deploymentId:l.deploymentId},[p,m]=this.initCobrowseCore(g,e,u,c,Ro);Uo(e,p,m)}))}initCobrowseCore(e,t,o,n,s){const i=new Dt(e,n,o);return[i,new Do(i,t,s)]}getLogLevel(){return Oo}getPrimaryColor(){return No}isHeadlessModeOn(){return Ro}},Vo=i("cobrowseSharerApp",zo.getLogLevel());try{zo.registerWithCXBus2()}catch(e){Vo(e.message,e),Vo("not starting cobrowse")}}();
